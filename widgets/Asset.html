<!DOCTYPE html>
<html lang="en">
<head>
    <title>Trap Widget</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="js/line_chart/chartist.min.css" rel="stylesheet">

    <style>
        /* Customize the label (the container) */
        .container {
            display: block;
            position: relative;
            padding-left: 2px;
            /* padding: 15px; */
            cursor: pointer;
            /* font-size: 22px; */
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

            /* Hide the browser's default checkbox */
            .container input {
                position: absolute;
                opacity: 0;
                cursor: pointer;
                height: 0;
                width: 0;
            }

        /* Create a custom checkbox */
        .checkmark {
            position: absolute;
            top: 3px;
            left: 0;
            height: 15px;
            width: 15px;
            background-color: #f2f2f2;
            border-radius: 2px;
            border: 2px solid #e57123;
        }

        /* On mouse-over, add a grey background color */
        .container:hover input ~ .checkmark {
            background-color: rgba(247, 152, 89, 0.7);
        }

        /* When the checkbox is checked, add a blue background */
        .container input:checked ~ .checkmark {
            background-color: rgba(245, 129, 51);
        }

        /* Create the checkmark/indicator (hidden when not checked) */
        .checkmark:after {
            content: "";
            position: absolute;
            display: none;
        }

        /* Show the checkmark when checked */
        .container input:checked ~ .checkmark:after {
            display: block;
        }

        /* Style the checkmark/indicator */
        .container .checkmark:after {
            left: 4px;
            /* top: 1px; */
            width: 5px;
            height: 10px;
            border: solid white;
            border-width: 0 3px 3px 0;
            -webkit-transform: rotate(45deg);
            -ms-transform: rotate(45deg);
            transform: rotate(45deg);
        }

        body {
            font-family: "Open Sans";
            font-size: 16px;
            user-select: none;
            overflow-x: hidden;
            overflow-y: auto;
        }

        @font-face {
            font-family: "Open Sans";
            font-style: normal;
            font-weight: 400;
            src: local("Open Sans"), local("OpenSans"), url("../fonts/OpenSans400.woff") format("woff");
        }

        @font-face {
            font-family: "Open Sans";
            font-style: normal;
            font-weight: 700;
            src: local("Open Sans"), local("OpenSans"), url("../fonts/OpenSans700.woff") format("woff");
        }

        .noSelect {
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        #widget {
            background-color: white;
        }
        /* Hide scrollbar for Chrome, Safari and Opera */
        #container::-webkit-scrollbar {
            display: none;
        }

        /* Hide scrollbar for IE, Edge and Firefox */
        #container {
            -ms-overflow-style: none; /* IE and Edge */
            scrollbar-width: none; /* Firefox */
        }

        #container {
            position: fixed;
            height: calc(100% - 2px);
            border: 1px solid #ddd;
            border-radius: 3px;
            overflow: auto;
        }

        thead th {
            position: sticky;
            position: -webkit-sticky;
            top: 35px;
            z-index: 999;
            background-color: #f2f2f2;
        }

        .selectBtn:hover {
            color: #000000;
            text-decoration: none;
            font-family: sans-serif;
            background-color: #4d98c2ff;
            padding: 10px 25px;
            cursor: pointer;
            margin: 2%;
            height: 15px;
        }

        .btnSelected {
            border-bottom: 2px solid #4c4c4c;
            color: #000000;
            text-decoration: none;
            font-family: sans-serif;
            background-color: #4d98c2ff;
            padding: 10px 25px;
            cursor: pointer;
            margin: 2%;
            height: 15px;
        }

        .selectBtn {
            background-color: #6ec4f7ff;
            /* Green */
            font-family: sans-serif;
            margin: 2%;
            border: none;
            color: white;
            padding: 10px 25px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 1rem;
            height: 15px;
            cursor: pointer;
        }

        table {
            border-collapse: collapse;
            table-layout: fixed;
            border-spacing: 0;
            width: 100%;
            max-height: calc(100% - 30px);
            border: none;
            bottom: 38px;
        }

        th {
            text-transform: capitalize;
            text-align: left;
            padding: 5px 0px 5px 0px;
            margin: 0px 4px 0px 4px;
            background-color: white;
            border-bottom: 2px solid #dee2e6;
        }

        .checkbox-row {
            height: 1.5rem;
        }

        td {
            position: sticky;
            text-align: left;
            word-break: break-word;
            padding: 4px;
            border-bottom: 1px solid #dee2e6;
        }

        .barLegend {
            padding-left: 2%;
            padding-right: 2%;
            font-size: 12px;
            color: white;
            width: 100%;
        }

        tr:nth-child(even) {
            background-color: rgba(0,0,0,.05);
        }

        tr.selected {
            background-color: #dff0d8;
            font-weight: bold /* our pastel green*/
        }

        .rowHover:hover td {
            background-color: #fffaf3;
            /* our pastel yellow*/
        }

        #searchInp {
            width: 100px;
            float: right;
            height: 25px;
            text-indent: 4px;
            font: 14px 'Open Sans';
            display: none;
            border-radius: 3px;
            border-color: lightgray;
            margin: 4px;
            padding: .375rem .75rem;
            font-size: 1rem;
            line-height: 1.5;
            color: #495057;
            background-color: #fff;
            background-clip: padding-box;
            border: 1px solid #ced4da;
            border-radius: .25rem;
            transition: border-color .15s ease-in-out,box-shadow .15s ease-in-out;
            -webkit-transition: width 0.4s ease-in-out;
            transition: width 0.4s ease-in-out;
        }

            /* When the input field gets focus, change its width to 100% */
            #searchInp:focus {
                width: 300px;
            }

        /* Remove blue box around textbox. */
        input:focus {
            outline: none;
        }

        #headerBar {
            top: 0;
            z-index: 100;
            position: sticky;
            display: none;
            background-color: #f2f2f2;
            height: 34px;
            border-bottom: 1px solid #ddd;
        }

        #tableTitle {
            float: left;
            margin: 6px 0 6px 14px;
        }

        .headCol {
            text-overflow: ellipsis;
            overflow: hidden;
            white-space: nowrap;
        }

        /* Status border */
        .newPhotoBorder {
            border-right: 5px solid blue;
        }

        .openCardBorder {
            border-right: 5px solid black;
        }

        .normalCardBorder {
            border-right: 5px solid #f2f2f2;
        }

        .alertCardBorder {
            border-right: 5px solid red;
        }


        /* Triggered */
        .redIcon {
            background-image: url("/userfiles/Animal-Trap-Icon-Red.png");
            background-size: contain;
            background-color: white;
            border-radius: 5px;
        }

        /* Inactive */
        .greyIcon {
            background-image: url("/userfiles/Animal-Trap-Icon-DkGrey.png");
            background-size: contain;
            background-color: white;
            border-radius: 5px;
        }

        /* Set  */
        .greenIcon {
            background-image: url("/userfiles/Animal-Trap-Icon-Green.png");
            background-size: contain;
            background-color: white;
            border-radius: 5px;
        }



        .capitalize {
            text-transform: capitalize;
        }

        .button {
            background-color: #4CAF50;
            /* Green */
            font-family: sans-serif;
            border: none;
            color: white;
            padding: 10px 25px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 1rem;
            border-radius: 6px;
            height: 50px;
            cursor: pointer;
        }

        .notes-css {
            cursor: pointer;
            display: block;
            font-size: 16px;
            font-family: sans-serif;
            font-weight: 700;
            color: #444;
            line-height: 1.3;
            padding: 0.6em 0.8em;
            width: calc(100% - 16px);
            max-width: 100%;
            box-sizing: border-box;
            margin: 8px;
            border: 1px solid #aaa;
            box-shadow: 0 1px 0 1px rgba(0, 0, 0, .04);
            -moz-appearance: none;
            -webkit-appearance: none;
            appearance: none;
            background-color: #fff;
            background-repeat: no-repeat, repeat;
            background-position: right .7em top 50%, 0 0;
            background-size: .65em auto, 100%;
        }

            .notes-css::-ms-expand {
                display: none;
            }

            .notes-css:hover {
                border-color: #888;
            }

            .notes-css:focus {
                border-color: #aaa;
                box-shadow: 0 0 1px 3px rgba(59, 153, 252, .7);
                box-shadow: 0 0 0 3px -moz-mac-focusring;
                color: #222;
                outline: none;
            }

            .notes-css option {
                font-weight: normal;
            }

        .select-css {
            cursor: pointer;
            display: block;
            font-size: 16px;
            font-family: sans-serif;
            font-weight: 700;
            color: white;
            line-height: 1.3;
            padding: 0.6em 0.8em;
            width: calc(100% - 16px);
            max-width: 100%;
            box-sizing: border-box;
            margin: 8px;
            border: 1px solid #aaa;
            box-shadow: 0 1px 0 1px rgba(0, 0, 0, .04);
            -moz-appearance: none;
            -webkit-appearance: none;
            appearance: none;
            background-color: rgb(65, 80, 90);
            background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23007CB2%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E');
            background-repeat: no-repeat, repeat;
            background-position: right .7em top 50%, 0 0;
            background-size: .65em auto, 100%;
        }

            .select-css::-ms-expand {
                display: none;
            }

            .select-css:hover {
                border-color: #ffffff;
            }

            .select-css:focus {
                border-color: #aaa;
                box-shadow: 0 0 1px 3px rgba(59, 153, 252, .7);
                box-shadow: 0 0 0 3px -moz-mac-focusring;
                border-color: #ffffff;
                outline: none;
            }

            .select-css option {
                font-weight: normal;
            }

        .container {
            height: 60px;
            position: relative;
        }

        .vertical-center {
            margin: 0;
            position: absolute;
            top: 50%;
            -ms-transform: translateY(-50%);
            transform: translateY(-50%);
        }

        ul {
            margin: 4px 0 4px 0;
            overflow: hidden;
            white-space: nowrap;
        }

        li {
            white-space: nowrap;
            overflow: hidden;
        }

        .mapIcon {
            float: right;
            cursor: pointer;
            font-size: 29px;
            margin-right: 3%;
        }

            .mapIcon:hover {
                float: right;
                cursor: pointer;
                font-size: 35px;
                color: #f58133;
            }

        .dialText {
            font-size: 12px;
        }

        .fullWidth {
            width: 80%;
        }

        .container-fluid {
            margin: 3%;
        }

        .displayContainer {
            display: inline-block;
            text-align: end;
        }

        .underlineIndicatorLeft {
            border: 0.1px solid #ffffff;
            border-radius: 52px;
            background-color: #ffffff;
            height: 3px;
            display: flex;
            width: 20px;
            position: relative;
            left: 0%;
        }

        .underlineIndicatorRight {
            border: 0.1px solid #ffffff;
            border-radius: 52px;
            background-color: #ffffff;
            height: 3px;
            display: flex;
            width: 20px;
            position: relative;
            left: 94%;
        }



        .underlineIndicatorCenter {
            border: 0.1px solid #ffffff;
            border-radius: 52px;
            background-color: #ffffff;
            height: 3px;
            display: flex;
            width: 20px;
            position: relative;
            left: 46%;
        }

        @media screen and (max-width: 1440px) {
            .underlineIndicatorLeft {
                border: 0.1px solid #ffffff;
                border-radius: 52px;
                background-color: #ffffff;
                height: 3px;
                display: flex;
                width: 20px;
                position: relative;
                left: 0%;
            }

            .underlineIndicatorRight {
                border: 0.1px solid #ffffff;
                border-radius: 52px;
                background-color: #ffffff;
                height: 3px;
                display: flex;
                width: 20px;
                position: relative;
                left: 89%;
            }



            .underlineIndicatorCenter {
                border: 0.1px solid #ffffff;
                border-radius: 52px;
                background-color: #ffffff;
                height: 3px;
                display: flex;
                width: 20px;
                position: relative;
                left: 44%;
            }
        }

        @media screen and (max-width: 1024px) {
            .underlineIndicatorLeft {
                border: 0.1px solid #ffffff;
                border-radius: 52px;
                background-color: #ffffff;
                height: 3px;
                display: flex;
                width: 20px;
                position: relative;
                left: 0%;
            }

            .underlineIndicatorRight {
                border: 0.1px solid #ffffff;
                border-radius: 52px;
                background-color: #ffffff;
                height: 3px;
                display: flex;
                width: 20px;
                position: relative;
                left: 84%;
            }



            .underlineIndicatorCenter {
                border: 0.1px solid #ffffff;
                border-radius: 52px;
                background-color: #ffffff;
                height: 3px;
                display: flex;
                width: 20px;
                position: relative;
                left: 43%;
            }
        }


        @media screen and (max-width: 768px) {
            .underlineIndicatorLeft {
                border: 0.1px solid #ffffff;
                border-radius: 52px;
                background-color: #ffffff;
                height: 3px;
                display: flex;
                width: 20px;
                position: relative;
                left: 0%;
            }

            .underlineIndicatorRight {
                border: 0.1px solid #ffffff;
                border-radius: 52px;
                background-color: #ffffff;
                height: 3px;
                display: flex;
                width: 20px;
                position: relative;
                left: 78%;
            }



            .underlineIndicatorCenter {
                border: 0.1px solid #ffffff;
                border-radius: 52px;
                background-color: #ffffff;
                height: 3px;
                display: flex;
                width: 20px;
                position: relative;
                left: 40%;
            }
        }

        @media screen and (max-width: 425px) {
            .underlineIndicatorLeft {
                border: 0.1px solid #ffffff;
                border-radius: 52px;
                background-color: #ffffff;
                height: 3px;
                display: flex;
                width: 9px;
                position: relative;
                left: 0%;
            }

            .underlineIndicatorRight {
                border: 0.1px solid #ffffff;
                border-radius: 52px;
                background-color: #ffffff;
                height: 3px;
                display: flex;
                width: 9px;
                position: relative;
                left: 78%;
            }



            .underlineIndicatorCenter {
                border: 0.1px solid #ffffff;
                border-radius: 52px;
                background-color: #ffffff;
                height: 3px;
                display: flex;
                width: 9px;
                position: relative;
                left: 40%;
            }
        }

        @media screen and (max-width: 375px) {
            .underlineIndicatorLeft {
                border: 0.1px solid #ffffff;
                border-radius: 52px;
                background-color: #ffffff;
                height: 3px;
                display: flex;
                width: 9px;
                position: relative;
                left: 0%;
            }

            .underlineIndicatorRight {
                border: 0.1px solid #ffffff;
                border-radius: 52px;
                background-color: #ffffff;
                height: 3px;
                display: flex;
                width: 9px;
                position: relative;
                left: 74%;
            }



            .underlineIndicatorCenter {
                border: 0.1px solid #ffffff;
                border-radius: 52px;
                background-color: #ffffff;
                height: 3px;
                display: flex;
                width: 9px;
                position: relative;
                left: 38%;
            }
        }



        @media screen and (max-width: 320px) {
            .underlineIndicatorLeft {
                border: 0.1px solid #ffffff;
                border-radius: 52px;
                background-color: #ffffff;
                height: 3px;
                display: flex;
                width: 9px;
                position: relative;
                left: 0%;
            }

            .underlineIndicatorRight {
                border: 0.1px solid #ffffff;
                border-radius: 52px;
                background-color: #ffffff;
                height: 3px;
                display: flex;
                width: 9px;
                position: relative;
                left: 70%;
            }



            .underlineIndicatorCenter {
                border: 0.1px solid #ffffff;
                border-radius: 52px;
                background-color: #ffffff;
                height: 3px;
                display: flex;
                width: 9px;
                position: relative;
                left: 35%;
            }
        }

        .UnderlineGreen {
            width: 100%;
            border: 3px solid #388b3d;
            border-radius: 52px;
            margin-top: 3.7px;
            margin-bottom: 3.7px;
            background-color: #388b3d;
        }

        .UnderlineOrange {
            width: 100%;
            border: 3px solid #f88924ff;
            border-radius: 52px;
            margin-top: 3.7px;
            margin-bottom: 3.7px;
            background-color: #f88924ff;
        }

        .UnderlineRed {
            width: 100%;
            border: 3px solid #d74423ff;
            border-radius: 52px;
            margin-top: 3.7px;
            margin-bottom: 3.7px;
            background-color: #d74423ff;
        }

        .UnderlineGray {
            width: 100%;
            border: 3px solid gray;
            border-radius: 52px;
            margin-top: 3.7px;
            margin-bottom: 3.7px;
            background-color: gray;
        }

        .LabelStyle {
            font-size: 7.5px;
            justify-content: center;
            display: inline-flex;
        }

        .SideBarGray {
            border-left: 8px solid gray;
        }

        .SideBarGreen {
            border-left: 8px solid green;
        }

        .SideBarYellow {
            border-left: 8px solid orange;
        }

        .SideBarRed {
            border-left: 8px solid red;
        }

        .StatusIndicator {
            float: right;
            font-size: 10px;
        }

        .ValueStyle {
            font-size: 15.5px;
            font-weight: bold;
            color: #41505aff;
        }

        .tabBtn {
            text-align: center;
            width: 50%;
            padding-left: 10%;
            padding-right: 10%;
            padding-top: 15px;
            padding-bottom: 15px;
            font-family: sans-serif;
            background-color: rgb(230 230 230);
            border: none;
            color: #41505a;
            padding: 10px 25px;
            text-align: center;
            text-decoration: none;
            font-size: 1rem;
            cursor: pointer;
            border-radius: 2px;
        }

            .tabBtn:hover {
                text-align: center;
                width: 50%;
                padding-left: 10%;
                padding-right: 10%;
                padding-top: 15px;
                padding-bottom: 15px;
                font-family: sans-serif;
                background-color: #4d98c2;
                border: none;
                color: white;
                padding: 10px 25px;
                text-align: center;
                text-decoration: none;
                font-size: 1rem;
                cursor: pointer;
                border-radius: 2px;
            }

        .tabBtnSelected {
            text-align: center;
            width: 50%;
            padding-left: 10%;
            padding-right: 10%;
            padding-top: 15px;
            padding-bottom: 15px;
            font-family: sans-serif;
            background-color: #4d98c2;
            border: none;
            color: white;
            padding: 10px 25px;
            text-align: center;
            text-decoration: none;
            font-size: 1rem;
            cursor: pointer;
            border-radius: 2px;
        }

        .normalCardBorder {
            background-color: #e6e6e6ff;
        }

            .normalCardBorder:hover {
                background-color: #f2f2f2
            }


        [data-info="chart"] {
            padding: 20px;
        }

            [data-info="chart"] table {
                width: 100%;
                height: 400px;
            }

        .charttitle {
            text-align: center;
        }

        .bars {
            color: white;
            font-size: 13px;
            text-align: center;
        }

            .bars td {
                text-align: center;
                vertical-align: bottom;
            }

            .bars div:hover {
                opacity: 0.6;
            }

        .legend {
            vertical-align: bottom;
            padding-left: 20px;
            text-align: left;
        }

        .legbox {
            display: block;
            clear: both;
        }

        .xaxisname {
            margin: 5px;
            color: #fff;
            font-size: 77%;
            padding: 5px;
            float: left;
        }


        /*Flat UI colors*/

        .one {
            background: #16A085;
        }

        .two {
            background: #2ECC71;
        }

        .three {
            background: #27AE60;
        }

        .four {
            background: #3498DB;
        }

        .five {
            background: #2980B9;
        }

        .six {
            background: #9B59B6;
        }

        .seven {
            background: #8E44AD;
        }

        .eight {
            background: #34495E;
        }

        .nine {
            background: #2C3E50;
        }

        .ten {
            background: #22313f;
        }

        .eleven {
            background: #F1C40F;
        }

        .twelve {
            background: #F39C12;
        }

        .thirteen {
            background: #E67E22;
        }

        .fourteen {
            background: #D35400;
        }

        .fifteen {
            background: #E74C3C;
        }

        .sixteen {
            background: #C0392B;
        }

        .seventeen {
            background: #ECF0F1;
        }

            .seventeen.clouds {
                color: #BDC3C7;
            }

        .eighteen {
            background: #BDC3C7;
        }

        .nineteen {
            background: #95A5A6;
        }

        .twenty {
            background: #7F8C8D;
        }

        .barColor {
            background-color: #6ec4f7ff;
        }

            .barColor:hover {
                background-color: #4d98c2;
                cursor: pointer;
            }

        .flex {
            display: -webkit-box; /* OLD - iOS 6-, Safari 3.1-6, BB7 */
            display: -ms-flexbox; /* TWEENER - IE 10 */
            display: -webkit-flex; /* NEW - Safari 6.1+. iOS 7.1+, BB10 */
            display: flex; /* NEW, Spec - Firefox, Chrome, Opera */
            flex: 1;
            display: flex;
            flex-direction: row;
            align-items: flex-start;
            -webkit-display: flex;
            -webkit-flex-direction: row;
            -webkit-align-items: flex-start;
        }

        .labelChild {
            width: 100%;
        }

        @supports (overflow:-webkit-marquee) and (justify-content:inherit) {
            .flex {
                display: -webkit-flex; /* NEW - Safari 6.1+. iOS 7.1+, BB10 */
                flex: 1;
                flex-direction: row;
                align-items: flex-start;
            }
        }

        .iconWidth {
            width: 5%;
        }

        .thresholdsLabel {
            color: white;
            margin: auto;
            position: absolute;
            right: 3%;
        }

        @media screen and (max-width: 2560px) {
            .CardWidth {
                width: 99.5%;
            }

            .setupContent {
                width: 45%;
                display: grid;
                margin-left: 3%;
            }
        }

        @media screen and (max-width: 1504px) {
            .CardWidth {
                width: 99%;
            }

            .setupContent {
                width: 45%;
                display: grid;
                margin-left: 3.5%;
            }
        }

        @media screen and (max-width: 1404px) {
            .CardWidth {
                width: 99%;
            }

            .setupContent {
                width: 45%;
                display: grid;
                margin-left: 5.5%;
            }
        }


        @media screen and (max-width: 868px) {
            .CardWidth {
                width: 99%;
            }

            .setupContent {
                width: 38%;
                display: grid;
                margin-left: 7%;
            }

            .labelChild {
                width: 100%;
                font-size: 7px;
            }


            .thresholdsLabel {
                color: white;
                margin: auto;
                position: absolute;
                right: 4%;
            }
        }


        @media screen and (max-width: 722px) {
            .CardWidth {
                width: 99%;
            }

            .setupContent {
                width: 38%;
                display: grid;
                margin-left: 11%;
            }

            .labelChild {
                width: 100%;
                font-size: 7px;
            }

            .thresholdsLabel {
                color: white;
                margin: auto;
                position: absolute;
                right: 6%;
            }
        }


        @media screen and (max-width: 427px) {
            .labelChild {
                width: 100%;
                font-size: 4px;
            }

            .CardWidth {
                width: 97%;
            }

            .setupContent {
                width: 38%;
                display: grid;
                margin-left: 14%;
            }

            .thresholdsLabel {
                color: white;
                margin: auto;
                position: absolute;
                right: 7%;
            }
        }

        @media screen and (max-width: 320px) {
            .labelChild {
                width: 100%;
                font-size: 4px;
            }

            .CardWidth {
                width: 97%;
            }

            .setupContent {
                width: 33%;
                display: grid;
                margin-left: 15%;
            }

            .thresholdsLabel {
                color: white;
                margin: auto;
                position: relative;
                /* left: 100%; */
                /* top: 0px; */
                width: 100%;
                right: -22%;
            }
        }

        .ct-golden-section {
            display: block;
            position: relative;
            width: 100%;
            height: 218px;
        }

        .alignCenter {
            width: 100%;
            text-align: center;
            font-size: 10px;
        }

        .ct-label.ct-horizontal.ct-end {
            -webkit-box-align: flex-start;
            -webkit-align-items: flex-start;
            -ms-flex-align: flex-start;
            align-items: flex-start;
            -webkit-box-pack: flex-start;
            -webkit-justify-content: flex-start;
            -ms-flex-pack: flex-start;
            justify-content: flex-start;
            text-align: left;
            text-anchor: start;
            color: white;
            font-size: 6px;
            padding-top: 16px;
        }

        .ct-grid {
            stroke: none;
            stroke-width: 0.9px;
            stroke-dasharray: 0px;
        }

        .ct-label.ct-vertical.ct-start {
            -webkit-box-align: flex-end;
            -webkit-align-items: flex-end;
            -ms-flex-align: flex-end;
            align-items: flex-end;
            -webkit-box-pack: flex-end;
            -webkit-justify-content: flex-end;
            -ms-flex-pack: flex-end;
            justify-content: flex-end;
            text-align: right;
            text-anchor: end;
            color: white;
            font-size: 10px;
        }

        .labelsParent {
            position: relative;
            top: 84%;
            color: white;
            display: flex;
            padding-left: 0%;
            padding-right: 2%;
        }


        .postionChartButton {
            position: absolute;
            bottom: 50%;
            border-radius: 2px;
            right: 50%;
            padding: 8px;
            background-color: #4d98c25c;
            color: white;
            z-index: 55;
        }

        @media screen and (max-width: 600px) {

            .labelsParent {
                position: relative;
                top: 84%;
                color: white;
                display: flex;
                padding-left: 9%;
                padding-right: 0%;
            }

            .postionChartButton {
                position: absolute;
                bottom: 50%;
                border-radius: 2px;
                right: 40%;
                padding: 8px;
                background-color: #4d98c25c;
                color: white;
                z-index: 55;
            }
        }

        .ct-series-a .ct-bar, .ct-series-a .ct-line, .ct-series-a .ct-point, .ct-series-a .ct-slice-donut {
            stroke: #4d98c2;
            stroke-width: 2px;
        }

        .iconError {
            position: absolute;
            left: 12px;
            top: -10px;
        }

        .InnerTableHeader {
            Color: white;
            font-weight: 400;
            font-size: 14px;
            text-align: center;
            background-color: transparent;
            border-bottom: none;
        }

        .btnInnerChart {
            padding-left: 10px;
            background-color: #70c2e0;
            border-radius: 21px;
            border: 1px solid #29668f;
            display: inline-block;
            cursor: pointer;
            color: #ffffff;
            font-family: Arial;
            font-size: 9px;
            width: 74px;
            padding: 7px 0px;
            text-decoration: none;
            text-shadow: 0px 1px 0px #87b7c7;
        }

            .btnInnerChart:hover {
                background-color: #4d98c2;
            }

            .btnInnerChart:active {
                position: relative;
                top: 1px;
            }

        .inactiveToggle {
            position: absolute;
            left: 21px;
            font-size: 6px;
            top: 8px;
        }



        .inactiveToggle2 {
            position: absolute;
            left: 28px;
            top: 8px;
        }

        .activeToggle {
            position: absolute;
            left: 24px;
            top: 8px;
        }
        /* The switch - the box around the slider */
        .switch {
            position: relative;
            display: inline-block;
            width: 74px;
            height: 23px;
        }

            /* Hide default HTML checkbox */
            .switch input {
                opacity: 0;
                width: 0;
                height: 0;
            }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 5px;
            right: 0;
            bottom: 0;
            background-color: #6ac0f3;
            -webkit-transition: .4s;
            transition: .4s;
            font-size: 9px;
            padding-top: 10px;
            padding-left: 24px;
            color: white;
        }

            .slider:before {
                position: absolute;
                content: "";
                height: 15px;
                width: 15px;
                left: 51px;
                bottom: 4px;
                background-color: white;
                -webkit-transition: .4s;
                transition: .4s;
            }


        .Selected {
            position: absolute;
            left: 10px;
        }

        input:checked + .slider {
            background-color: #6ac0f3ff;
            font-size: 9px;
            padding-top: 10px;
            padding-right: 28px;
            color: white;
        }

        input:focus + .slider {
            box-shadow: 0 0 1px #6ac0f3ff;
        }

        input:checked + .slider:before {
            -webkit-transform: translateX(-46px);
            -ms-transform: translateX(-46px);
            transform: translateX(-46px);
        }

        /* Rounded sliders */
        .slider.round {
            border-radius: 34px;
        }

            .slider.round:before {
                border-radius: 50%;
            }

        .ThresholdInput {
            width: 100%;
            padding: 7px;
            border-radius: 4px;
            margin: auto;
        }

        .toggleposition {
            margin: auto;
            padding: 18px;
        }
      
        .ct-series-d .ct-bar, .ct-series-c .ct-line, .ct-series-c .ct-point, .ct-series-c .ct-slice-donut{
            stroke:#d71e0f;
            stroke-width: 2.1px;
        }
        .ct-series-b .ct-bar, .ct-series-b .ct-line, .ct-series-b .ct-point, .ct-series-b .ct-slice-donut{
            stroke:#d71e0f;
            stroke-width: 2.1px;
        }
        .ct-series-e .ct-bar, .ct-series-e .ct-line, .ct-series-e .ct-point, .ct-series-e .ct-slice-donut{
            stroke:#d7a20f;
            stroke-width: 2.1px;
        }

        .ct-series-d .ct-bar, .ct-series-d .ct-line, .ct-series-d .ct-point, .ct-series-d .ct-slice-donut  {
            stroke:#d7a20f;
            stroke-width: 2.1px;
        }
       
    </style>
</head>
<body id="body">
    <div id="group">


        <div id="widget" style="position:absolute; left:0px; top:0px; width:100%; height:100px; z-index:100;">
            <div id="container">
                <div id="headerBar">
                    <b id="tableTitle"></b>
                </div>
                <table id="table" style="width: 100%">
                    <thead>
                        <tr id="header">
                        </tr>
                    </thead>
                    <tbody id="tbody">
                    </tbody>
                </table>
                <div id="footer" style="height:30px; width: 100%; display:none  "></div>
            </div>
        </div>
    </div>
    <div id="cardChildTemplate" style="display:none;">
        <div data-section="main" data-info="SideBarStatus" data-value="triggered" class="normalCardBorder SideBarGreen" onclick="toggleClearScreen(this)" style="font-family: sans-serif;border-radius:2px; padding: 8px; overflow:hidden;z-index:130;">
            <div data-section="cell">
                <div>
                    <div class="container flex" style="margin: 8px 8px 4px 0;  ">

                        <!--<div data-info="SideBarStatus" class="SideBarGreen">

                        </div>-->
                        <!--Dummy Trap Icon start-->
                        <div style="border-right: 0.98px solid #9b9b9bff;width:99%;">
                            <div class="iconError" data-info="errorStatus" style="display:none">

                                <svg xmlns:dc="http://purl.org/dc/elements/1.1/"
                                     xmlns:cc="http://creativecommons.org/ns#"
                                     xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
                                     xmlns:svg="http://www.w3.org/2000/svg"
                                     xmlns="http://www.w3.org/2000/svg"
                                     xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"
                                     xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"
                                     width="18px"
                                     height="18px"
                                     viewBox="0 0 3.1593108 10.265815"
                                     version="1.1"
                                     id="svg46764"
                                     inkscape:version="0.92.4 (5da689c313, 2019-01-14)"
                                     sodipodi:docname="Exclamation.svg">
                                    <defs id="defs46758" />


                                    <g inkscape:label="Layer 1"
                                       inkscape:groupmode="layer"
                                       id="layer1"
                                       transform="translate(-57.384632,-79.444472)">
                                        <path d="m 60.027039,88.133224 a 1.0627789,1.060213 0 0 1 -1.059222,1.060208 1.0627789,1.060213 0 0 1 -1.066312,-1.053111 1.0627789,1.060213 0 0 1 1.052085,-1.067256 1.0627789,1.060213 0 0 1 1.073354,1.045967"
                                              sodipodi:open="true"
                                              sodipodi:end="6.2697986"
                                              sodipodi:start="0"
                                              sodipodi:ry="1.060213"
                                              sodipodi:rx="1.0627789"
                                              sodipodi:cy="88.133224"
                                              sodipodi:cx="58.96426"
                                              sodipodi:type="arc"
                                              id="path28027"
                                              style="opacity:1;fill:#d74423;fill-opacity:1;stroke:#d74423;stroke-width:1.03369844;stroke-linecap:round;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1"
                                              inkscape:export-filename="C:\Users\fredy\Documents\Sensavation\Pest\UI Elements\mbb.png"
                                              inkscape:export-xdpi="96"
                                              inkscape:export-ydpi="96"
                                              inkscape:transform-center-x="0.22674155"
                                              inkscape:transform-center-y="-5.2179916" />
                                        <path inkscape:transform-center-y="1.645522"
                                              inkscape:transform-center-x="17.617202"
                                              inkscape:connector-curvature="0"
                                              id="path28029"
                                              d="m 58.888664,84.311469 -0.0247,-3.515579"
                                              style="fill:#d74423;fill-opacity:1;stroke:#d74423;stroke-width:2.66488314;stroke-linecap:round;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" />
                                    </g>
                                </svg>
                            </div>
                            <div class="deviceIcon">
                                <svg xmlns:dc="http://purl.org/dc/elements/1.1/"
                                     xmlns:cc="http://creativecommons.org/ns#"
                                     xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
                                     xmlns:svg="http://www.w3.org/2000/svg"
                                     xmlns="http://www.w3.org/2000/svg"
                                     width="18.0px"
                                     height="18.0px"
                                     viewBox="0 0 18.0 18.0"
                                     data-info="iconDummy"
                                     style="margin-top: 12px; display:none;"
                                     version="1.1"
                                     id="SVGRoot">
                                    <defs id="defs3728" />

                                    <g id="layer1">
                                        <g style="fill:#6ac0f3;fill-opacity:1"
                                           id="g24358"
                                           transform="matrix(0.1530296,0,0,-0.12339019,-432.78504,402.41069)">
                                            <path style="opacity:1;fill:#6ac0f3;fill-opacity:1;stroke:#000000;stroke-width:17.2827;stroke-linecap:round;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1"
                                                  d="m 2958.8069,3261.2859 c 0.6525,-1.3966 105.7324,-134.4096 105.7324,-195.118 0,-60.7084 -49.2139,-109.9223 -109.9224,-109.9223 -60.7084,0 -109.9223,49.2139 -109.9223,109.9223 0,60.7084 114.1123,195.118 114.1123,195.118"
                                                  id="path24350" />
                                            <circle style="opacity:1;fill:none;fill-opacity:1;stroke:#000000;stroke-width:11.25;stroke-linecap:round;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1"
                                                    id="circle24352"
                                                    cx="2928.1003"
                                                    cy="-3108.7366"
                                                    r="19.173914"
                                                    transform="scale(1,-1)" />
                                            <circle transform="scale(1,-1)"
                                                    r="19.173914"
                                                    cy="-3057.825"
                                                    cx="2982.1941"
                                                    id="circle24354"
                                                    style="opacity:1;fill:none;fill-opacity:1;stroke:#000000;stroke-width:11.25;stroke-linecap:round;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1" />
                                            <path style="fill:none;stroke:#000000;stroke-width:11.25;stroke-linecap:round;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"
                                                  d="m 2913.2615,3034.1824 85.8928,98.1966"
                                                  id="path24356" />
                                        </g>
                                    </g>
                                </svg>

                                <!--Dummy Trap Icon end-->
                                <!--Smart Trap Icon start-->
                                <svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 19.0 18.0" style="margin-top: 12px;" data-info="iconSmart" version="1.1" id="SVGRoot">
                                    <defs id="defs3126" />

                                    <g inkscape:label="Layer 1"
                                       inkscape:groupmode="layer"
                                       id="layer1">
                                        <g id="g24216"
                                           transform="matrix(0.06671381,0,0,-0.04522851,-225.68453,166.42476)"
                                           style="fill:#6ac0f3;fill-opacity:1">
                                            <circle transform="scale(1,-1)"
                                                    r="66.854393"
                                                    cy="-3370.5544"
                                                    cx="3517.863"
                                                    id="circle24210"
                                                    style="opacity:1;fill:#6ac0f3;fill-opacity:1;stroke:#6ac0f3;stroke-width:0;stroke-linecap:round;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1" />
                                            <path inkscape:connector-curvature="0"
                                                  id="path24212"
                                                  d="m 3517.8632,3671.4384 c -20.8492,0 -37.6333,-17.0198 -37.6333,-38.1606 V 3458.831 c 0,-2.5331 0.2474,-5.0049 0.7075,-7.3975 a 90.38953,90.38953 0 0 1 -53.4639,-82.3784 90.38953,90.38953 0 0 1 90.3897,-90.3896 90.38953,90.38953 0 0 1 90.3896,90.3896 90.38953,90.38953 0 0 1 -53.4565,82.4165 c 0.4553,2.3808 0.7002,4.8396 0.7002,7.3594 v 174.4468 c 0,21.1408 -16.7842,38.1606 -37.6333,38.1606 z"
                                                  style="opacity:1;fill:none;fill-opacity:1;stroke:#000000;stroke-width:26.25;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1" />
                                            <path inkscape:connector-curvature="0"
                                                  id="path24214"
                                                  d="m 3518.9355,3521.3809 -1.1552,-84.9476"
                                                  style="fill:#6ac0f3;fill-opacity:1;stroke:#6ac0f3;stroke-width:26.25;stroke-linecap:round;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" />
                                        </g>
                                    </g>
                                </svg>

                            </div>

                            <!--Smart Trap No Signal Icon start-->
                            <!--<div data-info="icon" class="redIcon vertical-center" style="display: inline-block; width: 25px; height: 25px;"></div>-->
                            <div class="vertical-center setupContent">
                                <div class="row">
                                    <span data-value="Status" style="margin-right: 6px;" class="capitalize StatusIndicator"></span>
                                </div>
                                <div class="row">
                                    <div data-value="DeviceNumber" class="capitalize" style="font-weight: bold; font-size: 12.5px">
                                        loading...
                                    </div>

                                    <div data-value="Address" style="display:inline-block;word-wrap:break-word;font-size: 10.5px;">
                                        loading...
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div style="float: right; margin-right: -12px; display: flex; width:100%; z-index:140;">

                            <div class="displayContainer" style="text-align: center;margin-left: 6px; width:100%;">
                                <span data-value="Dial" class="ValueStyle">
                                    --
                                </span>
                                <div class="UnderlineGray" data-info="UnderlineBait" style="width: 100%;">
                                    <span data-value="status1Pos" class="underlineIndicatorCenter"></span>
                                </div>
                                <span data-value="lbl1" class="LabelStyle">BAIT LEFT</span>
                            </div>
                            <div class="displayContainer" style="text-align: center;margin-left: 10px; margin-right:10px; width:100%;">
                                <span data-value="Hours" class="ValueStyle">
                                    --
                                </span>
                                <div class="UnderlineGray" data-info="UnderlineHours" style="width:100%;">
                                    <span data-value="status2Pos" class="underlineIndicatorCenter"></span>
                                </div>
                                <span data-value="lbl2" class="LabelStyle">MOTION COUNT</span>
                            </div>
                            <div class="displayContainer" style="text-align: center;width:100%;">
                                <span data-value="Duration" class="ValueStyle">
                                    --
                                </span>
                                <div class="UnderlineGray" data-info="UnderlineDuration" style="width:100%;">
                                    <span data-value="status3Pos" class="underlineIndicatorCenter"></span>
                                </div>
                                <span data-value="lbl3" class="LabelStyle">NEXT CHECK</span>
                            </div>
                            <div class="displayContainer" onclick="ShowMap(this)" style="margin-left:10px; z-index:140; display:none ">
                                <!--<div class="material-icons mapIcon" data-value="map" onclick="ShowMap(this)">
                                    map
                                </div>-->
                                <!--Defining map icon active start-->
                                <svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" id="ID_2" version="1.1" viewBox="0 0 15.933333 14.933333" height="60" width="35" data-value="map">

                                    <g id="g8225-3-9" transform="translate(-26.847364,-24.215189)">

                                        <g style="stroke:#ff0000" id="g8098-9-4-4" transform="translate(65.493399,-9.9190641)">
                                            <path style="opacity:1;fill:#388b3d;fill-opacity:1;stroke:#41505a;stroke-width:1.77158;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1" d="m -26.663135,39.093673 a 3.5554496,3.5554496 0 0 1 -3.555451,3.555449 3.5554496,3.5554496 0 0 1 -3.555449,-3.555449 3.5554496,3.5554496 0 0 1 3.555449,-3.555449 3.5554496,3.5554496 0 0 1 3.555451,3.555449 z" id="path7975-0-8-4-0"></path>
                                            <path style="fill:#41505a;fill-opacity:1;stroke:none;stroke-width:0.529167;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" d="m -34.339821,40.773931 4.093422,7.671634 c 1.381425,-2.559629 3.230117,-5.812082 4.144273,-7.678889 -2.454894,3.121173 -5.109367,3.839063 -8.237695,0.0073 z" id="path8088-3-7-7"></path>
                                        </g>
                                        <path id="path8216-8-5" d="m 31.178828,36.392542 -4.357449,4.417974 h 16.908209 l -4.50977,-4.417969 -2.41904,-0.0012 -0.28858,0.524401 2.49476,1.58e-4 3.43945,3.371094 H 28.071409 l 3.328129,-3.371094 2.609,0.0016 -0.27916,-0.521264 z" style="color:#000000;font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:medium;line-height:normal;font-family:sans-serif;font-variant-ligatures:normal;font-variant-position:normal;font-variant-caps:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-feature-settings:normal;text-indent:0;text-align:start;text-decoration:none;text-decoration-line:none;text-decoration-style:solid;text-decoration-color:#000000;letter-spacing:normal;word-spacing:normal;text-transform:none;writing-mode:lr-tb;direction:ltr;text-orientation:mixed;dominant-baseline:auto;baseline-shift:baseline;text-anchor:start;white-space:normal;shape-padding:0;clip-rule:nonzero;display:inline;overflow:visible;visibility:visible;opacity:1;isolation:auto;mix-blend-mode:normal;color-interpolation:sRGB;color-interpolation-filters:linearRGB;solid-color:#000000;solid-opacity:1;vector-effect:none;fill:#41505a;fill-opacity:1;fill-rule:nonzero;stroke:none;stroke-width:1.32292;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1;color-rendering:auto;image-rendering:auto;shape-rendering:auto;text-rendering:auto;enable-background:accumulate"></path>
                                    </g>
                                </svg>
                                <!--Defining Map Icon end-->
                            </div>
                            <!--<div data-value="Hours" style="display: inline-block; border: 2px solid red; border-radius: 14px; text-align:center; color: red; font-weight:bold; padding: 2px; margin-right: 4px; margin-left: 2px; min-width: 16px; ">
                                -
                            </div>-->
                            <br />
                        </div>
                    </div>

                </div>
            </div>
            <div data-section="clearScreen" onclick="event.stopPropagation()" style="width:100%;background-color: #41505aff;border: 1px solid #bfbfbf; overflow: hidden; display: none;">
                <div class="flex" style="width:100%;">
                    <a href="#" class=" tabBtnSelected" data-info="btnActions" style="width:50%;" onclick="OpenActions(event)">
                        Actions
                    </a>
                    <a href="#" class="tabBtn" data-info="btnInfo" style="width:50%;" onclick="OpenDeviceInfo(event)">
                        Device Info
                    </a>
                </div>
                <div data-section="alert" style="display: none; flex-direction: column; justify-content:space-evenly; text-align: center; margin-bottom: 4px;">
                    <div data-value="alert">
                    </div>
                    <hr style="margin: 8px" />
                </div>

                <div data-section="DeviceInfo" style="overflow: hidden;display: flex;flex-direction: row;text-align: center;margin-top: 10px; display:block">




                    <div class="flex" style="flex-direction:row; justify-content:space-evenly;  width:100%;text-align:center; border-bottom: 1px solid #b1b1b1;">
                        <div style="width:100%;display:grid;">
                            <span style="float: left; margin-right: 0; font-size: 15.5px; color: white;font-weight: normal;" class="ValueStyle">
                                Last Update
                            </span>
                            <span style="font-size: 12px;color:#68a5ca;font-weight: 900;" data-value="LastUpdate">--</span>
                        </div>

                        <div style="display: flex; width:100%;margin-right:20px">
                            <div class="displayContainer" style=" width: 100%; text-align: center; margin-left:0px;margin-right:10px;">
                                <span data-value="SignalStrenght" class="ValueStyle" style="font-size: 15.5px;color: white;">
                                    --
                                </span>
                                <div class="UnderlineGreen" data-info="UnderlineSignal"></div>
                                <span style="justify-content:center;font-size:15.5px; display:block; color: white;font-weight: normal;" class="LabelStyle">Signal</span>
                            </div>

                            <div class="displayContainer" style=" width: 100%; text-align: center; ">
                                <span id="numVal" data-section="BatteryVal" class="ValueStyle" style="font-size: 15.5px;color: #ffffffff;">
                                    --
                                </span>
                                <div class="UnderlineGreen" data-info="UnderlineBattery"></div>
                                <span style="justify-content:center;font-size:15.5px; display:block;color: white;font-weight: normal;" class="LabelStyle">Battery</span>
                            </div>
                        </div>

                    </div>
                    <div class="flex">
                        <div style="display:block; width:100%">
                            <div class="flex" style="padding-left: 20px; padding-top: 6px; padding-bottom: 6px;">
                                <a href="#" class="btnInnerChart" onclick="Goback()">Previous</a>
                                <a href="#" class="btnInnerChart" onclick="GoForward()">Next</a>

                                <div style="position: absolute; right: 31px;">
                                    <label class="switch">
                                        <input type="checkbox" data-value="checkbox" onclick="ToggleChart(this)">
                                        <span data-value="AdvStatus" class="slider round"><span data-value="SelectElementValues" class="activeToggle">ALL</span></span>
                                    </label>

                                </div>

                            </div>
                            <div data-info="noChartData" style="height:248px; width:100%">
                                <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="Layer_1" x="0px" y="0px" viewBox="0 0 800 231" style="enable-background:new 0 0 800 231; height:100%; width:100%;" xml:space="preserve">
                                <style type="text/css">
                                    .st0 {
                                        fill: #41505a;
                                    }

                                    .st1 {
                                        fill: none;
                                        stroke: #CACDD6;
                                        stroke-miterlimit: 10;
                                    }

                                    .st2 {
                                        fill: #ffffff;
                                    }

                                    .st3 {
                                        fill: #ffffff;
                                    }

                                    .st4 {
                                        fill: #ffffff;
                                    }
</style>
                                <g>
                                <g id="Layer_2_1_">
                                <g id="design">
                                <path class="st0" d="M0.7-0.2h800v231.6H0.7L0.7-0.2z" />




























			
			
			
                                <path class="st2" d="M385.2,156.2H384l-5.1-7.8h0c0.1,0.9,0.1,1.8,0.1,2.5v5.3h-1V147h1.2l5.1,7.8h0c0-0.1,0-0.5-0.1-1.1     s0-1.1,0-1.3V147h1L385.2,156.2z M393.6,152.8c0.1,1-0.3,1.9-0.9,2.7c-0.6,0.7-1.5,1-2.4,1c-0.6,0-1.2-0.1-1.7-0.4     c-0.5-0.3-0.9-0.7-1.1-1.3c-0.3-0.6-0.4-1.3-0.4-1.9c-0.1-1,0.2-1.9,0.9-2.6c0.6-0.7,1.5-1,2.4-1c0.9,0,1.7,0.3,2.3,1     C393.4,150.9,393.7,151.8,393.6,152.8L393.6,152.8z M388.3,152.8c0,0.7,0.1,1.4,0.5,2c0.4,0.5,1,0.7,1.6,0.7     c0.6,0,1.2-0.2,1.6-0.7c0.4-0.6,0.6-1.3,0.5-2c0-0.7-0.1-1.4-0.5-2c-0.4-0.5-1-0.7-1.6-0.7c-0.6,0-1.2,0.2-1.6,0.7     C388.5,151.4,388.3,152.1,388.3,152.8L388.3,152.8z M403.6,155.3L403.6,155.3c-0.6,0.7-1.4,1.1-2.3,1.1c-0.8,0-1.6-0.3-2.1-0.9     c-0.5-0.8-0.8-1.7-0.8-2.6c-0.1-1,0.2-1.9,0.8-2.7c0.5-0.7,1.3-1,2.1-1c0.8,0,1.7,0.3,2.2,1h0.1v-3.8h1.1v9.9h-0.9L403.6,155.3z      M401.5,155.5c0.6,0.1,1.2-0.2,1.6-0.6c0.4-0.6,0.5-1.2,0.5-1.9v-0.2c0.1-0.7-0.1-1.5-0.5-2.1c-0.4-0.4-1-0.7-1.6-0.6     c-0.6,0-1.1,0.2-1.4,0.7c-0.4,0.6-0.5,1.3-0.5,2c0,0.7,0.1,1.4,0.5,2C400.4,155.3,400.9,155.5,401.5,155.5z M411.1,156.2l-0.2-1     h0c-0.3,0.4-0.6,0.7-1,0.9c-0.4,0.2-0.8,0.2-1.3,0.2c-0.6,0-1.2-0.2-1.6-0.5c-0.4-0.4-0.6-1-0.6-1.5c0-1.4,1.1-2.1,3.4-2.2h1.2     v-0.4c0-0.4-0.1-0.9-0.4-1.2c-0.3-0.3-0.7-0.4-1.1-0.4c-0.7,0-1.4,0.2-2,0.5l-0.3-0.8c0.4-0.2,0.7-0.3,1.1-0.4     c0.4-0.1,0.8-0.2,1.2-0.1c0.7-0.1,1.3,0.1,1.8,0.6c0.4,0.5,0.7,1.1,0.6,1.8v4.8L411.1,156.2z M408.7,155.5c0.6,0,1.1-0.2,1.5-0.5     c0.4-0.4,0.6-0.9,0.6-1.5v-0.6l-1.1,0.1c-0.6,0-1.2,0.1-1.8,0.4c-0.4,0.2-0.6,0.6-0.6,1.1c0,0.3,0.1,0.6,0.4,0.9     C408,155.4,408.4,155.5,408.7,155.5L408.7,155.5z M416.3,155.5c0.2,0,0.4,0,0.5,0c0.1,0,0.3,0,0.4-0.1v0.8     c-0.2,0.1-0.3,0.1-0.5,0.1c-0.2,0-0.4,0.1-0.6,0.1c-1.3,0-2-0.7-2-2.1v-4.1h-1v-0.5l1-0.4l0.4-1.5h0.6v1.6h2v0.8h-2v4.1     c0,0.4,0.1,0.7,0.3,1C415.7,155.4,416,155.5,416.3,155.5L416.3,155.5z M422.9,156.2l-0.2-1h0c-0.3,0.4-0.6,0.7-1,0.9     c-0.4,0.2-0.8,0.2-1.3,0.2c-0.6,0-1.2-0.2-1.6-0.5c-0.4-0.4-0.6-1-0.6-1.5c0-1.4,1.1-2.1,3.4-2.2h1.2v-0.4c0-0.4-0.1-0.9-0.4-1.2     c-0.3-0.3-0.7-0.4-1.1-0.4c-0.7,0-1.4,0.2-2,0.5l-0.3-0.8c0.4-0.2,0.7-0.3,1.1-0.4c0.4-0.1,0.8-0.2,1.2-0.1     c0.7-0.1,1.3,0.1,1.9,0.6c0.4,0.5,0.7,1.1,0.6,1.8v4.8L422.9,156.2z M420.5,155.5c0.6,0,1.1-0.2,1.5-0.5c0.4-0.4,0.6-1,0.6-1.5     v-0.6l-1,0.1c-0.6,0-1.2,0.1-1.8,0.4c-0.4,0.2-0.6,0.6-0.6,1.1c0,0.3,0.1,0.6,0.4,0.9C419.8,155.4,420.2,155.5,420.5,155.5     L420.5,155.5z" />







                                <path class="st4" d="M418.7,113.4v14.1h-36v-14.1l6.3-17.2h23.5L418.7,113.4z M417.2,113.4l-5.5-15.6h-21.9l-5.5,15.6h11v0.8     c0,3,2.5,5.5,5.5,5.5s5.5-2.5,5.5-5.5v-0.8H417.2z M417.2,115h-9.4c-0.2,1.7-1.1,3.3-2.4,4.5c-2.7,2.4-6.7,2.4-9.4,0     c-1.3-1.1-2.1-2.7-2.4-4.5h-9.4v10.9h32.9L417.2,115z" />







		                                </g>
	                                </g>
                                </g>
                                </svg>
                            </div>
                            <div class="flex">
                                <div data-info="chart" style="display:none">


                                </div>

                                <div class="ct-chart ct-golden-section" data-info="lineChart" style="display:none;"></div>
                            </div>

                        </div>

                    </div>
                    <div class="flex" data-info="data-table-valeus" style="flex-direction: row;justify-content: space-evenly;width: 100%;height: 300px;overflow: auto;text-align: center;">

                        <!--<div style="width:100%;display:grid;">
                            <span style="float: left; margin-right: 0; font-size: 12px; color: #ffffffff;font-weight: normal;" class="ValueStyle">
                                Last Motion
                            </span>
                            <span style="font-size: 15.5px ;color: #68a5ca;font-weight: 900;" data-value="updateTime">--</span>
                        </div>

                        <div style="width:100%;display:grid;">
                            <span style="float: left; margin-right: 0; font-size: 12px; color: #ffffffff;font-weight: normal;" class="ValueStyle">
                                Bait Changed
                            </span>
                            <span style="font-size: 15.5px; color:#68a5ca;font-weight: 900;" data-value="LastSetDate">--</span>
                        </div>

                        <div style="width:100%;display:grid;">
                            <span style="font-size: 12px; width: 100%; color: #ffffffff;font-weight: normal;" class="ValueStyle">
                                Last Set Date
                            </span>
                            <span style="font-size: 15.5px; color:#68a5ca;font-weight: 900;" data-value="SetTimeFormatted">--</span>
                        </div>-->
                        <table style="width:100%" data-info="resultTable">
                        </table>
                    </div>
                </div>
                <div data-section="Actions">
                    <div data-section="OrdinaryDevice" style="display:none">
                        <div class="row">
                            <div style="margin:3%;" data-section="ordinaryFormBtn">
                                <div class="row">
                                    <a href="#" class="selectBtn fullWidth" data-button="manualLog" onclick="UpdateManual(event)">
                                        Set Thresholds
                                    </a>
                                </div>
                                <div class="row">
                                    <a href="#" class="selectBtn fullWidth" style="display:none" data-button="resetIR" onclick="ActivateManual(event)">
                                        Observation
                                    </a>
                                </div>
                                <div class="row">
                                    <a href="#" class="selectBtn fullWidth" style="display:none" data-button="noActivityBtn" onclick="NoActivity(event)">
                                        No Activity
                                    </a>
                                </div>



                            </div>
                        </div>
                    </div>
                    <div data-section="SmartDevice" style="display:none">


                        <div class="row" onclick="event.stopPropagation()">
                            <div class="container-fluid" data-info="btnSmart">
                                <div class="row">
                                    <a href="#" class="selectBtn fullWidth" data-button="addBait" onclick="AddBait(event)">
                                        Add Bait
                                    </a>
                                </div>
                                <div class="row">
                                    <a href="#" class="selectBtn fullWidth" data-button="noActivityBtn" onclick="NoActivity(event)">
                                        No Activity
                                    </a>
                                </div>
                                <div class="row">
                                    <a href="#" class="selectBtn fullWidth" data-button="resetIR" onclick="ResetIR(event)">
                                        Reset Motion Count
                                    </a>
                                </div>

                            </div>
                        </div>


                    </div>
                    <div data-section="formScreen" onclick="event.stopPropagation()" style="background-color: rgb(65, 80, 90); border: 1px solid #bfbfbf; margin-top: 15px; display: none;">

                        <div data-form="formTemp">

                        </div>
                        <div data-form="formThresholds">
                            <label for="checkboxRed" style="
                                color: white;
                                margin: auto;
                                position: relative;
                                left: 19px;
                                top: 10px;
                            ">Red Alert</label>
                            <label style="margin-top: 8px;margin: auto;color: white;margin: auto;position: relative;left: 44px;top: 10px;" for="checkboxRed">Red lower</label>
                            <label class="thresholdsLabel" style="margin-top: 8px;" for="checkboxRed">Red Upper</label>

                            <div class="flex" style="overflow: auto;  ">
                                <div class="toggleposition">
                                    <label class="switch" onclick="CheckToggleRed(this)">
                                        <input type="checkbox" data-value="checkboxRed">
                                        <span data-value="AdvStatus" class="slider round"><span data-value="SelectElement" class="activeToggle">ON</span></span>
                                    </label>
                                </div>
                                <input type="number" class="ThresholdInput" placeholder="Red Lower" data-value="RedAlertLower" />

                                <input type="number" class="ThresholdInput" placeholder="Red Upper" data-value="RedAlertUpper" />

                            </div>
                            <label for="checkboxRed" style="
                                color: white;
                                margin: auto;
                                position: relative;
                                left: 15px;
                             ">Amber Alert</label>
                            <label style="margin-top: 8px;margin: auto;color: white;margin: auto;position: relative;left: 28px;" for="checkboxRed">Amber lower</label>

                            <label class="thresholdsLabel" for="checkboxRed">Amber Upper</label>
                            <div class="flex" style="overflow: auto;  ">

                                <div class="toggleposition">
                                    <label class="switch" onclick="CheckToggleAmber(this)">
                                        <input type="checkbox" data-value="checkboxAmber">
                                        <span data-value="AdvStatus" class="slider round"><span data-value="SelectElement" class="activeToggle">ON</span></span>
                                    </label>
                                </div>
                                <input type="number" class="ThresholdInput" placeholder="Amber Lower" data-value="AmberAlertLower" />
                                <input type="number" class="ThresholdInput" placeholder="Amber Upper" data-value="AmberAlertUpper" />

                            </div>

                            <div class="flex" style=" overflow: auto; display: block; padding: 2%; color: white; ">
                                <p>The lower and upper values are compared as follows;</p>
                                <p>Values within the Amber Lower and Upper are considered Normal Range (Green) and will not alert</p>
                                <p>Values within the Amber Lower and Red Lower OR Within Amber Upper and Red Upper are considered Amber and will alert if they remain for 90 consecutive minutes</p>
                                <p>Values <= Red Lower OR >= Red Upper are considered critical and will alert if they remain for consecutive minutes</p>
                                <p>When the value returns to normal the system will reset the 90min and 15min timer to restart</p>

                            </div>
                            <div class="flex" style="overflow: auto; margin-top:8px;  ">

                                <a data-button="cancelButton" onclick="CancelBait(event)" class="selectBtn" style="margin:0px;width:100%;border-right:1px solid #fff;">
                                    CANCEL
                                </a>
                                <a data-button="submitButton" onclick="submitThreshold(event)" class="selectBtn" style="margin:0px;width:100%;">
                                    SAVE
                                </a>
                            </div>
                        </div>
                        <div data-form="ResetIR">
                            <h2 style="color:white;font-size: 15px;text-align: center;">CONFIRM MOTION COUNT RESET?</h2>
                            <div class="flex" style="overflow: auto; margin-top:8px;  ">
                                <a data-button="cancelButton" class="selectBtn" onclick="ResetIRCancel(event)" style="margin:0px;width:100%;border-right:1px solid #fff;">
                                    CANCEL
                                </a>
                                <a data-button="submitButton" onclick="ResetIRSubmit(event)" class="selectBtn" style="margin:0px;width:100%;">
                                    SAVE
                                </a>
                            </div>
                        </div>
                        <div data-form="noActivity">
                            <h2 style="color:white;font-size: 15px;text-align: center;">CONFIRM NO ACTIVITY?</h2>
                            <div class="flex" style="overflow: auto; margin-top:8px;  ">
                                <a data-button="cancelButton" class="selectBtn" onclick="ResetIRCancel(event)" style="margin:0px;width:100%;border-right:1px solid #fff;">
                                    CANCEL
                                </a>
                                <a data-button="submitButton" onclick="NoActivitySubmit(event)" class="selectBtn" style="margin:0px;width:100%;">
                                    SAVE
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div id="cardTemplate" style="display:none">
        <div>
            <!--Start of Parent Card-->
            <div class="normalCardBorder" onclick="ShowTraps(this)" style="font-family: sans-serif; background-color: #f2f2f2;border-bottom: 3px solid white; padding: 8px; overflow:auto; overflow-x:hidden">
                <div data-section="cell">
                    <div>
                        <div class="container flex" style="margin: 8px 8px 4px 0; ">
                            <div class="col-left" style="border-right: 0.98px solid #9b9b9bff;width:100%;">
                                <div class="iconWidth">
                                    <svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" id="svg29831" version="1.1" viewBox="0 0 40.0 40.0" height="40" width="40">
                                        <g id="layer1">
                                            <g transform="matrix(2.8378539,0,0,3.0447315,4246.9683,1050.7892)"
                                               id="g25379"
                                               style="display:inline">
                                                <g transform="matrix(1.0393596,0,0,1.0918312,-1642.6071,-443.04183)"
                                                   id="g25377">
                                                    <g transform="translate(1.1262887,-2.2625518)"
                                                       id="g25375">
                                                        <rect transform="scale(-1)"
                                                              y="-93.702301"
                                                              x="-152.96861"
                                                              height="1.7513121"
                                                              width="13.561408"
                                                              id="rect25367"
                                                              style="opacity:1;fill:#41505a;fill-opacity:1;stroke:#d74423;stroke-width:0;stroke-linecap:square;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1" />
                                                        <rect style="opacity:1;fill:#2c5aa0;fill-opacity:1;stroke:#d74423;stroke-width:0;stroke-linecap:square;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1"
                                                              id="rect25369"
                                                              width="13.561408"
                                                              height="1.7513121"
                                                              x="-152.96861"
                                                              y="-97.129333"
                                                              transform="scale(-1)" />
                                                        <rect transform="scale(-1)"
                                                              y="-100.55641"
                                                              x="-152.96861"
                                                              height="1.7513121"
                                                              width="13.561408"
                                                              id="rect25371"
                                                              style="opacity:1;fill:#d74423;fill-opacity:1;stroke:#d74423;stroke-width:0;stroke-linecap:square;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1" />
                                                        <rect style="opacity:1;fill:#41505a;fill-opacity:1;stroke:#d74423;stroke-width:0;stroke-linecap:square;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1"
                                                              id="rect25373"
                                                              width="13.561408"
                                                              height="1.7513121"
                                                              x="-152.96861"
                                                              y="-103.98348"
                                                              transform="scale(-1)" />
                                                    </g>
                                                </g>
                                            </g>
                                        </g>
                                    </svg>
                                </div>
                                <!--<div data-info="icon" class="redIcon vertical-center" style="display: inline-block; width: 25px; height: 25px;"></div>-->
                                <div class="vertical-center setupContent">
                                    <div class="row">
                                        <div class="capitalize" data-value="CardName" style="font-weight: bold; font-weight:bold; font-size: 12.5px">
                                            loading...
                                        </div>

                                        <div data-value="CardAddress" style="display:inline-block;word-wrap:break-word;font-size: 10.5px;">
                                            loading...
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div style="float: right; margin-right: -12px; display: flex; width:100%;">

                                <div class="displayContainer" style=" text-align: center;margin-left: 10px; width:100%;">
                                    <span class="ValueStyle" data-value="Urgent">
                                        --
                                    </span>
                                    <div class="UnderlineRed" style="width:100%">
                                        <span data-value="status1Pos" class="underlineIndicatorCenter"></span>
                                    </div>
                                    <span class="LabelStyle" data-info="lbl1">URGENT</span>
                                </div>

                                <div class="displayContainer" style="text-align: center;margin-left: 10px;width:100%;">
                                    <span class="ValueStyle" data-value="Important">
                                        --
                                    </span>
                                    <div class="UnderlineOrange" style="width:100%">
                                        <span data-value="status2Pos" class="underlineIndicatorCenter"></span>
                                    </div>
                                    <span class="LabelStyle" data-info="lbl2">IMPORTANT</span>
                                </div>

                                <div class="displayContainer" style="text-align: center;margin-left: 10px;width:100%; margin-right:2%;">
                                    <span class="ValueStyle" data-value="Minor">
                                        --
                                    </span>
                                    <div class="UnderlineGreen" style="width:100%">
                                        <span data-value="status3Pos" class="underlineIndicatorCenter"></span>
                                    </div>
                                    <span class="LabelStyle" data-info="lbl3">MINOR</span>
                                </div>

                            </div>

                        </div>
                    </div>
                </div>
            </div>
            <!--End of Parent Card-->


            <div data-selector="Traps" style="display:none;">

            </div>

        </div>
    </div>
    <script src="api/DataTypes.js"></script>
    <script src="api/Database.js"></script>
    <script src="api/Script.js"></script>
    <script src="api/Utils.js"></script>
    <script src="api/Client.js"></script>

    <script src="api/ClientEvents.js"></script>
    <script src="js/line_chart/chartist.min.js"></script>
    <script src="js/utilities.js"></script>


    <script>
        "use strict";

        var options = {
            settings: {
                "category": "widget",
                "type": window.location.pathname.split("/").slice(-1)[0].split(".")[0].replace("%20", " "),
                "iniHeight": parseInt(widget.style.height),
                "iniWidth": parseInt(widget.style.width),
                "author": "Sensavation",
                "tbTooltip": "Display data by column/row",
                "tooltip": "",
                "version": "190104",
                "group": "forms",
                "zIndex": "ZINDEX_DEFAULT",
                "disabled": false,
                "scaling": true,
                "help": "card"
            },
            clientEvents: {
                inputEvents: {
                    "receive value": receive_value,
                    "receive headers": receive_headers,
                    "set technicians": settechnicians,
                    "set trap type": setTrapTypes,
                    "set animals": setAnimals,
                    "set alert": setAlertEvent,
                    "toggle card": toggleCardEvent,
                    "set new photo status": newPhotoEvent,
                    "sort": sortEvent,
                    "filter": filterCards,
                    "set baits": setBaits,
                    "set baitTypes": setBaitTypes,
                    "set Quantities": setQuantities,
                    "set report log": incomingLogMessage,
                    "clear content": clearContent,
                    "set thresholds": setTresholds,
                    "end of day check": endOfDayCheck,
                    "change visible counter": ChangeCardHeaderType,
                    "change view pointer": ChangeCardPointer,
                    "toggle child": ToggleChild,
                    "DisableToggle": DisableToggle


                },
                outputEvents: ["deactivate trap", "address pressed", "set trap", "check trap", "clear trap", "photo icon pressed", "children populated"]
            },
            serverEvents: {
                inputEvents: {
                    "feed": {
                        "function": fw_feed
                    },
                    "history": {
                        "function": fw_history,

                    }
                },
                outputEvents: [
                    "smtpclient"
                ]
            },
            dataTypes: {
                "feed": ["sensacollection", "number", "string"],
                "retValue": ["array"],
                "history": ["array"]

            },
            attribs: {

            }
        };
        //#endregion
        //#region --- Declarations ---
        var battery = document.getElementById("battery");
        var numVal = document.getElementById("numVal");
        //#endregion
        // Look at having a circular array incase the buffer gets too big. Will be an issue if page is left open for weeks.
        var tableBody = document.getElementById("tbody");
        var cardTemplate = document.getElementById("cardTemplate");
        var cardChildTemplate = document.getElementById("cardChildTemplate");

        var weekday = new Array(7);
        weekday[1] = "Mon";
        weekday[2] = "Tue";
        weekday[3] = "Wed";
        weekday[4] = "Thu";
        weekday[5] = "Fri";
        weekday[6] = "Sat";
        weekday[0] = "Sun";
        var ActiveDatasource;
        var rowStateHeaders = {};
        var SelectedVisibleState = 1;
        var rowElems = {};
        var rowHeaderElemVals = {};
        var rowHeaderElems = {};
        var rowState = {};
        var trapTypesObj = {};
        var animalsObj = {};
        var technicianObj = {};
        var SelectVlueObj = {};
        var cardSelected;
        var cardSelectedParent;
        var BindingBaitDetails;
        var areaReport = [];
        var activeDropdowndataSources = [];
        var BaitDetailId;
        var BaitTypeId;
        var rowKeys;
        var lastHeader;
        var baitThreshold;
        var baitThresholdUpper;
        var triggerTreshold;
        var triggerTresholdUpper;
        var activeCards = [];
        var _Id;
        var _TimeSeriesData;
        var _DaysSeries;
        var timeBack = 1;
        var sensorUpper = 6.3;
        var sensorLower = 3.7;
        var toggleState = true;
        var ToggleDisabled = true;

        Date.prototype.addDays = function (days) {
            var date = new Date(this.valueOf());
            date.setDate(date.getDate() + days);
            return date;
        }

        Date.prototype.substractDays = function (days) {
            var date = new Date(this.valueOf());
            date.setDate(date.getDate() - days);
            return date;
        }

        function pad(number) {
            if (number < 10) {
                return '0' + number;
            }
            return number;
        }


        //#region --- Declarations ---

        function setAlertEvent(eventData) {
            if (typeof eventData.value !== "string") {

                throw new TypeError("Expected a string but found " + typeof eventData.value);
            }

            var card = rowElems[eventData.value];

            if (card === undefined) {

                throw new Error("No card exists with the primary key '" + eventData.value + "'");
            }


            card.parentElement.parentElement.classList = [];
            card.parentElement.parentElement.classList.add("alertBorder");

        }

        function OpenActions(event) {

            var id = event.currentTarget.parentElement.parentElement.parentElement.parentElement.parentElement.getAttribute("data-id");
            if (rowState[id].DeviceType == "1") {

                event.currentTarget.parentNode.parentNode.querySelector("[data-section='OrdinaryDevice']").style.setProperty("display", "none");
                event.currentTarget.parentNode.parentNode.querySelector("[data-section='SmartDevice']").style.setProperty("display", "");
            }
            else {
                event.currentTarget.parentNode.parentNode.querySelector("[data-section='OrdinaryDevice']").style.setProperty("display", "");
                event.currentTarget.parentNode.parentNode.querySelector("[data-section='SmartDevice']").style.setProperty("display", "none");
            }

            event
                .currentTarget
                .parentNode
                .parentNode
                .querySelector("[data-section='DeviceInfo']")
                .style.setProperty("display", "none");
            event
                .currentTarget
                .parentNode
                .parentNode
                .querySelector("[data-section='Actions']")
                .style.setProperty("display", "");
            event
                .currentTarget
                .parentNode
                .parentNode
                .querySelector("[data-info='btnActions']")
                .setAttribute("class", "tabBtnSelected");
            event
                .currentTarget
                .parentNode
                .parentNode
                .querySelector("[data-info='btnInfo']")
                .setAttribute("class", "tabBtn");
        }

        function OpenDeviceInfo(event) {

            event.currentTarget
                .parentNode
                .parentNode
                .querySelector("[data-section='Actions']")
                .style
                .setProperty("display", "none");
            event
                .currentTarget
                .parentNode
                .parentNode
                .querySelector("[data-section='DeviceInfo']")
                .style.setProperty("display", "");
            event
                .currentTarget
                .parentNode
                .parentNode
                .querySelector("[data-info='btnInfo']")
                .setAttribute("class", "tabBtnSelected");
            event
                .currentTarget
                .parentNode
                .parentNode
                .querySelector("[data-info='btnActions']")
                .setAttribute("class", "tabBtn");
        }

        function newPhotoEvent(eventData) {
            if (typeof eventData.value !== "string") {

                throw new TypeError("Expected a string but found " + typeof eventData.value);
            }

            var card = rowElems[eventData.value];

            if (card === undefined) {

                throw new Error("No card exists with the primary key '" + eventData.value + "'");
            }

            //card.querySelector("[data-section='photo']").style.setProperty("display", "");
            card.parentElement.parentElement.classList = [];
            if (!card.parentElement.parentElement.classList.contains('alertBorder')) {
                //card.parentElement.parentElement.classList.add("newPhotoBorder");
            }
        }

        /**
         * takes an array of ids and hides all other cards.
         *
         * @param eventData
         */
        function filterCards(eventData) {
            if (eventData.value === undefined) {
                // error

                throw new Error("Filter expected a client event object.");
                return;
            }

            if (!Array.isArray(eventData.value)) {

                throw new TypeError("Filter must be an array. Found " + typeof eventData.value);
                return
            }

            var children = tbody.children;

            for (var i = 0; i < children.length; i++) {
                if (eventData.value.length === 0) {
                    children[i].style.setProperty("display", "");
                } else if (eventData.value.indexOf(children[i].getAttribute("data-id")) === -1) {
                    children[i].style.setProperty("display", "none");
                } else {
                    children[i].style.setProperty("display", "");
                }
            }

        }


        /**
         * When the address is clicked in a card the card will broadcast an event with the given ID.
         * @param event
         */
        function addressEvent(event) {
            // get card id
            var id = event.currentTarget.parentElement.parentElement.parentElement.parentElement.parentElement.parentElement.parentElement.getAttribute("data-id");
            fw.fireEvent("address pressed", id);
            event.stopPropagation();
        }


        /**
         * Sets all the trap options available for the card.
         *
         * @param packet
         */
        function setTrapTypes(packet) {
            var values = packet;
            if (typeof packet === "object" && packet.value !== undefined) {
                values = packet.value;
            }

            if (!Array.isArray(values)) {

                throw new TypeError("set trap type event expected an array but found '" + typeof values + "'.");
            }
            SetSelectValues(values, "trapType");

        }


        function setQuantities(packet) {


            var values = packet;

            var vals = PackageData(values);
            activeDropdowndataSources.push({

                Name: "Quantity",
                Values: packet.value
            });
            SetSelectValues(vals, "Quantity");
        }

        function setBaitTypes(packet) {

            var values = packet;
            if (typeof packet === "array" && packet.value !== undefined) {
                values = packet.value;
            }

            var vals = PackageData(values);

            activeDropdowndataSources.push({

                Name: "BaitType",
                Values: packet.value
            });
            SetSelectValues(vals, "BaitType");

        }
        /**
       * Sets all the bait Detail available for the card dropdown.
       *
       * @param packet
       */
        function setBaits(packet) {

            var values = packet.value;
            BindingBaitDetails = packet.value;


            var sending = [];
            values.forEach(x => {
                if (x.Type === 2)
                    sending.push(x.Name);
            });

            activeDropdowndataSources.push({

                Name: "Baits",
                Values: values
            });
            SetSelectValues(sending, "Baits");
        }

        function PackageData(incoming) {

            var sending = [];
            incoming.value.forEach(x => {
                sending.push(x.Name);
            });
            return sending;
        }
        /**
         * Sets all the technicians available for the card dropdown.
         *
         * @param packet
         */
        function settechnicians(packet) {
            var values = packet;
            if (typeof packet === "object" && packet.value !== undefined) {
                values = packet.value;
            }

            if (!Array.isArray(values)) {

                throw new TypeError("set technicians event expected an array but found '" + typeof values + "'.");
            }
            var vals = PackageData(values);
            activeDropdowndataSources.push({

                Name: "technician",
                Values: packet.value
            });
            SetSelectValues(vals, "technician");
        }

        function SetSelectValues(values, elementName) {

            SelectVlueObj = {};
            var joinArray = [];
            var optionsArray = [];
            for (var i = 0; i < values.length; i++) {
                if (SelectVlueObj[values[i]] === undefined) {
                    joinArray.push(values[i]);
                }
            }

            for (var i = 0; i < joinArray.length; i++) {
                var opElem = document.createElement("option");
                opElem.innerHTML = joinArray[i];
                opElem.value = joinArray[i];
                optionsArray.push(opElem)
                SelectVlueObj[joinArray[i]] = opElem;
            }

            var select = cardChildTemplate.querySelector("[data-select='" + elementName + "']");
            for (var i = 0; i < optionsArray.length; i++) {
                select.appendChild(optionsArray[i]);
            }
            var rowKeys = Object.keys(rowElems);


            for (var i = 0; i < rowKeys.length; i++) {
                var row = rowElems[rowKeys[i]];
                var selectNode = row.querySelector("[data-select='" + elementName + "']");

                // If no trap types have been added we need to add them all.
                if (selectNode.children.length === 1) {
                    var opKeys = Object.keys(SelectVlueObj);
                    for (var k = 0; k < opKeys.length; k++) {
                        var key = opKeys[k];
                        selectNode.appendChild(SelectVlueObj[key].cloneNode(true));
                    }
                } else {
                    if (elementName === "Baits") {
                        selectNode.innerHTML += "<option value=\"default\" disabled selected>Select Bait Detail</option>";
                    }
                    for (var j = 0; j < optionsArray.length; j++) {
                        selectNode.appendChild(optionsArray[j].cloneNode(true));
                    }
                }
            }
        }

        function ShowMap(event) {

            var id;
            if (cardSelected === undefined || cardSelected === null) {
                id = event.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.getAttribute("data-id");
            }
            else {
                id = cardSelected.parentNode.getAttribute("data-id");
            }

            var currentItem = ActiveDatasource[id]
            var popupTemplate = Script.getScriptElement("popup");
            // popupTemplate.querySelector("[data-value='title']").innerHTML = currentItem[16];
            var icon = popupTemplate.querySelector("[data-value='icon']");
            var state = rowState[id].State;
            var name = rowState[id].DeviceNumber;
            var sideStatus = popupTemplate.querySelector("[data-info='SideBarStatus'");

            if (state === 3) {
                sideStatus.setAttribute("class", "normalCardBorder SideBarRed")

            }
            else if (state === 2) {
                sideStatus.setAttribute("class", "normalCardBorder SideBarGreen")
            }
            else if (state === 4) {
                sideStatus.setAttribute("class", "normalCardBorder SideBarYellow")
            }
            else {
                sideStatus.setAttribute("class", "normalCardBorder SideBarGreen")
            }

            popupTemplate.querySelector("[data-value='DeviceNumber']").innerHTML = name;
            popupTemplate.querySelector("[data-value='BaitName']").innerHTML = "Bait Type: " + currentItem[23] + " " + currentItem[24];


            // popupTemplate.querySelector("[data-value='status']").innerHTML = "Device Status: " + currentItem[1];
            //   popupTemplate.querySelector("[data-value='emptyBy']").innerHTML = "Empty By: " + currentItem[14];
            //  popupTemplate.querySelector("[data-value='battery']").innerHTML = "Battery level: " + currentItem[21] + "%";
            var location = currentItem[10];
            var coords = location.split(',');
            var bindingItem = {
                "title": currentItem[0],
                "loc": {
                    "lat": parseFloat(coords[0]),
                    "lng": parseFloat(coords[1])
                },
                "label": currentItem[0],
                "content": popupTemplate,
                "id": name
            };
            var eventData = {
                "value": bindingItem
            }
            var focusData = {

                "value": {
                    lng: parseFloat(coords[1]),
                    lat: parseFloat(coords[0])
                }
            };
            fw.func("PUBLISHCLIENT", "CUSTOM", eventData);
            fw.func("PUBLISHCLIENT", "set-map", focusData);



            //  fw.func("PUBLISHCLIENT", "POPZOOM", zoompacket);
            fw.func("JUMPSCREEN", "Map");

            //    fw.func("PUBLISHCLIENT", "POPZOOM", zoompacket);
        }

        function toggleCardEvent(packet) {

            var id = packet.value;
            if (typeof id !== "string") {
                return;
            }

            if (rowHeaderElems[id] === undefined) {
                return;
            }
            _Id = id;
            TrapSelected(rowHeaderElems[id]);
        }

        function ToggleChild(packet) {

            var id = packet.value;
            if (typeof id !== "string") {
                return;
            }

            if (rowState[id] === undefined) {
                return;
            }
            _Id = id;
            var row = rowState[id];

            toggleClearScreen(row["Card"]);
            Script.setState("barcodeId", "0", true);

        }

        function DisableToggle(eventData) {
            ToggleDisabled = false;
        }

        /**
         * Sets all the animals available for the card.
         *
         * @param packet
         */
        function setAnimals(packet) {
            var values = packet;
            if (typeof packet === "object" && packet.value !== undefined) {
                values = packet.value;
            }

            if (!Array.isArray(values)) {

                throw new TypeError("set animals event expected an array but found '" + typeof values + "'.");
            }

            var optionsArray = [];
            var joinArray = [];

            for (var i = 0; i < values.length; i++) {
                if (animalsObj[values[i]] === undefined) {
                    joinArray.push(values[i]);
                }
            }

            for (var i = 0; i < joinArray.length; i++) {
                var opElem = document.createElement("option");
                opElem.innerHTML = joinArray[i];
                opElem.value = joinArray[i];
                optionsArray.push(opElem)
                animalsObj[joinArray[i]] = opElem;
            }


        }

        /**
         * Shows the dropdown menu screen.
         *
         * @param event
         */
        function showFormScreen(event) {

            event.currentTarget.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.querySelector("[data-section='formScreen']").style.setProperty("display", "");;
            event.currentTarget.parentNode.parentNode.style.setProperty("display", "none");

            var container = document.getElementById("container");
            // Offset is the amount of the card that is hidden.
            var offset = (cardSelected.offsetTop + cardSelected.offsetHeight - container.scrollTop) - container.offsetHeight;
            // Set the container scroll top so the bottom of the card is at the bottom of the container.
            container.scrollTop += offset;
            if (1 > container.offsetHeight) {
                container.scrollTop = cardSelected.offsetHeight + cardSelected.offsetTop;
            }
            event.stopPropagation();
        }



        /**
         * Closes the downdown menu screen.
         * @param event
         */
        function cancelFormScreen(event) {
            var id = cardSelected.parentNode.parentNode.getAttribute("data-id");
            //   setState(id, rowState[id].State);
            cardSelected.querySelector("[data-section='formScreen']").style.setProperty("display", "none");
            event.stopPropagation();
        }



        /**
         * Deactivates a trap
         * @param event
         */
        function deactivateTrap(event) {
            // get trap ID
            var id = cardSelected.parentNode.parentNode.getAttribute("data-id");
            // build sensacollection of card
            setState(id, 1);
            fw.fireEvent("deactivate trap", rowState[id]);

        }

        function clearContent(packet) {
            rowHeaderElems = [];
            var getParent = document.getElementById("tbody");
            getParent.innerHTML = "";
        }

        /**
        * Takes in a packet that sets the rodent grid threshold values that are reponsible to handle card statuses
        * @param packet
        */
        function setTresholds(packet) {

            var current;
            for (var val in packet.value.value.data) {
                current = packet.value.value.data[val];
                var currentVal = current[0].split(",");
                switch (currentVal[0]) {

                    case "baitLower":
                        baitThreshold = parseInt(currentVal[1]);
                        break;
                    case "baitUpper":
                        baitThresholdUpper = parseInt(currentVal[1]);
                        break;
                    case "sensorEntrance":
                        triggerTreshold = parseInt(currentVal[1]);
                        break;
                    case "sensorUpper":
                        triggerTresholdUpper = parseInt(currentVal[1]);
                        break;
                }
            }

        }

        function endOfDayCheck(eventData) {
            rowState[rowKeys[i]][headerValue]

            for (var row in rowState) {

                var dbVal = {};
                dbVal[row["Id"]] = {
                    "Id": row["Id"],
                    "Hours": parseInt(row["Hours"]) - 1
                };

                // Update a record's values, Fails if the record does not exist.
                Database.updateRecord("Rodent", "Traps", dbVal, function (data) {

                });
            }

        }

        function GetRowBySid(sid) {
            for (var row in rowState) {
                if (rowState[row]["Sid"] === sid) {
                    return rowState[row];
                }
            }

            return null;
        }
        function GetRowByDeviceName(name) {
            for (var row in rowState) {
                if (rowState[row]["Name"].toUpperCase() === name.toUpperCase()) {
                    return rowState[row];
                }
            }

            return null;
        }
        function incomingLogMessage(packet) {

            var data = packet.value;
            areaReport.push(data);
        }

        function BaitDetailChanged(event) {

            BaitDetailId = event.value;
        }

        function baitChanged(event) {

            BaitTypeId = event.value;
            var id = cardSelected.parentNode.getAttribute("data-id");
            var card = rowElems[id];
            var sending = [];
            var selected;
            card.querySelector("[data-select='Baits']").innerHTML = "";
            var types;

            activeDropdowndataSources.forEach(x => {
                if (x.Name === "BaitType") {
                    types = x;
                }
            });

            types.Values.forEach(x => {
                if (x.Name === BaitTypeId) {
                    selected = x.Id;
                }
            });

            BindingBaitDetails.forEach(x => {
                if (x.Type === selected) {
                    sending.push(x.Name);
                }
            });
            SetSelectValues(sending, "Baits");
        }


        function NoActivitySubmit(event) {

            var id = cardSelected.parentNode.getAttribute("data-id");
            var val = rowState[id].Id;

            rowElems[id].querySelector("[data-value='Hours']").innerHTML = 0;
            rowState[id].SetTime = new Date();
            var d = rowState[id].SetTime.toLocaleString().split(", ");
            var d0 = d[0].split("/");
            d0[2] = d0[2] - 2000;
            d0 = d0.join("/");
            rowElems[id].querySelector("[data-value='Dial']").innerHTML = "--";

            // rowElems[id].querySelector("[data-select='Quantity']").innerHTML = "--";
            //   rowElems[id].querySelector("[data-value='Status']").innerHTML = "Active";
            var dbVal = {};
            dbVal[val] = {
                "Id": val,
                "Hours": "0",
                "BaitRate": baitThresholdUpper + 1,
                "Status": "Active",
                "UpdateTime": new Date()

            };
            rowState[id]["Hours"] = 0;
            // Update a record's values, Fails if the record does not exist.
            Database.updateRecord("Rodent", "Traps", dbVal, function (data) {

            });
            var card = rowState[id]["Card"];
            rowElems[id].querySelector("[data-info='UnderlineHours']").setAttribute("class", "UnderlineGreen");
            // rowElems[id].querySelector("[data-info='UnderlineBattery']").setAttribute("class", "UnderlineGreen");
            rowElems[id].querySelector("[data-info='UnderlineBait']").setAttribute("class", "UnderlineGreen");
            rowElems[id].querySelector("[data-info='UnderlineSignal']").setAttribute("class", "UnderlineGreen");
            sortEvent({
                value: [
                    "sstatus",
                    "false"
                ]
            });
            cardSelected.querySelector("[data-section='clearScreen']").style.setProperty("display", "none");
            cardSelected.querySelector("[data-info='btnSmart']").style.setProperty("display", "");
            cardSelected.querySelector("[data-section='clearScreen']").querySelector("[data-section='Actions']").querySelector("[data-section='ordinaryFormBtn']").style.setProperty("display", "");

        }

        function ViewAdvisories(event) {

            var id = cardSelected.parentNode.parentNode.getAttribute("data-id");
            var val = rowState[id].Id;
            ClientEvents.publish("CardAdvisoryClicked", val);
        }

        function UpdateAdvisories(event) {
            var id = cardSelected.parentNode.parentNode.getAttribute("data-id");
            var state = rowState[id].State;
            var val = rowState[id].Id;
            Script.setState("CallbaackPage", "Rodent Grid");
            Script.setState("TrapId", val);

            fw.func("JUMPSCREEN", "Book Advisory");

        }

        function ActivateManual(event) {
            var id = cardSelected.parentNode.getAttribute("data-id");
            var val = rowState[id].Id;

            rowState[id].checkTime = new Date();
            var d = rowState[id].checkTime.toLocaleString().split(", ");
            var d0 = d[0].split("/");
            d0[2] = d0[2] - 2000;
            d0 = d0.join("/");

            //rowElems[id].querySelector("[data-value='SignalStatus']").innerHTML = "Rodent Activity";
            //      rowElems[id].querySelector("[data-value='Status']").innerHTML = "Manual Device triggered";
            rowState[id]["sstatus"] = 4;

            rowElems[id].querySelector("[data-value='SetTimeFormatted']").innerHTML = d[1] + "<br />" + d0;
            //  rowElems[id].querySelector("[data-value='updateTimeFormatted']").innerHTML = d[1] + "<br />" + d0;
            rowElems[id].querySelector("[data-info='UnderlineHours']").setAttribute("class", "UnderlineRed");
            rowElems[id].querySelector("[data-info='UnderlineBattery']").setAttribute("class", "UnderlineRed");
            rowElems[id].querySelector("[data-info='UnderlineBait']").setAttribute("class", "UnderlineRed");
            rowElems[id].querySelector("[data-info='UnderlineSignal']").setAttribute("class", "UnderlineRed");



            areaReport.push({
                "CardName": id,
                "Message": "Card " + id + " Manual Trap triggered, rodent activity.",
                "DateTime": new Date(),
            });

            var dbVal = {};
            dbVal[val] = {
                "Id": val,
                "SignalStatus": "Rodent Activity.",
                "Status": "Rodent Activity",
                "BaitRate": baitThreshold - 1,
                "Hours": triggerTresholdUpper + 1,
                "State": 3,
                "SetTime": new Date(),
                "SignalStrenght": 0
            };
            // Update a record's values, Fails if the record does not exist.
            Database.updateRecord("Rodent", "Traps", dbVal, function (data) {

            });
            setState(id, 3);
            sortEvent({
                value: [
                    "sstatus",
                    "false"
                ]
            });
            cardSelected.querySelector("[data-section='clearScreen']").style.setProperty("display", "none");
            cardSelected.querySelector("[data-info='btnSmart']").style.setProperty("display", "");
            cardSelected.querySelector("[data-section='clearScreen']").querySelector("[data-section='Actions']").querySelector("[data-section='ordinaryFormBtn']").style.setProperty("display", "");

        }

        function ResetIRSubmit(event) {

            var id = cardSelected.parentNode.getAttribute("data-id");
            var state = rowState[id].State;
            var val = rowState[id].Id;

            rowElems[id].querySelector("[data-value='Hours']").innerHTML = 0;
            cardSelected.querySelector("[data-info='UnderlineHours']").setAttribute("class", "UnderlineGreen");


            //Script.publishToChannel(channel);
            fw.func("PUBLISHSVR", "$NET/EMAIL/SMTPCLIENT/SEND", JSON.stringify({
                "recipients": ["kristiformilchev615@gmail.com"], "subject": "Motion counter reset", "body": " This a system generated message."
            }), "Email");
            rowState[id].SetTime = new Date();
            var d = rowState[id].SetTime.toLocaleString().split(", ");
            var d0 = d[0].split("/");
            d0[2] = d0[2] - 2000;
            d0 = d0.join("/");
            rowState[id]["Hours"] = 0;
            //    rowElems[id].querySelector("[data-value='Status']").innerHTML = "IR Reset";
            var dbVal = {};
            dbVal[val] = {
                "Id": val,
                "Hours": "0",
                "EntranceSensor": "0",
                "ExitSensor": "0",


            };

            // Update a record's values, Fails if the record does not exist.
            Database.updateRecord("Rodent", "Traps", dbVal, function (data) {

            });
            setDeviceStatus(id);
            sortEvent({
                value: [
                    "sstatus",
                    "false"
                ]
            });

            cardSelected.querySelector("[data-section='clearScreen']").style.setProperty("display", "none");
            cardSelected.querySelector("[data-info='btnSmart']").style.setProperty("display", "");
            cardSelected.querySelector("[data-section='clearScreen']").querySelector("[data-section='Actions']").querySelector("[data-section='ordinaryFormBtn']").style.setProperty("display", "");

        }

        /**
        * Disables a device setting the status to innactive
        *
        * @param event
        */
        function DisableTrap(event) {
            var id = cardSelected.parentNode.parentNode.getAttribute("data-id");
            var val = rowState[id].Id;

            rowState[id].SetTime = new Date();
            var d = rowState[id].SetTime.toLocaleString().split(", ");
            var d0 = d[0].split("/");
            d0[2] = d0[2] - 2000;
            d0 = d0.join("/");

            rowElems[id].querySelector("[data-value='SetTimeFormatted']").innerHTML = d[1] + "<br />" + d0;
            setState(id, 1);

            areaReport.push({
                "CardName": id,
                "Message": "Card " + id + " event: IR Resetted!",
                "DateTime": new Date(),
            });
            var dbVal = {};
            dbVal[val] = {
                "Id": val,
                "State": 1,
                "BaitRate": 100,
                "Status": "Device Disabled",
                "Alert": "",
                "EmptyBy": new Date(),
                "SignalStatus": "",
                "SetTime": new Date(),
                "SignalStrenght": 0
            };
            // Update a record's values, Fails if the record does not exist.
            Database.updateRecord("Rodent", "Traps", dbVal, function (data) {

            });

            fw.fireEvent("set trap", rowState[id]);


            areaReport.push({
                "CardName": id,
                "Message": "Card " + id + " been cleared",
                "DateTime": new Date(),
            });

            setDeviceStatus(id);
            sortEvent({
                value: [
                    "sstatus",
                    "false"
                ]
            });

            fw.fireEvent("clear trap", rowState[id]);
            cardSelected.querySelector("[data-section='clearScreen']").style.setProperty("display", "none");
            cardSelected.querySelector("[data-info='btnSmart']").style.setProperty("display", "");
            cardSelected.querySelector("[data-section='clearScreen']").querySelector("[data-section='Actions']").querySelector("[data-section='ordinaryFormBtn']").style.setProperty("display", "");

        }


        /**
         * Broadcasts an event when a trap is set or cleared.
         *
         * @param event
         */
        function submitThreshold(event) {

            var id = cardSelected.parentNode.getAttribute("data-id");
            var val = rowState[id].Id;

            rowState[id].checkTime = new Date();
            var d = rowState[id].checkTime.toLocaleString().split(", ");
            var d0 = d[0].split("/");
            d0[2] = d0[2] - 2000;
            d0 = d0.join("/");

            var redLower = cardSelected.querySelector("[data-value='RedAlertLower']").value;
            var redUpper = cardSelected.querySelector("[data-value='RedAlertUpper']").value;
            var amberLower = cardSelected.querySelector("[data-value='AmberAlertLower']").value;
            var amberUpper = cardSelected.querySelector("[data-value='AmberAlertUpper']").value;
            var redAlert = GetAlertStatus(cardSelected.querySelector("[data-value='checkboxRed']").checked);
            var amberAlert = GetAlertStatus(cardSelected.querySelector("[data-value='checkboxAmber']").checked);
            rowState[id].RedLower = redLower;
            rowState[id].RedUpper = redUpper;
            rowState[id].AmberLower = amberLower;
            rowState[id].AmberUpper = amberUpper;
            rowState[id].RedEnabled = redAlert
            rowState[id].AmbeEnabled = amberAlert;
            if (!ValidateThresholds()) {
                return;
            }

            //   rowElems[id].querySelector("[data-value='LastUpdate']").innerHTML = d[1] + "<br />" + d0;

            fw.fireEvent("check trap", rowState[id]);

            var dbVal = {};


            dbVal[val] = {
                "Id": val,
                "RedLower": redLower,
                "RedUpper": redUpper,
                "AmberLower": amberLower,
                "AmberUpper": amberUpper,
                "RedEnabled": redAlert,
                "AmberEnabled": amberAlert
            };


            // Update a record's values, Fails if the record does not exist.
            Database.updateRecord("refrigerations", "Device", dbVal, function (data) {

            });

            sortEvent({
                value: [
                    "sstatus",
                    "false"
                ]
            });


            cardSelected.querySelector("[data-section='clearScreen']").style.setProperty("display", "none");
            cardSelected.querySelector("[data-info='btnSmart']").style.setProperty("display", "");
            cardSelected.querySelector("[data-section='clearScreen']").querySelector("[data-section='Actions']").querySelector("[data-section='ordinaryFormBtn']").style.setProperty("display", "");

        }

        function ValidateThresholds() {

            var redLower = cardSelected.querySelector("[data-value='RedAlertLower']").value;
            var redUpper = cardSelected.querySelector("[data-value='RedAlertUpper']").value;
            var amberLower = cardSelected.querySelector("[data-value='AmberAlertLower']").value;
            var amberUpper = cardSelected.querySelector("[data-value='AmberAlertUpper']").value;

            if (redLower === "") {
                Client.invokeModal("OK", "Validation Error", "Red lower is required");
                return false;
            }

            if (redUpper === "") {
                Client.invokeModal("OK", "Validation Error", "Red upper is required");
                return false;
            }

            if (amberLower === "") {
                Client.invokeModal("OK", "Validation Error", "Amber lower is required");
                return false;
            }

            if (amberUpper === "") {
                Client.invokeModal("OK", "Validation Error", "Amber Upper is required");
                return false;
            }

            return true;
        }


        function GetAlertStatus(current) {
            if (!current) {
                return 1;
            }

            return 0;
        }

        function CheckToggleRed(eventData) {


            var currentToggle = eventData.querySelector("[data-value='checkboxRed']").checked;

            if (currentToggle === true) {

                eventData.parentElement.querySelector("[data-value='SelectElement']").setAttribute("class", "inactiveToggle2");
                eventData.parentElement.querySelector("[data-value='SelectElement']").innerHTML = "Off";

            }
            else if (currentToggle === false) {

                eventData.parentElement.querySelector("[data-value='SelectElement']").setAttribute("class", "activeToggle ");
                eventData.parentElement.querySelector("[data-value='SelectElement']").innerHTML = "On";

            }

        }

        function CheckToggleAmber(eventData) {


            var currentToggle = eventData.querySelector("[data-value='checkboxAmber']").checked;

            if (currentToggle === true) {

                eventData.parentElement.querySelector("[data-value='SelectElement']").setAttribute("class", "inactiveToggle2");
                eventData.parentElement.querySelector("[data-value='SelectElement']").innerHTML = "Off";

            }
            else if (currentToggle === false) {

                eventData.parentElement.querySelector("[data-value='SelectElement']").setAttribute("class", "activeToggle ");
                eventData.parentElement.querySelector("[data-value='SelectElement']").innerHTML = "On";

            }

        }
        function NoActivity(current) {
            var screenForm = current.currentTarget.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.querySelector("[data-section='formScreen']");
            screenForm.querySelector("[data-form='formThresholds']").style.setProperty("display", "none");
            screenForm.querySelector("[data-form='ResetIR']").style.setProperty("display", "none");
            screenForm.querySelector("[data-form='noActivity']").style.setProperty("display", "");
            showFormScreen(current);
        }

        function ResetIR(current) {
            var screenForm = current.currentTarget.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.querySelector("[data-section='formScreen']");
            screenForm.querySelector("[data-form='formThresholds']").style.setProperty("display", "none");
            screenForm.querySelector("[data-form='noActivity']").style.setProperty("display", "none");
            screenForm.querySelector("[data-form='ResetIR']").style.setProperty("display", "");
            showFormScreen(current);

        }

        function ResetIRCancel(current) {

            current.currentTarget.parentNode.parentNode.parentNode.parentNode.parentNode.style.setProperty("display", "none");
            event.currentTarget.parentNode.parentNode.parentNode.parentNode.querySelector("[data-info='btnSmart']").style.setProperty("display", "");
            cardSelected.querySelector("[data-section='clearScreen']").querySelector("[data-section='Actions']").querySelector("[data-section='ordinaryFormBtn']").style.setProperty("display", "");

        }

        function AddBait(current) {

            event.currentTarget.parentNode.parentNode.style.setProperty("display", "");

            var screenForm = current.currentTarget.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.querySelector("[data-section='formScreen']");
            screenForm.querySelector("[data-form='formThresholds']").style.setProperty("display", "");
            screenForm.querySelector("[data-form='ResetIR']").style.setProperty("display", "none");
            screenForm.querySelector("[data-form='noActivity']").style.setProperty("display", "none");

            //cardSelected.querySelector("[data-button='addBait']").style.setProperty("display", "none");

            showFormScreen(current);
            var id = cardSelected.parentNode.parentNode.getAttribute("data-id");
        }

        function UpdateManual(current) {
            var screenForm = current.currentTarget.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.querySelector("[data-section='formScreen']");
            var id = cardSelected.parentNode.getAttribute("data-id");

            screenForm.querySelector("[data-form='formThresholds']").style.setProperty("display", "");

            screenForm.querySelector("[data-form='formThresholds']").querySelector("[data-value='RedAlertLower']").value = rowState[id].RedLower;
            screenForm.querySelector("[data-form='formThresholds']").querySelector("[data-value='RedAlertUpper']").value = rowState[id].RedUpper;
            screenForm.querySelector("[data-form='formThresholds']").querySelector("[data-value='AmberAlertLower']").value = rowState[id].AmberLower;
            screenForm.querySelector("[data-form='formThresholds']").querySelector("[data-value='AmberAlertUpper']").value = rowState[id].AmberUpper;


            screenForm.querySelector("[data-form='formThresholds']").querySelector("[data-value='checkboxRed']").checked = rowState[id].RedEnabled === 1 ? false : true;
            screenForm.querySelector("[data-form='formThresholds']").querySelector("[data-value='checkboxRed']").parentElement.querySelector("[data-value='SelectElement']").innerHTML = rowState[id].RedEnabled === 1 ? "ON" : "OFF";
            screenForm.querySelector("[data-form='formThresholds']").querySelector("[data-value='checkboxAmber']").checked = rowState[id].AmberEnabled === 1 ? false : true;
            screenForm.querySelector("[data-form='formThresholds']").querySelector("[data-value='checkboxAmber']").parentElement.querySelector("[data-value='SelectElement']").innerHTML = rowState[id].AmberEnabled === 1 ? "ON" : "OFF";

            screenForm.querySelector("[data-form='ResetIR']").style.setProperty("display", "none");
            screenForm.querySelector("[data-form='noActivity']").style.setProperty("display", "none");
            showFormScreen(current);

        }

        function CancelBait(current) {

            current.currentTarget.parentNode.parentNode.parentNode.parentNode.parentNode.style.setProperty("display", "none");
            event.currentTarget.parentNode.parentNode.parentNode.parentNode.querySelector("[data-info='btnSmart']").style.setProperty("display", "");
            cardSelected.querySelector("[data-section='clearScreen']").querySelector("[data-section='Actions']").querySelector("[data-section='ordinaryFormBtn']").style.setProperty("display", "");

        }


        function ShowAdvisories(event) {
            fw.func("JUMPSCREEN", "Show Advisories");

        }
        /**
         * Sets the card state to either triggered (2), set (1), or deactivated (0)
         *
         * @param id - id of the card to be modified.
         * @param value {number} - state to change the card to.
         */
        function setState(id, value) {

            if (typeof value !== "number") {
                throw new TypeError("Value must be a number, found '" + typeof value + "'.");
            }
            if (value > 4 || value < 0) {

                throw new Error("State value must either 0, 1, 2, 4. Found " + value);
            }

            var card = rowElems[id];
            var sideStatus = card.querySelector("[data-info='SideBarStatus'");
            var icon = card.querySelector("[data-info='icon']");
            var hours = card.querySelector("[data-value='Hours']");
            //icon.classList.remove("greenIcon");
            //icon.classList.remove("redIcon");
            //icon.classList.remove("greyIcon");

            switch (value) {
                case 1:
                    sideStatus.setAttribute("class", "normalCardBorder SideBarGray")
                    //icon.setAttribute("fill": "gray");
                    // hours.style.setProperty("visibility", "hidden");
                    //   card.querySelector("[data-button='addBait']").style.setProperty("display", "");
                    // card.querySelector("[data-button='resetIR']").style.setProperty("display", "none");
                    // card.querySelector("[data-button='manualLog']").style.setProperty("display", "none");
                    // card.querySelector("[data-button='noActivity']").style.setProperty("display", "none");

                    // card.querySelector("[data-button='submitButton']").innerHTML = "SET";

                    var trapTypeSelect = card.querySelector("[data-select='trapType']");
                    if (rowState[id].animalType !== undefined) {
                        trapTypeSelect.value = rowState[id].animalType;
                    }
                    Database.saveRecordParam("refrigerations", "Device", {
                        id:
                        {
                            "Id": id,
                            "State": 1,

                        }
                    }, function (data) {

                    });
                    break;
                case 2:
                    sideStatus.setAttribute("class", "normalCardBorder SideBarGreen");
                    var trapTypeSelect = card.querySelector("[data-select='trapType']");
                    // card.querySelector("[data-button='addBait']").style.setProperty("display", "");
                    //  card.querySelector("[data-button='resetIR']").style.setProperty("display", "");
                    //  card.querySelector("[data-button='manualLog']").style.setProperty("display", "");
                    //  card.querySelector("[data-button='noActivity']").style.setProperty("display", "");

                    //if (rowState[id].animalType !== undefined) {
                    //    trapTypeSelect.value = rowState[id].animalType;
                    //}
                    //Database.saveRecordParam("refrigerations", "Device", {
                    //    id:
                    //    {
                    //        "Id": id,
                    //        "State": 2,

                    //    }
                    //}, function (data) {

                    //});
                    break;
                case 3:
                    sideStatus.setAttribute("class", "normalCardBorder SideBarRed")
                    // card.querySelector("[data-button='addBait']").style.setProperty("display", "none");
                    //   card.querySelector("[data-button='resetIR']").style.setProperty("display", "");
                    //  card.querySelector("[data-button='manualLog']").style.setProperty("display", "");
                    //  card.querySelector("[data-button='noActivity']").style.setProperty("display", "");
                    //areaReport.push({
                    //    "CardName": id,
                    //    "Message": "Card " + id + " has been updated, activity sensor activated possible rodent in containment",
                    //    "DateTime": new Date(),
                    //});
                    //Database.saveRecordParam("refrigerations", "Device", {
                    //    id:
                    //    {
                    //        "Id": id,
                    //        "State": 3,

                    //    }
                    //}, function (data) {

                    //});

                    break;
                case 4:
                    //Database.saveRecordParam("refrigerations", "Device", {
                    //    id:
                    //    {
                    //        "Id": id,
                    //        "State": 4,

                    //    }
                    //}, function (data) {

                    //});
                    sideStatus.setAttribute("class", "normalCardBorder SideBarYellow");
                    break;

            }
            rowState[id].State = value;
            rowState[id].ReportData = GetTrapReport(areaReport);
        }

        function GetTrapReport(id) {
            var result = [];
            areaReport.forEach(x => {
                if (x.CardName === id) {
                    result.push(x);
                }
            });
            return result;
        }

        function GetDropDownId(dropdown, lookup) {
            var value;
            activeDropdowndataSources.forEach(current => {
                if (current.Name === dropdown) {
                    current.Values.forEach(x => {
                        if (x.Name === lookup) {
                            value = x.Id;
                        }
                    });
                }
            });
            return value;
        }

        /**
        * Shows the traps of a card that has been clicked.
        * @param event
        */
        function ShowTraps(event) {

            cardSelected = null;

            if (cardSelectedParent !== undefined && cardSelectedParent !== null) {
                var card = cardSelectedParent.children[0].children[0].children[1];
                card.innerHTML = '';
                activeCards.forEach(x => {
                    deleteCard(x);
                });
            }

            var clearScreen = event.parentNode.parentNode.querySelector("[data-selector='Traps']");
            if (clearScreen.style.display === "none") {
                lastHeader = clearScreen;
                clearScreen.style.setProperty("display", "");
                cardSelectedParent = clearScreen.parentNode.parentNode.parentNode;

                var id = cardSelectedParent.getAttribute("data-info");
                Script.setState("selectedSite", id);
                fw.func("PUBLISHCLIENT", "LoadCardTraps", id);
            }
            else {
                clearScreen.style.setProperty("display", "none");

            }

        }


        function TrapSelected(event) {

            var clearScreen = event.parentNode.querySelector("[data-selector='Traps']");
            if (clearScreen.style.display === "none") {
                if (lastHeader) {
                    lastHeader.style.setProperty("display", "none");
                    lastHeader = null;
                    activeCards.forEach(x => {
                        deleteCard(x);
                    });
                    return;
                }
                lastHeader = clearScreen;
                clearScreen.style.setProperty("display", "");
                cardSelectedParent = clearScreen.parentNode.parentNode.parentNode;

                var id = cardSelectedParent.getAttribute("data-info");
                Script.setState("selectedSite", _Id);
                fw.func("PUBLISHCLIENT", "LoadCardTraps", _Id);


            }
        }

        /**
         * Shows the stats of a card that has been clicked.
         * @param event
         */
        function toggleClearScreen(event) {

            var clearScreen = event.querySelector("[data-section='clearScreen']");



            if (clearScreen.style.display == "none") {
                if (cardSelected) {
                    cardSelected.classList.remove("openCardBorder");
                    cardSelected.querySelector("[data-section='clearScreen']").style.setProperty("display", "none");
                    cardSelected.querySelector("[data-section='formScreen']").style.setProperty("display", "none");
                    //   cardSelected.querySelector("[data-button='clearButton']").style.setProperty("display", "");
                }

                clearScreen.style.setProperty("display", "");
                cardSelected = clearScreen.parentNode.parentNode;
                toggleState = true;
                cardSelected.querySelector('[data-value="SelectElementValues"]').setAttribute("class", "activeToggle ");
                cardSelected.querySelector('[data-value="SelectElementValues"]').innerHTML = "ALL";

                try {
                    setTimeout(ToggleChildPosition, 200);
                }
                catch (e) {

                }


                var id = cardSelected.parentNode.getAttribute("data-id");
                cardSelected.querySelector('[data-info="chart"]').style.setProperty("display", "none");
                cardSelected.querySelector('[data-info="lineChart"]').style.setProperty("display", "none");
                BindChartData(rowState[id].Name);
                fw.func("PUBLISHCLIENT", "CardTrapSelected", [rowState[id].Name, rowState[id].RedLower, rowState[id].RedUpper, rowState[id].AmberLower, rowState[id].AmberUpper]);

                var deviceType = rowState[id].Type;
                clearScreen.querySelector("[data-section='Actions']").style.setProperty("display", "none");
                cardSelected.querySelector("[data-section='DeviceInfo']").style.setProperty("display", "");

                if (deviceType === "1") {

                    var ordinary = event.querySelector("[data-section='OrdinaryDevice']");
                    var smart = event.querySelector("[data-section='SmartDevice']");
                    smart.style.setProperty("display", "");
                    ordinary.style.setProperty("display", "none");  //temp disabled

                }
                else {
                    var ordinary = event.querySelector("[data-section='OrdinaryDevice']");
                    var smart = event.querySelector("[data-section='SmartDevice']");
                    smart.style.setProperty("display", "none");
                    ordinary.style.setProperty("display", "none "); //temp disabled
                }

                cardSelected.querySelector("[data-info='btnActions']").setAttribute("class", "tabBtn");
                cardSelected.querySelector("[data-info='btnInfo']").setAttribute("class", "tabBtnSelected");
            } else {
                clearScreen.style.setProperty("display", "none");
                if (cardSelected) {
                    cardSelected.querySelector("[data-section='formScreen']").style.setProperty("display", "none");
                    cardSelected.classList.remove("openCardBorder");
                    var smrtBtn = cardSelected.querySelector("[data-info='btnSmart']");
                    smrtBtn.style.setProperty("display", "");
                    cardSelected.querySelector("[data-section='DeviceInfo']").style.setProperty("display", "");

                    cardSelected.querySelector("[data-section='clearScreen']").querySelector("[data-section='Actions']").querySelector("[data-section='ordinaryFormBtn']").style.setProperty("display", "");

                }
            }
        }

        function ToggleChildPosition() {

            // Scroll Container
            var container = document.getElementById("container");
            // Offset is the amount of the card that is hidden.
            var offset = (cardSelected.offsetTop + cardSelected.offsetHeight - container.scrollTop) - container.offsetHeight;
            // Set the container scroll top so the bottom of the card is at the bottom of the container.
            container.scrollTop += offset;
            if (1 > container.offsetHeight) {
                container.scrollTop = cardSelected.offsetHeight + cardSelected.offsetTop;
            }

            // Add open border style
            if (!cardSelected.classList.contains("newPhotoBorder")) {
                cardSelected.classList.add("openCardBorder");
            }
        }
        /**
        * Adds a new record or updates and existing record header with the given sensor collection.
        *
        * The columns available are: CardName, CardLocation,UrgentCount, ImportantCount, MinorCount.
        *
        * Anything with data-value will automaticcally have the value updated in .innerHTML. From items etc neet to use the second switch statement.
        *
        * @param packet
        */
        function receive_headers(packet) {

            var collection = packet.value.value;
            var rowHeaderKeys = Object.keys(collection.data);
            rowStateHeaders = {};
            for (var i = 0; i < rowHeaderKeys.length; i++) {
                var card = rowHeaderElems[rowHeaderKeys[i]];
                if (card == undefined) {
                    // Create new card
                    card = cardTemplate.cloneNode(true);
                    card.setAttribute("id", "");
                    card.style.setProperty("display", "");
                    rowHeaderElems[rowHeaderKeys[i]] = card;
                    // Add to table.
                    addCard(rowHeaderKeys[i], card);
                    rowStateHeaders[rowHeaderKeys[i]] = {};


                }
                ActiveDatasource = collection.data;

                // Update stats
                for (var j = 0; j < collection.headers.length; j++) {
                    var headerValue = collection.headers[j];
                    var elem = card.querySelector("[data-value='" + headerValue + "']");

                    // It may not exist.
                    if (elem !== null) {
                        switch (headerValue) {
                            case "CardName":
                                if (collection.data[rowHeaderKeys[i]][j] === "") {
                                    card.querySelector("[data-value='CardName']").innerHTML = "Missing Value";
                                } else {
                                    card.querySelector("[data-value='CardName']").innerHTML = collection.data[rowHeaderKeys[i]][j];
                                }
                                break;
                            case "CardAddress":
                                if (collection.data[rowHeaderKeys[i]][j] === "") {
                                    card.querySelector("[data-value='CardAddress']").innerHTML = "Missing Value";
                                } else {
                                    card.querySelector("[data-value='CardAddress']").innerHTML = collection.data[rowHeaderKeys[i]][j];

                                }
                                break;
                            case "Urgent":
                                if (collection.data[rowHeaderKeys[i]][j] === "") {
                                    card.querySelector("[data-value='Urgent']").innerHTML = "--";
                                } else {
                                    card.querySelector("[data-value='Urgent']").innerHTML = collection.data[rowHeaderKeys[i]][j];
                                    rowStateHeaders[rowHeaderKeys[i]][headerValue] = collection.data[rowHeaderKeys[i]][j];

                                }
                                break;
                            case "Important":
                                if (collection.data[rowHeaderKeys[i]][j] === "") {
                                    card.querySelector("[data-value='Important']").innerHTML = "--";
                                } else {
                                    card.querySelector("[data-value='Important']").innerHTML = collection.data[rowHeaderKeys[i]][j];
                                    rowStateHeaders[rowHeaderKeys[i]][headerValue] = collection.data[rowHeaderKeys[i]][j];

                                }
                                break;
                            case "Minor":
                                if (collection.data[rowHeaderKeys[i]][j] === "") {
                                    card.querySelector("[data-value='Minor']").innerHTML = "--";
                                } else {
                                    card.querySelector("[data-value='Minor']").innerHTML = collection.data[rowHeaderKeys[i]][j];
                                    rowStateHeaders[rowHeaderKeys[i]][headerValue] = collection.data[rowHeaderKeys[i]][j];

                                }
                                break;
                        }

                    }
                    else {
                        switch (headerValue) {
                            case "NoAction":
                                rowStateHeaders[rowHeaderKeys[i]][headerValue] = collection.data[rowHeaderKeys[i]][j];

                                break;
                            case "Danger":
                                rowStateHeaders[rowHeaderKeys[i]][headerValue] = collection.data[rowHeaderKeys[i]][j];

                                break;
                            case "Attention":
                                rowStateHeaders[rowHeaderKeys[i]][headerValue] = collection.data[rowHeaderKeys[i]][j];

                                break;
                        }
                        //rowState[rowHeaderKeys[i]][headerValue] = collection.data[rowHeaderKeys[i]][j];

                    }

                }

                rowStateHeaders[rowHeaderKeys[i]]["Card"] = card;
            }
        }

        /**
         * Adds a new record or updates and existing record with the given sensor collection.
         *
         * The columns available are: technician, trapType, temp, setTime, updateTime, triggeredTime.
         *
         * Anything with data-value will automaticcally have the value updated in .innerHTML. From items etc neet to use the second switch statement.
         *
         * @param packet
         */
        function receive_value(packet) {

            activeCards = [];
            rowElems = {};
            rowState = {};
            var collection = packet.value.value;
            rowKeys = Object.keys(collection.data);
            var first = null;
            for (var i = 0; i < rowKeys.length; i++) {
                var card = rowElems[rowKeys[i]];
                if (card == undefined) {
                    // Create new card
                    card = cardChildTemplate.cloneNode(true);
                    card.setAttribute("id", "");
                    card.style.setProperty("display", "");
                    rowElems[rowKeys[i]] = card;
                    // Add to table.
                    AddCardChild(rowKeys[i], card, cardSelectedParent);
                    rowState[rowKeys[i]] = {};
                    rowState[rowKeys[i]]["rowId"] = rowKeys[i];

                    first = rowKeys[i];
                    if (collection.headers.indexOf("State") === -1) {
                        setState(rowKeys[i], 0);
                    }

                }
                ActiveDatasource = collection.data;
                var currentCard = card.querySelector("[data-value='map']");
                currentCard.id = "ID_" + collection.data[rowKeys[i]][0];
                rowState[rowKeys[i]]["Card"] = card;
                // Update stats
                for (var j = 0; j < collection.headers.length; j++) {
                    var headerValue = collection.headers[j];
                    var elem = card.querySelector("[data-value='" + headerValue + "']");

                    // It may not exist.
                    if (elem !== null) {
                        switch (headerValue) {

                            case "Status":

                                if (collection.data[rowKeys[i]][j] === "") {
                                    // card.querySelector("[data-value='Status']").innerHTML = "Network Error";
                                } else {
                                    // card.querySelector("[data-value='Status']").innerHTML = collection.data[rowKeys[i]][j];
                                }
                                break;

                            case "Notes":
                                if (collection.data[rowKeys[i]][j] !== "") {
                                    //card.querySelector("[data-section='notes']").style.setProperty("display", "flex");
                                } else {
                                    // card.querySelector("[data-section='notes']").style.setProperty("display", "none");
                                }

                                //card.querySelector("[data-form='notes']").value = collection.data[rowKeys[i]][j];
                                break;
                            case "Hours":
                                if (collection.data[rowKeys[i]][j] !== "") {

                                    card.querySelector("[data-info='UnderlineHours']").setAttribute("class", "UnderlineGray")

                                    card.querySelector("[data-value='Hours']").innerHTML = collection.data[rowKeys[i]][j];
                                    //SetCardLineColor(card, , triggerTresholdUpper, triggerTreshold, "UnderlineHours");

                                    var parseVal = parseInt(collection.data[rowKeys[i]][j]);


                                    if (parseVal > triggerTresholdUpper) {
                                        card.querySelector("[data-info='UnderlineHours']").setAttribute("class", "UnderlineRed")
                                    }
                                    else if (parseVal > triggerTreshold && parseVal <= triggerTresholdUpper) {
                                        card.querySelector("[data-info='UnderlineHours']").setAttribute("class", "UnderlineOrange")
                                    }
                                    else if (parseVal < 0) {
                                        card.querySelector("[data-info='UnderlineHours']").setAttribute("class", "UnderlineRed")
                                    }
                                    else {
                                        card.querySelector("[data-info='UnderlineHours']").setAttribute("class", "UnderlineGreen")
                                    }




                                } else {
                                    card.querySelector("[data-value='Hours']").innerHTML = "--";
                                    //SetCardLineColor(card, 0, 40, "UnderlineHours");
                                    card.querySelector("[data-info='UnderlineHours']").setAttribute("class", "UnderlineGray")


                                }
                                //card.querySelector("[data-form='notes']").value = collection.data[rowKeys[i]][j];
                                break;
                            case "Id":

                                if (collection.data[rowKeys[i]][j] !== "") {
                                    card.querySelector("[data-value='Id']").innerHTML = collection.data[rowKeys[i]][j];
                                } else {
                                    card.querySelector("[data-value='Id']").innerHTML = "--";
                                }
                                //card.querySelector("[data-form='notes']").value = collection.data[rowKeys[i]][j];
                                break;


                            case "SignalStatus":
                                //if (collection.data[rowKeys[i]][j] !== "") {
                                //    card.querySelector("[data-value='SignalStatus']").innerHTML = collection.data[rowKeys[i]][j];
                                //} else {
                                //    card.querySelector("[data-value='SignalStatus']").innerHTML = "No Vlaue";
                                //}

                                //card.querySelector("[data-form='notes']").value = collection.data[rowKeys[i]][j];
                                break;

                            case "SignalStrenght":

                                if (collection.data[rowKeys[i]][j] !== "") {
                                    card.querySelector("[data-value='SignalStrenght']").innerHTML = collection.data[rowKeys[i]][j] + "%";
                                    SetCardLineColorOver(card, collection.data[rowKeys[i]][j] * -1, -120 * -1, -80 * -1, "UnderlineSignal");

                                } else {
                                    card.querySelector("[data-info='UnderlineSignal']").setAttribute("class", "UnderlineGray")
                                    //    card.querySelector("[data-value='SignalStatus']").innerHTML = "No Vlaue";
                                }

                                //card.querySelector("[data-form='notes']").value = collection.data[rowKeys[i]][j];
                                break;

                            case "Alert":
                                if (collection.data[rowKeys[i]][j] !== "") {
                                    card.querySelector("[data-section='alert']").style.setProperty("display", "flex");
                                } else {
                                    card.querySelector("[data-section='alert']").style.setProperty("display", "none");
                                }
                                break;
                            case "BaitName":

                                if (collection.data[rowKeys[i]][j] !== "") {
                                    card.querySelector("[data-value='BaitName']").innerHTML = collection.data[rowKeys[i]][j];
                                } else {
                                    card.querySelector("[data-value='BaitName']").innerHTML = "--";
                                }
                                break;

                            case "LastUpdate":

                                var date = new Date(parseInt(collection.data[rowKeys[i]][j])).toString();
                                if (date === "Invalid Date") {
                                    card.querySelector("[data-value='LastUpdate']").innerHTML = "--";
                                }
                                else {
                                    debugger
                                    date = new Date(parseInt(collection.data[rowKeys[i]][j]));
                                    var formated = formatDate(date, "dd/MM/yy HH:MM");
                                    card.querySelector("[data-value='LastUpdate']").innerHTML = formated;
                                }

                                break;

                        }
                        // elem.innerHTML = collection.data[rowKeys[i]][j];
                        rowState[rowKeys[i]][headerValue] = collection.data[rowKeys[i]][j];
                    } else {

                        // Put item in here if it does not directly go into .innerHTML
                        switch (headerValue) {
                            case "Id":
                                rowState[rowKeys[i]][headerValue] = collection.data[rowKeys[i]][j];
                                break;
                            case "Sid":
                                rowState[rowKeys[i]][headerValue] = collection.data[rowKeys[i]][j];
                                break;
                            case "State":
                                // Set correct color
                                setState(rowKeys[i], parseInt(collection.data[rowKeys[i]][j]));
                                rowState[rowKeys[i]]["State"] = collection.data[rowKeys[i]][j];
                                var stateResult = parseInt(collection.data[rowKeys[i]][j]);
                                switch (parseInt(collection.data[rowKeys[i]][j])) {
                                    case 3:
                                        stateResult = 4;
                                        break;
                                    case 4:
                                        stateResult = 3;
                                        break;
                                }
                                rowState[rowKeys[i]]["sstatus"] = stateResult;
                                break;

                            case "BaitTypeName":

                                if (collection.data[rowKeys[i]][j] !== "") {

                                    card.querySelector("[data-value='FoodName']").innerHTML = collection.data[rowKeys[i]][24];
                                } else {
                                    card.querySelector("[data-value='FoodName']").innerHTML = "--";
                                }
                                break;
                            case "Name":
                                if (collection.data[rowKeys[i]][j] !== "") {
                                    card.querySelector("[data-value='DeviceNumber']").innerHTML = collection.data[rowKeys[i]][j];
                                } else {
                                    card.querySelector("[data-value='DeviceNumber']").innerHTML = "--";
                                }
                                rowState[rowKeys[i]][headerValue] = collection.data[rowKeys[i]][j];

                                break;
                            case "Location":

                                card.querySelector("[data-value='Address']").innerHTML = cardSelectedParent.querySelector("[data-value='CardName']").innerHTML;
                                break;
                            case "CatchNotes":
                                //card.querySelector("[data-form='catchNotes']").value = collection.data[rowKeys[i]][j];
                                break;
                            case "BaitRate":
                                if (collection.data[rowKeys[i]][j] !== "") {
                                    card.querySelector("[data-value='Dial']").innerHTML = collection.data[rowKeys[i]][j] + "g";
                                    rowState[rowKeys[i]]["BaitRate"] = collection.data[rowKeys[i]][j];

                                    if (collection.data[rowKeys[i]][14] === "1") {
                                        SetCardLineColor(card, collection.data[rowKeys[i]][j], baitThreshold, baitThresholdUpper, "UnderlineBait");
                                    }
                                }
                                else {
                                    card.querySelector("[data-value='Dial']").innerHTML = "--";
                                    card.querySelector("[data-info='UnderlineBait']").setAttribute("class", "UnderlineGray");

                                }
                                break;
                            case "DeviceBattery":

                                if (collection.data[rowKeys[i]][j] !== "") {

                                    var calculateBattery = parseFloat(collection.data[rowKeys[i]][j]);
                                    var bat = 0;
                                    var output = ((calculateBattery - 2.1) / (3.0 - 2.1)) * 100;
                                    if (output < 100)
                                        bat = output;
                                    else
                                        bat = 100;


                                    card.querySelector("[data-section='BatteryVal']").innerHTML = parseInt(bat) + "%";
                                }
                                else {
                                    card.querySelector("[data-info='UnderlineBattery']").setAttribute("class", "UnderlineGray")

                                }
                                break;
                            case "Type":

                                rowState[rowKeys[i]][headerValue] = collection.data[rowKeys[i]][j];
                                switch (collection.data[rowKeys[i]][j]) {
                                    case "1":
                                        HideCardIcons(card);
                                        card.querySelector("[data-info='iconSmart']").style.setProperty("display", "");
                                        rowState[rowKeys[i]]["ActiveIcon"] = "[data-info='iconSmart']";
                                        break;
                                    case "2":
                                        HideCardIcons(card);
                                        card.querySelector("[data-info='iconDummy']").style.setProperty("display", "");
                                        rowState[rowKeys[i]]["ActiveIcon"] = "[data-info='iconDummy']";
                                        break;
                                }
                                break;


                            case "CommunicationError":

                                var res = collection.data[rowKeys[i]][j];
                                if (collection.data[rowKeys[i]][j] !== "") {

                                    if (collection.data[rowKeys[i]][j] === "1") {
                                        card.querySelector("[data-info='errorStatus']").style.setProperty("display", "");
                                    }
                                    else if (collection.data[rowKeys[i]][j] === "0") {
                                        card.querySelector("[data-info='errorStatus']").style.setProperty("display", "none");
                                    }
                                }
                                else {
                                    card.querySelector("[data-info='errorStatus']").style.setProperty("display", "");

                                }
                                break;

                            case "TriggerTime":
                                var date = new Date(collection.data[rowKeys[i]][j]).toLocaleString('en-GB');
                                if (date === "Invalid Date") {
                                    card.querySelector("[data-value='LastSetDate']").innerHTML = "--";
                                }
                                else {
                                    var d = date.split(", ");
                                    var d0 = d[0].split("/");
                                    d0[2] = d0[2] - 2000;
                                    d0 = d0.join("/");

                                    card.querySelector("[data-value='LastSetDate']").innerHTML = d0;
                                }
                                break;

                            case "RecentValue":

                                if (collection.data[rowKeys[i]][2] === "1") {
                                    if (collection.data[rowKeys[i]][j] === "") {
                                        card.querySelector("[data-value='Dial']").innerHTML = "--";
                                        card.querySelector("[data-value='lbl1']").innerHTML = "RECENT";
                                    } else {
                                        card.querySelector("[data-value='Dial']").innerHTML = collection.data[rowKeys[i]][j];
                                        card.querySelector("[data-value='lbl1']").innerHTML = "RECENT";
                                        rowState[rowKeys[i]][headerValue] = collection.data[rowKeys[i]][j];

                                    }
                                }
                                break;
                            case "MinValue":
                                if (collection.data[rowKeys[i]][j] === "") {
                                    card.querySelector("[data-value='Hours']").innerHTML = "--";
                                    card.querySelector("[data-value='lbl2']").innerHTML = "MIN";
                                } else {
                                    card.querySelector("[data-value='Hours']").innerHTML = collection.data[rowKeys[i]][j];
                                    card.querySelector("[data-value='lbl2']").innerHTML = "MIN";
                                    rowState[rowKeys[i]][headerValue] = collection.data[rowKeys[i]][j];

                                }
                                break;
                            case "MaxValue":
                                if (collection.data[rowKeys[i]][j] === "") {
                                    card.querySelector("[data-value='Duration']").innerHTML = "--";
                                    card.querySelector("[data-value='lbl3']").innerHTML = "MAX";
                                } else {
                                    card.querySelector("[data-value='Duration']").innerHTML = collection.data[rowKeys[i]][j];
                                    card.querySelector("[data-value='lbl3']").innerHTML = "MAX";
                                    rowState[rowKeys[i]][headerValue] = collection.data[rowKeys[i]][j];

                                }
                                break;
                            case "AvgValue":

                                if (collection.data[rowKeys[i]][2] === "2") {
                                    if (collection.data[rowKeys[i]][j] === "") {
                                        card.querySelector("[data-value='Dial']").innerHTML = "--";
                                        card.querySelector("[data-value='lbl1']").innerHTML = "AVERAGE";
                                    } else {
                                        card.querySelector("[data-value='Dial']").innerHTML = collection.data[rowKeys[i]][j];
                                        card.querySelector("[data-value='lbl3']").innerHTML = "AVERAGE";
                                        rowState[rowKeys[i]][headerValue] = collection.data[rowKeys[i]][j];

                                    }
                                }
                                break;
                            case "Current":
                                if (collection.data[rowKeys[i]][2] === "3") {
                                    if (collection.data[rowKeys[i]][j] === "") {
                                        card.querySelector("[data-value='Dial']").innerHTML = "--";
                                        card.querySelector("[data-value='lbl1']").innerHTML = "CURRENT";
                                    } else {
                                        card.querySelector("[data-value='Dial']").innerHTML = collection.data[rowKeys[i]][j];
                                        card.querySelector("[data-value='lbl3']").innerHTML = "CURRENT";
                                        rowState[rowKeys[i]][headerValue] = collection.data[rowKeys[i]][j];

                                    }
                                }
                                break;
                            case "RedLower":
                                if (collection.data[rowKeys[i]][j] !== "") {
                                    rowState[rowKeys[i]]["SensorLower"] = parseFloat(collection.data[rowKeys[i]][j]);
                                    rowState[rowKeys[i]][headerValue] = parseFloat(collection.data[rowKeys[i]][j]);

                                } else {
                                    rowState[rowKeys[i]][headerValue] = 3.2;
                                }
                                break;
                            case "RedUpper":
                                if (collection.data[rowKeys[i]][j] !== "") {
                                    rowState[rowKeys[i]]["SensorUpper"] = parseFloat(collection.data[rowKeys[i]][j]);
                                    rowState[rowKeys[i]][headerValue] = parseFloat(collection.data[rowKeys[i]][j]);

                                } else {
                                    rowState[rowKeys[i]][headerValue] = 5.6;

                                }
                            case "AmberLower":
                                if (collection.data[rowKeys[i]][j] !== "") {
                                    rowState[rowKeys[i]][headerValue] = parseFloat(collection.data[rowKeys[i]][j]);

                                } else {
                                    rowState[rowKeys[i]][headerValue] = 5.6;

                                }
                            case "AmberUpper":
                                if (collection.data[rowKeys[i]][j] !== "") {
                                    rowState[rowKeys[i]]["SensorUpper"] = parseFloat(collection.data[rowKeys[i]][j]);
                                    rowState[rowKeys[i]][headerValue] = parseFloat(collection.data[rowKeys[i]][j]);

                                } else {
                                    rowState[rowKeys[i]][headerValue] = 5.6;

                                }
                                break;

                            case "RedEnabled":
                                rowState[rowKeys[i]][headerValue] = parseFloat(collection.data[rowKeys[i]][j]);
                                break;
                            case "AmberEnabled":
                                rowState[rowKeys[i]][headerValue] = parseFloat(collection.data[rowKeys[i]][j]);
                                break;
                        }
                    }
                }

                //setDeviceStatus(rowKeys[i]);

            }
            ChangeHeaderValue();
            fw.fireEvent("children populated", 0);

            sortEvent({
                value: [
                    "sstatus",
                    "false"
                ]
            });
            //fw_feed(null, null, null);
            //  ChangeCardHeaderType(1);

            var row = rowState[first];

            toggleClearScreen(row["Card"]);
            //  toggleClearScreen(row["Card"]);

        }


        //function setDeviceStatus(id)
        //{

        //    var prevStatus = rowState[id]["sstatus"];
        //    var sidebarStatusVal;

        //    if (rowState[id]["Type"] === "1") {
        //        sidebarStatusVal = CheckRowStatus(rowState[id]["RecentValue"], null, id);
        //    }
        //    else if (rowState[id]["Type"] === "2") {
        //        sidebarStatusVal = CheckRowStatus(rowState[id]["Current"], null, id);
        //    }
        //    else if (rowState[id]["Type"] === "3") {
        //        sidebarStatusVal = CheckRowStatus(rowState[id]["AvgValue"], null, id);
        //    }


        //    if (sidebarStatusVal !== prevStatus) {

        //        rowState[id]["sstatus"] = sidebarStatusVal;


        //    }
        //}


        function BindChartData(deviceName) {

            var endDate = new Date();
            var startDate = new Date();

            if (!ToggleDisabled) {
                cardSelected.querySelector('[data-info="data-table-valeus"]').style.setProperty("display", "none");
                return;
            }

            if (timeBack > 1) {
                startDate = startDate.setDate(startDate.getDate() - (timeBack - 1));
                startDate = new Date(startDate);
                startDate = startDate.setHours(23);
                startDate = new Date(startDate);

                endDate = endDate.setDate(endDate.getDate() - (timeBack - 1));
                endDate = new Date(endDate);
                endDate = endDate.setHours(0);
                endDate = new Date(endDate).toISOString();
            }
            else {

                endDate = endDate.setDate(endDate.getDate() - 1);
                endDate = new Date(endDate).toISOString();
            }


            startDate = startDate.toISOString();
            fw.func("history", "sensahub/trial/" + deviceName + "/temperature", "temperature", endDate, startDate);         // request data from server
        }

        function Goback() {
            timeBack = timeBack + 1;
            var id = cardSelected.parentNode.getAttribute("data-id");
            BindChartData(rowState[id].Name);
            fw.func("PUBLISHCLIENT", "SendBackRequest", rowState[id].Name);
        }

        function GoForward() {

            if (timeBack > 1) {
                timeBack = timeBack - 1;
            }
            var id = cardSelected.parentNode.getAttribute("data-id");
            BindChartData(rowState[id].Name);
            fw.func("PUBLISHCLIENT", "SendForwardRequest", rowState[id].Name);
        }

        function GetEmptyHours() {
            return [null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null,]
        }

        function ToggleChart(eventData) {
            var id = cardSelected.parentNode.getAttribute("data-id");

            if (ToggleDisabled === false) {
                return;
            }

            if (toggleState) {
                toggleState = false;

                eventData.parentElement.querySelector("[data-value='SelectElementValues']").setAttribute("class", "inactiveToggle");
                eventData.parentElement.querySelector("[data-value='SelectElementValues']").innerHTML = "OUT OF RANGE";

            }
            else {
                toggleState = true;

                eventData.parentElement.querySelector("[data-value='SelectElementValues']").setAttribute("class", "activeToggle ");
                eventData.parentElement.querySelector("[data-value='SelectElementValues']").innerHTML = "ALL";

            }

            var endDate = new Date();
            if (timeBack > 1) {
                BarItemClicked(endDate.getDate() - (timeBack - 1), toggleState);
            }
            else {
                BarItemClicked(endDate.getDate(), toggleState);
            }
        }

        function BarItemClicked(day, filter) {
            var id = cardSelected.parentNode.getAttribute("data-id");

            var labels = ["12am", "3am", "6am", "9am", "12pm", "3pm", "6pm", "9pm", "12am"];
            var source = [];
            var table = "<tr style='border-top: 1px solid #b1b1b1;border-bottom: 1px solid #b1b1b1;'><th class='InnerTableHeader'>Date/Time</th><th class='InnerTableHeader'>Reading</th><th class='InnerTableHeader'>Range +/-</th></tr>";



            var getEmptyHours = GetEmptyHours();
            if (_DaysSeries[0] === undefined || _DaysSeries[0] === null) {
                return;
            }



            var hours = [];
            var lastHour = null;
            var i = 0;
            var lastIteration = 0;
            var k = 0;
            var redLowers = [];
            var redUppers = [];
            var amberLowers = [];
            var amberUppers = [];
            for (var item in _DaysSeries) {

                var current = _DaysSeries[item];
                source.push(current.value);
                debugger
                if(i%2 == 0)
                {
                    redLowers.push(parseInt(rowState[id].RedLower));
                    redUppers.push(parseInt(rowState[id].RedUpper));
                    amberLowers.push(parseInt(rowState[id].AmberLower));
                    amberUppers.push(parseInt(rowState[id].AmberUpper));
                }
                else
                {
                    redLowers.push(null);
                    redUppers.push(null);
                    amberLowers.push(null);
                    amberUppers.push(null);
                }
         

                getEmptyHours[current.day.getHours()] = current.value;
                var offset = 0.0;
                if (lastHour !== current.day.getHours() || lastHour === null) {
                    lastHour = current.day.getHours();
                    if (k === lastIteration + 4 || k == 0) {
                        hours.push(current.day.getHours().toString() + ":00");
                        lastIteration = k;
                    }
                    k++;
                }
                i++;

                var date = new Date(current.timestamp).toLocaleString();


                if (filter) {

                    if (current.value < sensorUpper && current.value > sensorLower) {

                        table +=
                            "<tr style='color:#64b0da'>" +
                            "<td style='border-bottom: 0;font-weight: 400;padding-left: 10px;font-size: 11px;'>" + date + "</td>" +
                            "<td style='text-align:center;border-bottom: 0;font-weight: 400;padding-left: 10px;font-size: 11px;'>" + current.value.toFixed(1) + "</td>" +
                            "<td style='text-align:center;border-bottom: 0;font-weight: 400;padding-left: 10px;font-size: 11px;'>0.0</td>" +
                            "</tr >";
                    }
                    else {

                        if (current.value < sensorLower) {
                            offset = current.value - sensorLower;
                        }
                        else if (current.value > sensorUpper) {
                            offset = current.value - sensorUpper;
                        }

                        table +=
                            "<tr style='color:white'>" +
                            "<td style='border-bottom: 0;font-weight: 400;padding-left: 10px;font-size: 11px;'>" + date + "</td>" +
                            "<td style='text-align:center;border-bottom: 0;font-weight: 400;padding-left: 10px;font-size: 11px;'>" + current.value.toFixed(1) + "</td>" +
                            "<td style='text-align:center;border-bottom: 0;font-weight: 400;padding-left: 10px;font-size: 11px;'> " + offset.toFixed(1) + "</td>" +
                            "</tr >";
                    }

                }
                else {
                    if (current.value < sensorUpper && current.value > sensorLower) {



                    }
                    else {
                        if (current.value < sensorLower) {
                            offset = current.value - sensorLower;
                        }
                        else if (current.value > sensorUpper) {
                            offset = current.value - sensorUpper;
                        }

                        table +=
                            "<tr style='color:white'>" +
                            "<td style='border-bottom: 0;font-weight: 400;padding-left: 10px;font-size: 11px;'>" + date + "</td>" +
                            "<td style='text-align:center;border-bottom: 0;font-weight: 400;padding-left: 10px;font-size: 11px;'>" + current.value.toFixed(1) + "</td>" +
                            "<td style='text-align:center;border-bottom: 0;font-weight: 400;padding-left: 10px;font-size: 11px;'> " + offset.toFixed(1) + "</td>" +
                            "</tr >";
                    }
                }

            }

            cardSelected.querySelector('[data-info="resultTable"]').innerHTML = table;
            var prevLow = 0;
            var prevHeight = 0;
            for (var item in getEmptyHours) {


                var current = getEmptyHours[item];
                if (current < 0 && current < prevLow && current !== null) {
                    prevLow = current;
                }

                //     source.push(current);
                //labels.push(current["time"]);

            }
            var responsiveOptions = [
                ['screen and (min-width: 641px) and (max-width: 1024px)', {
                    showPoint: false,

                }],
                ['screen and (max-width: 640px)', {
                    showPoint: false,


                }]
            ];

            source = source.reverse();
            hours = hours.reverse();
            debugger
            // Initialize a Line chart in the container with the ID chart1
            new Chartist.Line(cardSelected.querySelector('[data-info="lineChart"]'), {
                labels: [],
                series: [source, redLowers, redUppers,amberLowers,amberUppers]
            }, { height: 200, low: (parseInt(rowState[id].redLower) - 2) }, responsiveOptions);

            var lineChart = cardSelected.querySelector('[data-info="lineChart"]');
            var parent;
            parent = lineChart.querySelector('[data-info="labelHolder"]')

            if (parent !== null && parent !== undefined) {
                parent.innerHTML = "";
            }
            else {
                parent = document.createElement("div");
                parent.setAttribute("data-info", "labelHolder");
                parent.setAttribute("class", "labelsParent");
            }

            for (var hour in hours) {
                var labelElement = document.createElement("span");
                labelElement.innerHTML = hours[hour];
                labelElement.setAttribute("class", "alignCenter");
                parent.appendChild(labelElement);

            }


            //var backBtn = document.createElement('span');
            //backBtn.innerHTML = "Back";
            //backBtn.setAttribute("id", "chartReturn");
            //backBtn.setAttribute("onclick", "ReturnToChart()");
            //backBtn.setAttribute("class", "postionChartButton");
            // lineChart.appendChild(backBtn);
            lineChart.appendChild(parent);
            cardSelected.querySelector('[data-info="noChartData"]').style.setProperty("display", "none");
            cardSelected.querySelector('[data-info="chart"]').style.setProperty("display", "none");
            cardSelected.querySelector('[data-info="lineChart"]').style.setProperty("display", "");
            cardSelected.querySelector('[data-info="resultTable"]').style.setProperty("display", "");


        }

        function ReturnToChart() {
            cardSelected.querySelector('[data-info="chart"]').style.setProperty("display", "");
            cardSelected.querySelector('[data-info="lineChart"]').style.setProperty("display", "none");
        }

        function HideCardIcons(card) {
            card.querySelector("[data-info='iconDummy']").style.setProperty("display", "none");
            card.querySelector("[data-info='iconSmart']").style.setProperty("display", "none");
        }

        function SetCardLineColor(card, value, treshold, tresholdUpper, querySelector) {
            card.querySelector("[data-info='" + querySelector + "']").setAttribute("class", "UnderlineGray")

            var parseVal = parseInt(value);
            if (parseVal <= treshold) {
                card.querySelector("[data-info='" + querySelector + "']").setAttribute("class", "UnderlineRed")
                return;
            }
            else if (parseVal > treshold && parseVal <= tresholdUpper) {
                card.querySelector("[data-info='" + querySelector + "']").setAttribute("class", "UnderlineOrange")
            }
            else {
                card.querySelector("[data-info='" + querySelector + "']").setAttribute("class", "UnderlineGreen")
            }
        }


        function SetCardLineColorFloat(card, value, treshold, tresholdUpper, querySelector) {
            card.querySelector("[data-info='" + querySelector + "']").setAttribute("class", "UnderlineGray")

            var parseVal = parseFloat(value);
            if (parseVal <= treshold) {
                card.querySelector("[data-info='" + querySelector + "']").setAttribute("class", "UnderlineRed")
                return;
            }
            else if (parseVal > treshold && parseVal <= tresholdUpper) {
                card.querySelector("[data-info='" + querySelector + "']").setAttribute("class", "UnderlineOrange")
            }
            else {
                card.querySelector("[data-info='" + querySelector + "']").setAttribute("class", "UnderlineGreen")
            }
        }

        function SetCardLineColorOver(card, value, treshold, tresholdUpper, querySelector) {
            card.querySelector("[data-info='" + querySelector + "']").setAttribute("class", "UnderlineGray")

            var parseVal = parseInt(value);
            if (parseVal >= treshold) {
                card.querySelector("[data-info='" + querySelector + "']").setAttribute("class", "UnderlineRed")
                return;
            }
            else if (parseVal < treshold && parseVal >= tresholdUpper) {
                card.querySelector("[data-info='" + querySelector + "']").setAttribute("class", "UnderlineOrange")
            }
            else {
                card.querySelector("[data-info='" + querySelector + "']").setAttribute("class", "UnderlineGreen")
            }
        }
        /**
         * Changes the visible counters on the screen.
         * @param packet
         */
        function ChangeCardHeaderType(packet) {

            UpdateCardSource(rowStateHeaders, packet, false);
            sortEvent({
                value: [
                    "sstatus",
                    "false"
                ]
            });
        }


        /**
        * Changes the visible count pointer on the screen.
        * @param eventData - holds an integer value from 1 - 3  based on the active view.
        */
        function ChangeCardPointer(eventData) {

            if (isNaN(eventData)) {
                eventData = eventData.value;
            }
            UpdateCardPointer(rowStateHeaders, eventData);
            UpdateCardPointer(rowState, eventData);
        }

        function UpdateCardPointer(source, packet) {

            for (var row in source) {
                var currentRow = source[row];
                var card = currentRow["Card"];
                switch (packet) {
                    case 1:
                        card.querySelector("[data-value='status1Pos']").setAttribute("class", "underlineIndicatorLeft");
                        card.querySelector("[data-value='status2Pos']").setAttribute("class", "underlineIndicatorLeft");
                        card.querySelector("[data-value='status3Pos']").setAttribute("class", "underlineIndicatorLeft");
                        break;
                    case 2:
                        card.querySelector("[data-value='status1Pos']").setAttribute("class", "underlineIndicatorRight");
                        card.querySelector("[data-value='status2Pos']").setAttribute("class", "underlineIndicatorRight");
                        card.querySelector("[data-value='status3Pos']").setAttribute("class", "underlineIndicatorRight");
                        break;
                    case 3:
                        card.querySelector("[data-value='status1Pos']").setAttribute("class", "underlineIndicatorCenter");
                        card.querySelector("[data-value='status2Pos']").setAttribute("class", "underlineIndicatorCenter");
                        card.querySelector("[data-value='status3Pos']").setAttribute("class", "underlineIndicatorCenter");
                        break;
                }
            }
        }

        function UpdateCardSource(source, packet, isChild) {

            for (var row in source) {
                var currentRow = source[row];
                var card = currentRow["Card"];
                if (packet === 2 || packet.value === 2) {

                    card.querySelector("[data-info='lbl1']").innerHTML = "URGENT";
                    card.querySelector("[data-info='lbl2']").innerHTML = "IMPORTANT";
                    card.querySelector("[data-info='lbl3']").innerHTML = "MINOR";
                    card.querySelector("[data-value='Urgent']").innerHTML = currentRow["Urgent"];
                    card.querySelector("[data-value='Important']").innerHTML = currentRow["Important"];
                    card.querySelector("[data-value='Minor']").innerHTML = currentRow["Minor"];
                    SelectedVisibleState = 2;
                    if (isChild) {
                        setAdvisory(card, currentRow);

                    }

                }
                else {

                    card.querySelector("[data-info='lbl1']").innerHTML = "URGENT";
                    card.querySelector("[data-info='lbl2']").innerHTML = "IMPORTANT";
                    card.querySelector("[data-info='lbl3']").innerHTML = "MINOR";
                    card.querySelector("[data-value='Urgent']").innerHTML = currentRow["Danger"];
                    card.querySelector("[data-value='Important']").innerHTML = currentRow["Attention"];
                    card.querySelector("[data-value='Minor']").innerHTML = currentRow["NoAction"];
                    SelectedVisibleState = 1;
                    if (isChild) {
                        setSatus(card, currentRow);
                    }

                }

            }

            if (packet === 2) {
                sortCards({
                    value: "sadvisories"
                });

            }
            else {

                sortCards({
                    value: "sstatus"
                });
            }
        }

        /**
         * Sorts the cards by the given column value.
         *
         * @param payload
         */
        function sortEvent(payload) {

            if (Array.isArray(payload.value) || typeof payload.value !== "string") {
                if (typeof payload.value[0] !== "string") {

                    throw new TypeError("Traps Card sort event expected an Array or string but found '" + typeof payload.value + "'.");
                }
                else {
                    payload.value = [payload.value[0].toLocaleLowerCase()];
                }
            }

            if (typeof payload.value === "string") {
                payload.value = [payload.value.toLowerCase()];

            }


            var validSorts = ["BaitName", "Settime", "sstatus", "updatetime", "triggeredtime", "State", "technician"];
            if (validSorts.indexOf(payload.value[0].toLowerCase()) === -1) {
                throw new TypeError(payload.value + " is an invalid sort. Please use " + validSorts.join());
            }

            if (payload.value.length > 1) {
                var order = sortCards(rowState, payload.value[0], payload.value[1]);
            } else {
                var order = sortCards(rowState, payload.value[0], true);
            }

            reorderCards(order);
        }


        /**
         * Reorders the cards in the table.
         * @param order
         */
        function reorderCards(order) {
            for (var i = 0; i < order.length; i++) {
                cardSelectedParent.appendChild(rowElems[order[i]].parentElement);
            }
        }

        /**
         * The sort function used for sorting the cards. This is a custom function per card application.
         * @param data Data object containing the state of all the cards.
         * @param sortType Field inside the object to sort by.
         */
        function sortCards(data, sortType, asc) {

            var dataKeys = Object.keys(data);

            if (asc === false) {
                return dataKeys.sort(function (firstKey, secondKey) {

                    var first = data[firstKey];
                    var second = data[secondKey];

                    if (first[sortType] < second[sortType]) {
                        return -1;
                    } else if (first[sortType] == second[sortType]) {
                        return 0;
                    } else {
                        return 1;
                    }

                });
            } else {
                return dataKeys.sort(function (firstKey, secondKey) {
                    var first = data[firstKey];
                    var second = data[secondKey];

                    if (first[sortType] > second[sortType]) {
                        return -1;
                    } else if (first[sortType] == second[sortType]) {
                        return 0;
                    } else {
                        return 1;
                    }

                });
            }
        }



        function addCard(id, card) {
            tableBody = document.getElementById("tbody");
            var row = document.createElement("tr");
            row.appendChild(card);
            row.setAttribute("data-info", id);
            tableBody.appendChild(row);
        }


        function AddCardChild(id, card, parent) {

            var cardBody = parent.querySelector("[data-selector='Traps']");
            var row = document.createElement("div");
            row.appendChild(card);
            row.setAttribute("data-id", id);
            cardBody.appendChild(row);
            activeCards.push(id);
        }



        function deleteCard(id) {


            var container = document.getElementById("body");
            var card = container.querySelector("[data-id='" + id + "']");
            if (card !== null) {
                card.remove();
                delete rowElems[id];
            }
        }


        function updateValue(id, stat, value) {
            var row = document.querySelector("[data-id='" + id + "']");
            var statElem = row.querySelector("[data-value='" + stat + "']").innerHTML = value;
        }

        // API actions for dashboard mode
        function fw_dashStart(mode) {

            if (mode !== "DASHBOARD") {
                document.getElementsByTagName("html")[0].style.setProperty("background-color", "grey");
            }



            return "OK";
        }


        // API startup actions for toolbox. Return "OK" if startup OK else return an error string
        function fw_toolStart(mode) {

            var battery = document.getElementById("currentBattery");
            return "OK";
        }

        // API startup actions when first created by dropping in design mode. Return "OK" if startup OK else return an error string
        function fw_newWidget(mode) {
            return fw_dashStart();
        }

        // API called when switching to design mode (optional, delete if not using)
        function fw_startDesign() {
            return true;
        }

        // API called to manage scaling
        function fw_scale(scaleX, scaleY) {
            fw.widgetID.style.setProperty("width", (options.settings.iniWidth * scaleX) + "px");
            fw.widgetID.style.setProperty("height", (options.settings.iniHeight * scaleY) + "px");
            //  battery.setAttribute("transform", "scale(" + 0.5 + "," + 0.5 + ")");
            numVal.setAttribute("transform", "scale(" + 0.5 + "," + 0.5 + ")");


            return true;
        }

        // API called when widget edit starts (return false to stop editor, "NOSCALE", "NOVERT", "NOHORIZ", "NOVERT,NOHORIZ" to customise scaling)
        function fw_startEdit() {
            return true;
        }

        // API called when widget edit finishes (apply edit changes here)
        function fw_endEdit(mode) {
        }

        function fw_db(channel, scope, data) {

        }

        // API called for incoming channel events
        function fw_feed(channel, scope, data) {

            if (scope === "DEVICEOFFLINE") {
                try {
                    var getRow = GetRowByDeviceName(data.value);
                    var row = rowElems[getRow["rowId"]];
                    row.querySelector("[data-info='errorStatus']").style.setProperty("display", "");
                }
                catch (e) {
                    throw new TypeError("Device not found :" + typeof eventData.value);
                }
            }

          

        }



        function ChangeHeaderValue() {
            cardSelectedParent.querySelector("[data-value='Urgent']").innerHTML = 0;
            cardSelectedParent.querySelector("[data-value='Important']").innerHTML = 0;
            cardSelectedParent.querySelector("[data-value='Minor']").innerHTML = 0;


            var greenCount = 0;
            var yellowCount = 0;
            var redCount = 0;
            for (var rowIndex in rowState) {
                var row = rowState[rowIndex];
                switch (row.sstatus) {
                    case 4:
                        redCount += 1;

                        break;
                    case 3:
                        yellowCount += 1;
                        break;
                    case 2:
                        greenCount += 1;
                        break;
                }
            }

            cardSelectedParent.querySelector("[data-value='Urgent']").innerHTML = redCount;
            cardSelectedParent.querySelector("[data-value='Important']").innerHTML = yellowCount;
            cardSelectedParent.querySelector("[data-value='Minor']").innerHTML = greenCount;



        }
        function fw_history(channel, scope, data) {

            _TimeSeriesData = null;
            var deviceName = channel.split("/");
            var getRow = GetRowByDeviceName(deviceName[2]);

            if (getRow === undefined || getRow === null) {
                return;
            }
            if (data.value.length < 1) {
                cardSelected.querySelector('[data-info="lineChart"]').style.setProperty("display", "none");
                cardSelected.querySelector('[data-info="resultTable"]').style.setProperty("display", "none");
                cardSelected.querySelector('[data-info="noChartData"]').style.setProperty("display", "");
            }


            if (getRow["Card"] === cardSelected) {

                sensorLower = rowState[getRow["rowId"]].SensorLower;
                sensorUpper = rowState[getRow["rowId"]].SensorUpper;
                _TimeSeriesData = data.value;
                AssignSeries();
                // var averages = GetLastForDay();
                var endDate = new Date();

                if (ToggleDisabled) {
                    if (timeBack > 1) {
                        BarItemClicked(endDate.getDate() - (timeBack - 1), toggleState)
                    }
                    else {
                        BarItemClicked(endDate.getDate(), toggleState)

                    }
                }

                //var localUnitData = [];
                //localUnitData[0] = ["2020-11-12T11:29:05Z", "84"];
            }
        }

        function AssignSeries() {
            var lastDate;
            _DaysSeries = [];
            var hour;
            var localdata = [];
            var result = [];
            //    _DaysSeries[0]["Source"] = [];
            for (var item in _TimeSeriesData) {
                var serie = _TimeSeriesData[item];

                var date = new Date(serie[0]);

                // if (lastDate === undefined) {
                //     lastDate = date.getDate();
                //     _DaysSeries[date.getDate()] = {};

                // }

                // if (date.getDate() != lastDate) {
                //     localdata = [];
                //     lastDate = date.getDate();
                //     _DaysSeries[date.getDate()] = {};

                // }
                // else {
                //     var day = new Date(serie[0]);

                //     //if (hour === undefined) {
                //     //    hour = day.getHours();
                //     //}

                //     //if (hour !== day.getHours()) {
                //     //    hour = day.getHours();


                //     //}
                //     var currentWeight = parseFloat(serie[1]);

                //     localdata.push({
                //         time: serie[0],
                //         value: currentWeight,
                //         day: day,
                //         key: date.getDate(),
                //         timestamp: day.getTime(),

                //     });
                var day = new Date(serie[0]);
                var currentWeight = parseFloat(serie[1]);
                _DaysSeries.push(
                    {
                        time: serie[0],
                        value: currentWeight,
                        day: day,
                        key: date.getDate(),
                        timestamp: day.getTime(),

                    })



            }
        }

        function GetLastForDay() {

            var result = [];


            for (var item in _DaysSeries) {
                var day = _DaysSeries[item];
                var source = day["Source"];
                result.push(source[day["Source"].length - 1]);
            }

            return result;
        }

        function evenRound(num, decimalPlaces) {
            var d = decimalPlaces || 0;
            var m = Math.pow(10, d);
            var n = +(d ? num * m : num).toFixed(8); // Avoid rounding errors
            var i = Math.floor(n), f = n - i;
            var e = 1e-8; // Allow for rounding errors in f
            var r = (f > 0.5 - e && f < 0.5 + e) ?
                ((i % 2 == 0) ? i : i + 1) : Math.round(n);
            return d ? r / m : r;
        }
        function GetAvgForDay() {
            var result = [];


            for (var item in _DaysSeries) {
                var day = _DaysSeries[item];

                result.push(day["Source"].reduce((a, b) => (a.value + b.value)) / day["Source"].length);
            }

            return result;
        }
        var IsDecimal = function (num) {
            return ((num.toString().split('.').length) <= 2 && num.toString().match(/^[\+\-]?\d*\.?\d+(?:[Ee][\+\-]?\d+)?$/)) ? (!isNaN(parseFloat(num))) : false;
        }
        // Initialize widget framework API - DO NOT ADJUST OR DELETE
        var fw = new parent.widgetAPI(window.name);
        fw.ready();



        function CheckSignalStrenght(dBm) {
            if (dBm < -120) {
                //  console.log("Signal is 10");
                return 10;
            }

            if (dBm < -115) {
                //    console.log("Signal is 20");
                return 20;
            }

            if (dBm < -111) {
                //  console.log("Signal is 30");
                return 30;
            }

            if (dBm < -107) {
                //    console.log("Signal is 40");
                return 40;
            }

            if (dBm < -101) {
                //   console.log("Signal is 50");
                return 50;
            }

            if (dBm < -95) {
                //  console.log("Signal is 60");
                return 60;
            }

            if (dBm < -90) {
                //  console.log("Signal is 70");
                return 70;
            }

            if (dBm > -90) {
                //   console.log("Signal is 100");
                return 100;
            }
        }

    </script>
</body>
</html>
