{"device":"DESKTOP","widgets":{"Container#0":{"t":"Container","lX":5,"lY":10,"sX":7.7,"sY":10,"s":"Manage Models","ps":{"enabled":false,"scalingType":"OK","width":"32.39%","height":"81.04%","x":"0.2%","y":"0.9%"},"ver":"190104c190915","z":"110","dis":false,"a":{"title":"Manage Device Models","color":"grey"},"ev":{}},"Container#1":{"t":"Container","lX":15,"lY":55,"sX":6.35,"sY":1,"s":"Manage Models","ps":{"enabled":false,"scalingType":"OK","width":"26.71%","height":"8.1%","x":"0.46%","y":"4.4%"},"ver":"190104c190915","z":"110","dis":false,"a":{"title":"","color":"white"},"ev":{}},"Image#0":{"t":"Image","lX":650,"lY":65,"sX":1.03,"sY":0.67,"s":"Manage Models","ps":{"enabled":false,"scalingType":"","width":"5.51%","height":"7.01%","x":"25.41%","y":"4.05%"},"ver":"190104c190915","dis":false,"a":{"border width":"0","location":"../images/","image":"device.png?0.7111362038589757","maintain aspect ratio":"false","value clicked":""},"ev":{}},"Container#2":{"t":"Container","lX":15,"lY":155,"sX":7.45,"sY":5.1,"s":"Manage Models","ps":{"enabled":false,"scalingType":"OK","width":"31.34%","height":"41.33%","x":"0.29%","y":"12.55%"},"ver":"190104c190915","z":"110","dis":false,"a":{"title":"Edit Model Details","color":"grey"},"ev":{}},"Container#6":{"t":"Container","lX":15,"lY":665,"sX":7.45,"sY":2.7,"s":"Manage Models","ps":{"enabled":false,"scalingType":"OK","width":"31.34%","height":"21.88%","x":"0.72%","y":"54.29%"},"ver":"190104c190915","z":"110","dis":false,"a":{"title":"Edit Model Custom Attributes","color":"grey"},"ev":{}},"Script#Attribs":{"t":"Scripting","lX":780,"lY":160,"sX":1,"sY":1,"s":"Manage Models","ps":{"enabled":false,"scalingType":"NOSCALE","width":"","height":"","x":"","y":""},"ver":"200124c190915","vis":false,"dis":false,"tt":"","a":{"script type":"javascript","code editor":"//# sourceURL=dynamic-script.js\n/**\n * Description: Manage the template attribs\n * Create Author/Date: Dean Dobson 24/05/20\n * Modified Author/Date: \n * Version: 1.0\n */\n\n//TODO: Distributor name selected\nvar dbName = \"kinect\";\nvar tableName = \"templates\";\nvar selectedAttrib = \"\";\nvar currAttribs;;\ninitCurrAttribs();\n\nfunction initCurrAttribs() {\n\tcurrAttribs = {};\n\tcurrAttribs.data = {};\n\tcurrAttribs.headers = [\"attribute\", \"value\"];\n\tcurrAttribs.pk = \"attribute\";\n\tcurrAttribs.label = \"sensacollection\";\n}\n\n// Save button pressed\nClientEvents.subscribe(\"AttribSave\", function (value) {\n\tcurrAttribs = Script.getState(\"currAttribs\"); // from record load in main script\n\t//if (currAttribs === null || currAttribs.value === null) {\n\tif (currAttribs === null) {\n\t\tinitCurrAttribs();\n\t} //else {\n\t//\tcurrAttribs = currAttribs.value;\n\t//}\n\tvar formData = Script.getForm(\"attribs\");\n\tselectedAttrib = formData[\"TempAttrib\"];\n\tif (typeof selectedAttrib !== \"undefined\" && selectedAttrib !== \"\") {\n\t\tcurrAttribs.data[selectedAttrib] = [selectedAttrib, formData[\"TempValue\"]];\n\t\tClientEvents.publish(\"TempAttribsDelRows\",\"\");\n\t\tClientEvents.publish(\"TempAttribsSetValues\",currAttribs);\n\t\tScript.setState(\"currAttribs\", currAttribs); // Share with main script\n\t\tClient.status(\"Attribute '\" + selectedAttrib + \"' added.\");\n\t\tClient.setDirtyFlag();\n\t} else {\n\t\tClient.invokeModal(\"OK\",\"Update Key\", \"No attribute has been updated due to no key entered.\");\n\t}\n});\n\n// Row in table selected event\nClientEvents.subscribe(\"SelectedAttrib\", function (selected) {\n\tselectedAttrib = Object.keys(selected.value.data)[0];\n\tClientEvents.publish(\"KeySetValue\", selectedAttrib);\n\tClientEvents.publish(\"ValueSetValue\", selected.value.data[selectedAttrib][1]);\n});\n\n// Delete button\nClientEvents.subscribe(\"AttribDelete\", function () {\n\tcurrAttribs = Script.getState(\"currAttribs\");\n\tvar formData = Script.getForm(\"attribs\");\n\tselectedAttrib = formData[\"TempAttrib\"];\n\tif (!(selectedAttrib in currAttribs.data)) {\n\t\tvar delKey = selectedAttrib;\n\t\tif (delKey === \"\") {\n\t\t\tdelKey = \"[nothing]\";\n\t\t}\n\t\tClient.invokeModal(\"OK\",\"Delete Key\", \"The key '\" + delKey + \"' does not exist as a custom attribute. Check key and try again\");\n\t} else {\n\t\tdelete currAttribs.data[selectedAttrib];\n\t\tClientEvents.publish(\"TempAttribsDelRows\",\"\");\n\t\tClientEvents.publish(\"TempAttribsSetValues\",currAttribs);\n\t\tScript.setState(\"currAttribs\", currAttribs);\n\t\tClient.status(\"Attribute '\" + selectedAttrib + \"' deleted.\", \"IMPORTANT\");\n\t}\n});"},"ev":{"clientEvents":{"inputEvents":{"EventButton":{"channel":"ButAttrib/receive value","event":"receive value"}}},"serverEvents":{"inputEvents":{"DBResult":{"channel":"$DB/ADMIN/MANAGE/RESPONSE","event":"feed"}}}}},"ScriptManage":{"t":"Scripting","lX":780,"lY":40,"sX":1,"sY":1,"s":"Manage Models","ps":{"enabled":false,"scalingType":"NOSCALE","width":"4.21%","height":"8.32%","x":"32.81%","y":"3.33%"},"ver":"200124c190915","vis":false,"dis":false,"tt":"","a":{"script type":"javascript","code editor":"//# sourceURL=dynamic-script.js\n/**\n * Description: Manage the template data\n * Create Author/Date: Dean Dobson 24/05/20\n * Modified Author/Date: DD 27/9/20\n * Version: 1.2 Changed options to after callback\n */\n\n//TODO: get distributor name, update logic for new distributor selected\n//TODO: Update read image with Elijah's framework call\n\nvar distribs = [];\nvar selectedDistrib = \"\";\nvar tableName = \"_models\";\nvar selectedRec = \"\";\nvar currList = [];\nvar imageName;\nvar imageBin;\n\n/**\n * Initialise script state (run once at startup)\n */\nScript.on('load', function() {\n\t// Get the distributor and model names\n\tClient.getTenants(function (data) {\n\t\tdistribs = data.value;\n\t\tselectedDistrib = distribs[0];\n\t\t\n\t\tDevices.manageModels(\"read\", selectedDistrib,\"\", function (data) {\n\t\t\tvar models = Object.keys(data.value.data);\n\t\t\tClientEvents.publish(\"ModelNameList\", models);    // Update the model name dropdown\n\t\t\tcurrList = models.slice();\n\t\t},{\"columns\":\"model\"});\n\t\t\n\t\tClientEvents.publish(\"DistribNameList\", distribs);    // Update the distributor name dropdown\n\t});\n\t\n\t// TODO Get the account names\n});\n\n// Clear form\nClientEvents.subscribe(\"ModelClear\", function (selected) {\n\tif (Client.dirtyFlag(\"check\")) {\n\t\t\tClient.invokeModal(\"OK\",\"Confirm Clear Record\",\"Items on this form have changed, please confirm that you want to clear the fields and ignore changes.\",\"Clear\",\"\", function (confirm) {\n\t\t\t\tif (confirm) {\n\t\t\t\t\tClientEvents.publish(\"Clear\", \"\");\n\t\t\t\t\tClient.clearDirtyFlag();\n\t\t\t\t\timageBin = null;\n\t\t\t\t}\n\t\t\t});\n\t} else {\n\t\tClientEvents.publish(\"Clear\", \"\");\n\t}\n});\n\n// New model selected\nClientEvents.subscribe(\"ModelSelected\", function (selected) {\n\tif (Client.checkDirtyFlag()) {\n\t\tClient.invokeModal(\"OK\",\"Confirm Changing Record\", \"Items on this form have changed, please confirm that you want to select a new model and ignore changes to the form.\", \"Change\", \"CHANGE\", function (confirm) {\n\t\t\tif (confirm) {\n\t\t\t\tDevices.manageModels(\"read\", selectedDistrib, selected.value, function (data) {\n\t\t\t\t\tObject.keys(data.value.data).forEach(function (item) {\n\t\t\t\t\t\tselectedRec = item;\n\t\t\t\t\t\tpopulateFields(data.value.data[item]);\n\t\t\t\t\t});\n\t\t\t\t\tClient.clearDirtyFlag();\n\t\t\t\t}, {\"columns\":\"*\",\"filter\":\"model='\" + selected.value + \"'\"});\n\t\t\t} else {\n\t\t\t\tClientEvents.publish(\"TempModNameUpd\", selectedRec); // Select old record\n\t\t\t}\n\t\t});\n\t} else {\n\t\tDevices.manageModels(\"read\", selectedDistrib, selected.value, function (data) {\n\t\t\tObject.keys(data.value.data).forEach(function (item) {\n\t\t\t\tselectedRec = item;\n\t\t\t\tpopulateFields(data.value.data[item]);\n\t\t\t});\n\t\t\tClient.clearDirtyFlag();\n\t\t}, {\"columns\":\"*\",\"filter\":\"model='\" + selected.value + \"'\"});\n\t}\n});\n\n// Save button\nClientEvents.subscribe(\"ModelSave\", function (value) {\n\t// Get values in form\n\tvar formData = Script.getForm(\"devtemplate\");\n\tselectedRec = formData.TempModels;\n\tsaveRecs(formData);\n});\n\n// Delete button\nClientEvents.subscribe(\"ModelDelete\", function (value) {\n\t// Get values in form\n\tvar formData = Script.getForm(\"devtemplate\");\n\tselectedRec = formData.TempModels;\n\tif (formData.TempModels !== \"\") {\n\t\tClient.status(\"Deleting model '\" + selectedRec + \"'...\", \"IMPORTANT\");\n\t\tClient.invokeModal(\"OK\",\"Confirm Delete\", \"Please confirm that you want to delete model '\"+ selectedRec + \"'. <br><br>NOTE - All devices associated with the model will also be deleted. Are you sure?\", \"Delete\", \"DELETE\", function (confirm) {\n\t\t\tif (confirm) {\n\t\t\t\t//TODO: Propose removing the need to add '' to the filter, the database.cs file should do that, or use filter as a full where clause (security??).\n\t\t\t\tDevices.manageModels(\"delete\", selectedDistrib, \"\", function (data) {\n\t\t\t\t\tif (data.value > 0) {\n\t\t\t\t\t\tClient.status(\"Device template '\" + selectedRec + \"' deleted.\", \"IMPORTANT\");\n\t\t\t\t\t\t// refresh the dropdown & the fields\n\t\t\t\t\t\tDevices.manageModels(\"read\", selectedDistrib, \"*\", function (data) {\n\t\t\t\t\t\t\tvar models = Object.keys(data.value.data);\n\t\t\t\t\t\t\tClientEvents.publish(\"ModelNameList\", models);    // Update the model name dropdown\n\t\t\t\t\t\t\tcurrList = models.slice();\n\t\t\t\t\t\t}, {\"columns\":\"model\"});\n\t\t\t\t\t\t//TODO: Delete the model table from the database\n\t\t\t\t\t} else {\n\t\t\t\t\t\tvar delMsg = \"Unknown error with delete.\";\n\t\t\t\t\t\tif (data.value == -1) {\n\t\t\t\t\t\t\tdelMsg = \"didn't delete correctly. Please check input and retry.\";\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (data.value == 0) {\n\t\t\t\t\t\t\tdelMsg = \"No records were found to delete. Please check input and retry.\";\n\t\t\t\t\t\t}\n\t\t\t\t\t\tClient.invokeModal(\"OK\",\"Delete Record\", \"Device template '\" + selectedRec + \"' \" + delMsg, \"IMPORTANT\");\n\t\t\t\t\t}\n\t\t\t\t}, {\"columns\":\"model\", \"filter\":\"'\" + selectedRec + \"'\"});\n\t\t\t\tClient.clearDirtyFlag();\n\t\t\t\tClientEvents.publish(\"Clear\", \"\");\n\t\t\t\timageBin = null;\n\t\t\t}\n\t\t});\n\t} else {\n\t\tSystem.status(\"WARNING - Can't perform model delete, no model selected, select a model name and try again....\", \"IMPORTANT\");\n\t}\n});\n\n/**\n * Response to message from server channel\n */\nScript.on('server', function(eventData) {\n});\n\n// Save form to database\nfunction saveRecs(formData) {\n\tif (formData.TempModels !== \"\") {\n\t\tClient.status(\"Saving device template '\" + selectedRec + \"'...\");\n\t\tvar status = 0;\n\t\tswitch (formData.TempStatus) {\n\t\t\tcase \"Enabled\":\n\t\t\t\tstatus = 1;\n\t\t\t\tbreak;\n\t\t\tcase \"Inactive\":\n\t\t\t\tstatus = 2;\n\t\t\t\tbreak;\n\t\t}\n\t\t// Populate a dbRequest object to send to server\n\t\tvar dbRec = {};\n\t\tdbRec.model = formData.TempModels;\n\t\tdbRec.account = formData.TempAccount;\n\t\tdbRec.make = formData.TempMake;\n\t\tdbRec.version = formData.TempVersion;\n\t\tdbRec.location = formData.TempLocation;\n\t\tdbRec.groupname = formData.TempGroup;\n\t\tdbRec.branch = formData.TempBranch;\n\t\tdbRec.department = formData.TempDepartment;\n\t\tdbRec.imagename = imageName;\n\t\tdbRec.application = formData.TempApplication;\n\t\tdbRec.url = formData.TempURL;\n\t\tdbRec.status = status;\n\t\tdbRec.owner = formData.TempOwner;\n\t\tdbRec.type = formData.TempType;\n\t\tdbRec.notes = formData.TempNotes;\n\t\tdbRec.apn = formData.TempAPN;\n\t\tvar dbReq = {};\n\t\tdbReq[formData.TempModels] = dbRec;\n\t\tDevices.manageModels(\"save\", selectedDistrib, dbRec.model, function (result) {\n\t\t\tif (result.value > 0) {\n\t\t\t\tClient.status(\"Device template '\" + selectedRec + \"' saved.\");\n\t\t\t\tif (currList.indexOf(selectedRec) === -1) {\n\t\t\t\t\t// Add the new record to the dropdown list\n\t\t\t\t\tClientEvents.publish(\"ModelAddList\",selectedRec);\n\t\t\t\t\tcurrList.push(selectedRec);\n\t\t\t\t}\n\t\t\t\tClient.clearDirtyFlag();\n\t\t\t\tClient.status(\"Record '\" + selectedRec + \"' saved successfully.\", \"IMPORTANT\");\n\t\t\t\t// Now save the image file\n\t\t\t\tif (imageBin !== null) {\n\t\t\t\t\tvar usrmeta = {\n\t\t\t\t\t\tfileName: imageName,\n\t\t\t\t\t\tfileType: \"image\",\n\t\t\t\t\t\tlocation: \"../images/devices/\" + selectedDistrib\n\t\t\t\t\t};\n\t\t\t\t\tClient.publishToChannel(\"$SYS/FILES/REQUEST/UPLOAD\", \"string\", imageBin, usrmeta);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tClient.invokeModal(\"OK\",\"Save Record\", \"Device template '\" + selectedRec + \"' didn't save correctly. Please check input.\");\n\t\t\t}\t\t\n\t\t}, {\"data\":dbReq});\n\t} else {\n\t\tClient.invokeModal(\"OK\",\"Save Record\", \"NOTE - Can't perform model save, no model selected, select or enter a model name and try again...\");\n\t}\n}\n\n// populate the widget fields from data returned from server\nfunction populateFields(coll) {\n\tClientEvents.publish(\"ApplicationSetValue\",coll[1]);\n\tClientEvents.publish(\"MakeSetValue\",coll[2]);\n\tClientEvents.publish(\"VersionSetValue\",coll[3]);\n\tClientEvents.publish(\"LocationSetValue\",coll[4]);\n\tClientEvents.publish(\"TempGroupSetValue\",coll[5]);\n\tClientEvents.publish(\"TempBranchSetValue\",coll[6]);\n\tClientEvents.publish(\"TempDepartmentSetValue\",coll[7]);\n\timageName = coll[8];\n\tClientEvents.publish(\"TempLoadImage\",\"../images/devices/\" + selectedDistrib + \"/\" + imageName);\n\timageBin = null;\n\tswitch (coll[9]) {   // Status\n\t\tcase \"0\":\n\t\t\tClientEvents.publish(\"StatusSetValue\",\"Disabled\");\n\t\t\tbreak;\n\t\tcase \"1\":\n\t\t\tClientEvents.publish(\"StatusSetValue\",\"Enabled\");\n\t\t\tbreak;\n\t\tcase \"2\":\n\t\t\tClientEvents.publish(\"StatusSetValue\",\"Inactive\");\n\t\t\tbreak;\n\t}\n\tClientEvents.publish(\"AccountSetValue\",coll[10]);\n\tClientEvents.publish(\"NotesSetValue\",coll[11]);\n\tClientEvents.publish(\"OwnerSetValue\",coll[12]);\n\tClientEvents.publish(\"TypeSetValue\",coll[13]);\n\tClientEvents.publish(\"TempAPNSetValue\",coll[14]);\n\tClientEvents.publish(\"TempURLSetValue\",coll[15]);\n\tClientEvents.publish(\"AttribsDelAll\",\"\");\n\tClientEvents.publish(\"KeySetValue\",\"\");\n\tClientEvents.publish(\"ValueSetValue\",\"\");\n\tClientEvents.publish(\"TempAttribsDelRows\",\"\");\n\t//if (coll[14] !== \"null\" && coll[14] !== \"\") { // Custom attribs\n\t//\tvar currAttribs = JSON.parse(coll[14]);\n\t//\tif (currAttribs) {\n\t//\t\tClientEvents.publish(\"TempAttribsSetValues\",currAttribs);\n\t//\t\tScript.setState(\"currAttribs\",currAttribs); // Save to statestore for attrib script\n\t//\t}\n\t//}\n}\n\nClientEvents.subscribe(\"UploadFirmware\", function (eventdata, channel) {\n\t//Client.setDirtyFlag();\n\tClient.invokeModal(\"OK\",\"Upload Firmware\", \"Currently not supported in this version of Sensahub. Coming soon...\");\n});\n\nClientEvents.subscribe(\"ModelImgUpload\", function (eventData, channel) {\n\t//TODO: Convert this to system API blob function\n\tClient.selectFiles(\"image/*\", function (files) {\n\t\tvar reader = new FileReader();\n\t\treader.onload = function (e) {\n\t\t\timageBin = e.target.result;\n\t\t\timageName = selectedRec + \".\" + files[0].name.split('.').pop();\n\t\t\tClientEvents.publish(\"TempLoadImage\", imageBin);\n\t\t\tClient.setDirtyFlag();\n\t\t};\n\t\tif (reader.readAsDataURL) {\n\t\t\treader.readAsDataURL(files[0]);\n\t\t}\n\t});\n});"},"ev":{"clientEvents":{"inputEvents":{}},"serverEvents":{"inputEvents":{"DBResult":{"channel":"$DB/ADMIN/MANAGE/RESPONSE","event":"feed"},"DevicesResult":{"channel":"$DEV/ADMIN/MANAGE/RESPONSE","event":"feed","important":"false"},"GetTenantResult":{"channel":"$SYS/SYSTEM/GETTENANTS/RESPONSE","event":"feed","important":"false"}}}}},"TempAccount":{"t":"Dropdown","lX":30,"lY":205,"sX":2.2,"sY":1,"s":"Manage Models","ps":{"enabled":false,"scalingType":"NOVERT","width":"9.26%","height":"4.16%","x":"0.63%","y":"14.98%"},"ver":"190104c190915","dis":false,"tt":"Select default Account to assign device to","a":{"default options":"Brisbane City Council","form id":"devtemplate","tab index":"2","label text":"Account","placeholder":"Select Account"},"ev":{"clientEvents":{"inputEvents":{"EventClear":{"channel":"clear/reset default","event":"reset default"},"setValue":{"channel":"AccountSetValue/receive value","event":"receive value"}}}}},"TempMake":{"t":"Input","lX":30,"lY":270,"sX":2.3,"sY":1,"s":"Manage Models","ps":{"enabled":false,"scalingType":"NOVERT","width":"9.68%","height":"4.29%","x":"1.3%","y":"23.63%"},"ver":"190104c190915","dis":false,"tt":"Device manufacturer (optional).","a":{"color":"grey","form id":"devtemplate","invalid message":"","tab index":"3","label text":"Make"},"ev":{"clientEvents":{"inputEvents":{"SetValue":{"channel":"MakeSetValue/receive value","event":"receive value"},"EventClear":{"channel":"clear/receive value","event":"receive value"}},"outputEvents":{}}}},"TempVersion":{"t":"Input","lX":30,"lY":330,"sX":2.3,"sY":1,"s":"Manage Models","ps":{"enabled":false,"scalingType":"NOVERT","width":"9.63%","height":"4.29%","x":"0.63%","y":"25.62%"},"ver":"190104c190915","dis":false,"tt":"Model version number (optional)","a":{"color":"grey","form id":"devtemplate","invalid message":"","tab index":"4","label text":"Version"},"ev":{"clientEvents":{"inputEvents":{"EventClear":{"channel":"clear/receive value","event":"receive value"},"setValue":{"channel":"VersionSetValue/receive value","event":"receive value"}}}}},"TempLocation":{"t":"Input","lX":505,"lY":330,"sX":2.3,"sY":1,"s":"Manage Models","ps":{"enabled":false,"scalingType":"NOVERT","width":"9.68%","height":"4.29%","x":"25.64%","y":"18.35%"},"ver":"190104c190915","dis":false,"tt":"Default device location (optional)","a":{"color":"grey","form id":"devtemplate","tab index":"5","label text":"Location"},"ev":{"clientEvents":{"inputEvents":{"setValue":{"channel":"LocationSetValue/receive value","event":"receive value"},"EventClear":{"channel":"clear/receive value","event":"receive value"}}}}},"TempApplication":{"t":"Input","lX":265,"lY":205,"sX":2.27,"sY":1,"s":"Manage Models","ps":{"enabled":false,"scalingType":"NOVERT","width":"11.48%","height":"4.29%","x":"12.09%","y":"21.4%"},"ver":"190104c190915","dis":false,"pr":"Default application name using the devices (optional)","tt":"Default application name using the devices (optional)","a":{"color":"grey","form id":"devtemplate","tab index":"6","label text":"Application"},"ev":{"clientEvents":{"inputEvents":{"setValue":{"channel":"ApplicationSetValue/receive value","event":"receive value"},"EventClear":{"channel":"clear/receive value","event":"receive value"}}}}},"TempStatus":{"t":"Dropdown","lX":265,"lY":270,"sX":2.2,"sY":1,"s":"Manage Models","ps":{"enabled":false,"scalingType":"NOVERT","width":"11.13%","height":"4.05%","x":"22.31%","y":"28.11%"},"ver":"190104c190915","dis":false,"tt":"Select default status of device. Device isn't active until enabled.","a":{"default value":"Disabled","default options":"Disabled,Enabled,Inactive","color":"grey","form id":"devtemplate","tab index":"7","label text":"Status"},"ev":{"clientEvents":{"inputEvents":{"eventClear":{"channel":"default/reset default","event":"reset default"},"setValue":{"channel":"StatusSetValue/receive value","event":"receive value"}}}}},"TempType":{"t":"Input","lX":265,"lY":330,"sX":2.27,"sY":1,"s":"Manage Models","ps":{"enabled":false,"scalingType":"NOVERT","width":"11.48%","height":"4.29%","x":"12.09%","y":"21.4%"},"ver":"190104c190915","dis":false,"tt":"Context of device data (eg. temperature sensor, web service weather forecast)","a":{"color":"grey","form id":"devtemplate","tab index":"8","label text":"Type"},"ev":{"clientEvents":{"inputEvents":{"EventClear":{"channel":"clear/receive value","event":"receive value"},"setValue":{"channel":"TypeSetValue/receive value","event":"receive value"}}}}},"TempOwner":{"t":"Input","lX":505,"lY":270,"sX":2.27,"sY":1,"s":"Manage Models","ps":{"enabled":false,"scalingType":"NOVERT","width":"9.47%","height":"4.29%","x":"25.64%","y":"18.35%"},"ver":"190104c190915","dis":false,"tt":"Default owner of the device","a":{"color":"grey","form id":"devtemplate","tab index":"9","label text":"Owner"},"ev":{"clientEvents":{"inputEvents":{"EventClear":{"channel":"clear/receive value","event":"receive value"},"setValue":{"channel":"OwnerSetValue/receive value","event":"receive value"}}}}},"TempNotes":{"t":"Text Area","lX":30,"lY":515,"sX":4.65,"sY":1.31,"s":"Manage Models","ps":{"enabled":false,"scalingType":"OK","width":"19.56%","height":"10.62%","x":"1.26%","y":"36.79%"},"ver":"190104c190915","dis":false,"a":{"color":"grey","form id":"devtemplate","tab index":"10","label text":"Notes"},"ev":{"clientEvents":{"inputEvents":{"EventClear":{"channel":"clear/receive value","event":"receive value"},"setValue":{"channel":"NotesSetValue/receive value","event":"receive value"}}}}},"TempModels":{"t":"Dropdown","lX":265,"lY":75,"sX":2.17,"sY":1,"s":"Manage Models","ps":{"enabled":false,"scalingType":"NOVERT","width":"9.05%","height":"4.07%","x":"0.76%","y":"7.61%"},"ver":"190104c190915","dis":false,"tt":"Select existing model template (for edit) or enter template name (for new)","a":{"default options":"","placeholder":"No records","disable edit":"false","disable spellcheck":"true","form id":"devtemplate","tab index":"1","fire on load":"true","label text":"Model Name","bold":"true"},"ev":{"clientEvents":{"inputEvents":{"EventClear":{"channel":"clear/receive value","event":"receive value"},"dbResult":{"channel":"ModelNameList/receive list","event":"receive list","important":"false"},"Add to list":{"channel":"ModelAddList/append list","event":"append list"},"TempModNameUpd":{"channel":"TempModNameUpd/receive value","event":"receive value"}},"outputEvents":{"selectedItem":{"channel":"ModelSelected/receive value","event":"selected","trigger":"selected"}}}}},"TempAttrib":{"t":"Input","lX":505,"lY":750,"sX":2.3,"sY":1,"s":"Manage Models","ps":{"enabled":false,"scalingType":"NOVERT","width":"9.68%","height":"4.29%","x":"0.72%","y":"17.22%"},"ver":"190104c190915","dis":false,"tt":"testing","a":{"color":"grey","form id":"attribs","invalid message":"","tab index":"11","label text":"Attribute"},"ev":{"clientEvents":{"inputEvents":{"setValue":{"channel":"KeySetValue/receive value","event":"receive value"},"EventClear":{"channel":"clear/receive value","event":"receive value"}}}}},"TempValue":{"t":"Input","lX":505,"lY":810,"sX":2.3,"sY":1,"s":"Manage Models","ps":{"enabled":false,"scalingType":"NOVERT","width":"9.68%","height":"4.29%","x":"10.9%","y":"33.09%"},"ver":"190104c190915","dis":false,"tt":"testing","a":{"color":"grey","form id":"attribs","invalid message":"","tab index":"12","label text":"Default Value"},"ev":{"clientEvents":{"inputEvents":{"EventClear":{"channel":"clear/receive value","event":"receive value"},"setValue":{"channel":"ValueSetValue/receive value","event":"receive value"}}}}},"Button#1":{"t":"Button","lX":465,"lY":940,"sX":1.35,"sY":1,"s":"Manage Models","ps":{"enabled":false,"scalingType":"OK","width":"5.68%","height":"3.73%","x":"19.52%","y":"76.09%"},"ver":"190104c190915","dis":false,"a":{"button name":"Bulk Upload","color":"black","value on":"delete"},"ev":{"clientEvents":{"outputEvents":{"Pressed":{"channel":"ImgUpload/receive value","event":"pressed","trigger":"pressed"}}}}},"TempAttribs":{"t":"Table","lX":30,"lY":725,"sX":4.55,"sY":1.9,"s":"Manage Models","ps":{"enabled":false,"scalingType":"OK","width":"19.14%","height":"15.4%","x":"1.47%","y":"53.32%"},"ver":"190104c190915","dis":false,"a":{"text color":"#1c5f5a","row color":"#ffffff","columns":"attribute,value","colWidths":"0.434878587196468,0.565121412803532","selectable":"single","color rows":"true"},"ev":{"clientEvents":{"inputEvents":{"DelRows":{"channel":"TempAttribsDelRows/delete all rows","event":"delete all rows"},"AttribsSetValues":{"channel":"TempAttribsSetValues/receive value","event":"receive value"},"EventClear":{"channel":"clear/delete all rows","event":"delete all rows"}},"outputEvents":{"SelectedAttrib":{"channel":"SelectedAttrib/receive value","event":"pressed","trigger":"pressed"}}}}},"Button#2":{"t":"Button","lX":615,"lY":940,"sX":1.35,"sY":1,"s":"Manage Models","ps":{"enabled":false,"scalingType":"OK","width":"5.68%","height":"3.84%","x":"19.98%","y":"6.66%"},"ver":"190104c190915","dis":false,"a":{"button name":"Generate Token","color":"black","value on":"delete"},"ev":{"clientEvents":{"outputEvents":{"Pressed":{"channel":"ImgUpload/receive value","event":"pressed","trigger":"pressed"}}}}},"TempBranch":{"t":"Input","lX":265,"lY":395,"sX":2.3,"sY":1,"s":"Manage Models","ps":{"enabled":false,"scalingType":"NOVERT","width":"9.68%","height":"4.29%","x":"25.64%","y":"18.35%"},"ver":"190104c190915","dis":false,"tt":"Default organisational branch name for device (optional)","a":{"color":"grey","form id":"devtemplate","tab index":"5","label text":"Branch"},"ev":{"clientEvents":{"inputEvents":{"EventClear":{"channel":"clear/receive value","event":"receive value"},"setValue":{"channel":"TempBranchSetValue/receive value","event":"receive value"}}}}},"TempGroup":{"t":"Input","lX":505,"lY":205,"sX":2.3,"sY":1,"s":"Manage Models","ps":{"enabled":false,"scalingType":"NOVERT","width":"9.68%","height":"4.29%","x":"25.64%","y":"18.35%"},"ver":"190104c190915","dis":false,"tt":"Default grouping for related devices (optional)","a":{"color":"grey","form id":"devtemplate","tab index":"5","label text":"Group"},"ev":{"clientEvents":{"inputEvents":{"EventClear":{"channel":"clear/receive value","event":"receive value"},"setValue":{"channel":"TempGroupSetValue/receive value","event":"receive value"}}}}},"TempDepartment":{"t":"Input","lX":30,"lY":395,"sX":2.3,"sY":1,"s":"Manage Models","ps":{"enabled":false,"scalingType":"NOVERT","width":"9.68%","height":"4.29%","x":"25.64%","y":"18.35%"},"ver":"190104c190915","dis":false,"tt":"Default organisation department name (optional)","a":{"color":"grey","form id":"devtemplate","tab index":"5","label text":"Department"},"ev":{"clientEvents":{"inputEvents":{"EventClear":{"channel":"clear/receive value","event":"receive value"},"setValue":{"channel":"TempDepartmentSetValue/receive value","event":"receive value"}}}}},"Dropdown#0":{"t":"Dropdown","lX":35,"lY":75,"sX":2.12,"sY":1,"s":"Manage Models","ps":{"enabled":false,"scalingType":"NOVERT","width":"8.83%","height":"4.07%","x":"1.05%","y":"5.51%"},"ver":"190104c190915","dis":false,"tt":"","a":{"label text":"Distributor","default options":"","bold":"true","placeholder":"Select Distributor"},"ev":{"clientEvents":{"inputEvents":{"DistribNameList":{"channel":"DistribNameList/receive list","event":"receive list","important":"false"}}}}},"TempSaveModel":{"t":"Icon","lX":590,"lY":90,"sX":0.8,"sY":0.8,"s":"Manage Models","ps":{"enabled":false,"scalingType":"NOHORIZ,NOVERT","width":"1.68%","height":"3.26%","x":"24.78%","y":"7.21%"},"ver":"190104c190915","dis":false,"tt":"Save Model","a":{"icon file":"floppy","outline color":"no outline"},"ev":{"clientEvents":{"inputEvents":{},"outputEvents":{"Pressed":{"channel":"ModelSave/receive value","event":"pressed","trigger":"pressed"}}}}},"TempClear":{"t":"Icon","lX":505,"lY":95,"sX":0.6,"sY":0.6,"s":"Manage Models","ps":{"enabled":false,"scalingType":"NOHORIZ,NOVERT","width":"1.26%","height":"2.44%","x":"16.87%","y":"7.54%"},"ver":"190104c190915","dis":false,"tt":"Clear Form","a":{"icon file":"x-square","value on":"","outline color":"no outline"},"ev":{"clientEvents":{"inputEvents":{},"outputEvents":{"Pressed":{"channel":"ModelClear/receive value","event":"pressed","trigger":"pressed"}}}}},"TempDeleteModel":{"t":"Icon","lX":550,"lY":95,"sX":0.6,"sY":0.6,"s":"Manage Models","ps":{"enabled":false,"scalingType":"NOHORIZ,NOVERT","width":"1.26%","height":"2.44%","x":"16.87%","y":"7.54%"},"ver":"190104c190915","dis":false,"tt":"Delete Model","a":{"icon file":"trash","outline color":"no outline"},"ev":{"clientEvents":{"inputEvents":{},"outputEvents":{"Pressed":{"channel":"ModelDelete/receive value","event":"pressed","trigger":"pressed"}}}}},"TempUploadPicture":{"t":"Icon","lX":695,"lY":580,"sX":0.6,"sY":0.6,"s":"Manage Models","ps":{"enabled":false,"scalingType":"NOHORIZ,NOVERT","width":"1.26%","height":"2.44%","x":"16.87%","y":"7.54%"},"ver":"190104c190915","dis":false,"tt":"Upload Picture","a":{"icon file":"plus-square","outline color":"no outline"},"ev":{"clientEvents":{"inputEvents":{},"outputEvents":{"Pressed":{"channel":"ModelImgUpload/receive value","event":"pressed","trigger":"pressed"}}}}},"TempFirmware":{"t":"Icon","lX":695,"lY":510,"sX":0.6,"sY":0.6,"s":"Manage Models","ps":{"enabled":false,"scalingType":"NOHORIZ,NOVERT","width":"1.26%","height":"2.44%","x":"16.87%","y":"7.54%"},"ver":"190104c190915","dis":false,"tt":"Upload Firmware","a":{"icon file":"code-square","outline color":"no outline"},"ev":{"clientEvents":{"inputEvents":{},"outputEvents":{"Pressed":{"channel":"UploadFirmware/receive value","event":"pressed","trigger":"pressed"}}}}},"TempSaveAttrib":{"t":"Icon","lX":690,"lY":880,"sX":0.8,"sY":0.8,"s":"Manage Models","ps":{"enabled":false,"scalingType":"NOHORIZ,NOVERT","width":"1.68%","height":"3.26%","x":"23.05%","y":"7.62%"},"ver":"190104c190915","dis":false,"tt":"Save Attribute","a":{"icon file":"floppy","outline color":"no outline"},"ev":{"clientEvents":{"inputEvents":{},"outputEvents":{"Pressed":{"channel":"AttribSave/receive value","event":"pressed","trigger":"pressed"}}}}},"TempDelAttrib":{"t":"Icon","lX":645,"lY":885,"sX":0.6,"sY":0.6,"s":"Manage Models","ps":{"enabled":false,"scalingType":"NOHORIZ,NOVERT","width":"1.26%","height":"2.44%","x":"24.95%","y":"66.53%"},"ver":"190104c190915","dis":false,"tt":"Delete Attribute","a":{"icon file":"trash","outline color":"no outline"},"ev":{"clientEvents":{"inputEvents":{},"outputEvents":{"Pressed":{"channel":"AttribDelete/receive value","event":"pressed","trigger":"pressed"}}}}},"TempAPN":{"t":"Input","lX":505,"lY":395,"sX":2.3,"sY":1,"s":"Manage Models","ps":{"enabled":false,"scalingType":"NOVERT","width":"9.68%","height":"4.29%","x":"21.25%","y":"32.01%"},"ver":"190104c190915","dis":false,"tt":"Default cellular APN  (optional)","a":{"color":"grey","form id":"devtemplate","tab index":"5","label text":"APN"},"ev":{"clientEvents":{"inputEvents":{"EventClear":{"channel":"clear/receive value","event":"receive value"},"setValue":{"channel":"TempAPNSetValue/receive value","event":"receive value"}}}}},"TempURL":{"t":"Input","lX":30,"lY":455,"sX":4.65,"sY":1,"s":"Manage Models","ps":{"enabled":false,"scalingType":"NOVERT","width":"19.35%","height":"4.29%","x":"1.26%","y":"36.79%"},"ver":"190104c190915","dis":false,"tt":"Lookup model details at manufacturer  (optional)","a":{"color":"grey","form id":"devtemplate","tab index":"5","label text":"Model URL"},"ev":{"clientEvents":{"inputEvents":{"EventClear":{"channel":"clear/receive value","event":"receive value"},"setValue":{"channel":"TempURLSetValue/receive value","event":"receive value"}}}}},"TempImage":{"t":"Image","lX":510,"lY":475,"sX":1.75,"sY":1.75,"s":"Manage Models","ps":{"enabled":false,"scalingType":"","width":"7.36%","height":"14.26%","x":"21.46%","y":"38.3%"},"ver":"202605c190915","dis":false,"a":{"image":"","border width":"1"},"ev":{"clientEvents":{"inputEvents":{"Clear":{"channel":"clear/receive value","event":"receive value","important":"false"},"TempLoadImage":{"channel":"TempLoadImage/set image","event":"set image","important":"false"}}}}},"Container#3":{"t":"Container","lX":5,"lY":10,"sX":13.2,"sY":12.1,"s":"Manage Devices","ps":{"enabled":"false","scalingType":"OK","width":"86.39%","height":"98.06%","x":"0.21%","y":"0.83%"},"ver":"190104c190915","z":"110","dis":false,"a":{"color":"grey","title":"Manage Devices"},"ev":{}},"Container#4":{"t":"Container","lX":20,"lY":65,"sX":7.5,"sY":1.05,"s":"Manage Devices","ps":{"enabled":"false","scalingType":"OK","width":"31.55%","height":"8.51%","x":"0.81%","y":"5.49%"},"ver":"190104c190915","z":"110","dis":false,"a":{"title":"","color":"white"},"ev":{}},"Container#5":{"t":"Container","lX":20,"lY":170,"sX":7.5,"sY":4.85,"s":"Manage Devices","ps":{"enabled":"false","scalingType":"OK","width":"31.55%","height":"39.3%","x":"0.93%","y":"13.86%"},"ver":"190104c190915","z":"110","dis":false,"a":{"color":"grey","title":"Edit Device Details"},"ev":{}},"Script#ManageDev":{"t":"Scripting","lX":1340,"lY":45,"sX":1,"sY":1,"s":"Manage Devices","ps":{"enabled":"false","scalingType":"NOSCALE","width":"4.21%","height":"8.1%","x":"56.37%","y":"3.65%"},"ver":"200124c190915","vis":false,"dis":false,"tt":"","a":{"script type":"javascript","code editor":"//# sourceURL=dynamic-script.js\n/**\n * Description: Script to manage Sensahub devices\n * Create Author/Date: Dean Dobson 6/6/20\n * Modified Author/Date: DD 27/9/20\n * Version: 1.2 Changed options to after callback\n */\n\nvar distribs = [];\nvar selectedDistrib = \"\";\nvar selectedModel = \"\";\nvar selectedRec = \"\";\nvar currUser;\nvar selectedAttribKey = \"\";\nvar modelAttribs = \"\"; // Default model attribs\nvar devAttribs = \"\";   // Hold the device attribs\nvar modelDefaults = \"\";\nvar modelURL = \"\";\nvar recLong = 0;\nvar recLat = 0;\nvar existingRecs = []; // List of records for model\nvar existingNames = []; // List of record names (must be unique)\nvar oldName;\nvar recStatus;\nvar locale = Client.getLocale();\n\n// TODO Get the account names\n// TODO: Multiple select / delete in the table (only for delete, how do we edit records multi-selected???\n//TODO: device attributes\n//TODO: Store the API key for M2M lookup with Distributor table\n\n/**\n * Initialise script state (run once at startup)\n */\nScript.on('load', function() {\n\t// Get the distributor and model names\n\tClient.getTenants(function (data) {\n\t\tdistribs = data.value;\n\t\tselectedDistrib = distribs[0];\n\t\t\n\t\tDevices.manageModels(\"read\", selectedDistrib,\"\", function (data) {\n\t\t\tvar models = Object.keys(data.value.data);\n\t\t\tif (models.length === 0) {\n\t\t\t\tClient.status(\"WARNING - There are no models registered, go to the 'Manage Models' screen to initially define a device model template to use for creating Sensahub devices.\", \"IMPORTANT\");\n\t\t\t\tClient.invokeModal(\"OK\",\"No Models Defined\", \"There are no models registered, go to the 'Manage Models' screen to initially create a device model template to use for creating Sensahub devices, then return here to add devices.\");\n\t\t\t} else {\n\t\t\t\tClientEvents.publish(\"DevRecvModels\", models);    // Update the model name dropdown\n\t\t\t}\n\t\t},{\"columns\":\"model\"});\n\t\t\n\t\tClientEvents.publish(\"DevDistribList\", distribs);    // Update the distributor name dropdown\n\t});\n\t\n\tcurrUser = Client.getUser();\n\t// TODO Get the account names\n});\n\n/**\n * Response to message from server channel\n */\nScript.on('server', function(eventData) {\n});\n\n// When an input field has changed, set the dirty flag so users get a warning if they move away\nClientEvents.subscribe(\"changed\", function () {\n\tClient.setDirtyFlag();\n});\n\n// Clear button - reset to model defaults\nClientEvents.subscribe(\"DevReset\", function () {\n\tif (Client.checkDirtyFlag()) {\n\t\tClient.invokeModal(\"OK\",\"Clear Record\", \"Changes have been made to the form that will be deleted if cleared, please confirm you want to clear the form.\", \"Clear\", \"CLEAR\", function (confirm) {\n\t\t\tif (confirm) {\n\t\t\t\tpopulateModelFields(modelDefaults);\n\t\t\t}\n\t\t});\n\t} else {\n\t\tclearRec();\n\t\tpopulateModelFields(modelDefaults);\n\t}\n});\n\n// Save device button\nClientEvents.subscribe(\"DevSave\", function () {\n\tvar formData = Script.getForm(\"DevForm\");\n\tvar oldRec = selectedRec;\n\tselectedRec = formData.DevSerial;\n\t// if existing record needs to be unique not including itself, or if a new record has to be unique\n\tif (formData.DevName === \"\" || existingNames.indexOf(formData.DevName.toUpperCase()) === -1 || \n\t\t(oldRec.toUpperCase() === selectedRec.toUpperCase() && formData.DevName.toUpperCase() === oldName.toUpperCase())) {\n\t\tsaveRecs(formData);\n\t} else {\n\t\tClient.invokeModal(\"OK\",\"Save Device\", \"Can't save device '\"+ selectedRec + \"' as device name '\" + formData.DevName + \"' isn't unique.\");\n\t}\n});\n\n// Delete device button \nClientEvents.subscribe(\"DevDelRec\", function () {\n\tvar formData = Script.getForm(\"devForm\");\n\tselectedRec = formData.DevSerial;\n\tif (selectedRec !== \"\") {\n\t\tif (formData.DevModel !== \"\") {\n\t\t\tClient.status(\"Deleting device '\" + selectedRec + \"' (\" + formData.DevModel + \")...\", \"IMPORTANT\");\n\t\t\tClient.invokeModal(\"OK\",\"Confirm Delete\", \"Please confirm that you want to delete device '\"+ selectedRec + \"' (\" + formData.DevModel + \").\", \"Delete\", \"DELETE\", function (confirm) {\n\t\t\t\tif (confirm) {\n\t\t\t\t\tClient.status(\"Deleting device '\" + selectedRec + \"'...\");\n\t\t\t\t\tDevices.manageDevices(\"delete\", selectedDistrib, selectedModel, function (data) {\n\t\t\t\t\t\tif (data.value > 0) {\n\t\t\t\t\t\t\tClient.clearDirtyFlag();\n\t\t\t\t\t\t\tClient.status(\"Device '\" + selectedRec + \"' deleted.\", \"IMPORTANT\");\n\t\t\t\t\t\t\t// refresh the table\n\t\t\t\t\t\t\tDevices.manageDevices(\"read\", selectedDistrib, selectedModel, function (data) {\n\t\t\t\t\t\t\t\tpopulateTable(data.value);\n\t\t\t\t\t\t\t}, {\"columns\":\"*\"});\n\t\t\t\t\t\t\tpopulateModelFields(modelDefaults);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tClient.invokeModal(\"OK\",\"Delete Record\", \"Device template '\" + selectedRec + \"' didn't delete correctly. Please check input.\");\n\t\t\t\t\t\t\tClient.status(\"WARNING - Device template '\" + selectedRec + \"' didn't delete correctly. Please check input.\", \"IMPORTANT\");\n\t\t\t\t\t\t}\n\t\t\t\t\t}, {\"columns\":\"serialnum\", \"filter\":\"'\" + selectedRec + \"'\"});\n\t\t\t\t}\n\t\t\t});\n\t\t} else {\n\t\t\tClient.status(\"WARNING - Can't perform device delete, no model selected, create a device model template before adding devices...\", \"IMPORTANT\");\n\t\t\tClient.invokeModal(\"OK\",\"Confirm Delete\", \"Can't perform device delete, no model selected, create a device model template before adding devices.\");\n\t\t}\n\t} else {\n\t\tClient.status(\"WARNING - Can't perform device delete, no device selected, select a device name from the table and try again....\", \"IMPORTANT\");\n\t\tClient.invokeModal(\"OK\",\"Confirm Delete\", \"Can't perform device delete, no device selected, select a device name from the table and try again\");\n\t}\n});\n\n// Selected model\nClientEvents.subscribe(\"DevModelSel\", function (selected) {\n\tif (Client.checkDirtyFlag()) {\n\t\tClient.invokeModal(\"OK\",\"Confirm Changing Model\", \"Items on this form have changed, please confirm that you want to select a new model and ignore changes to the form.\", \"Change\", \"CHANGE\", function (confirm) {\n\t\t\tif (confirm) {\n\t\t\t\tselectedModel = selected.value;\n\t\t\t\tClientEvents.publish(\"clear\",\"\");\n\t\t\t\tClient.clearDirtyFlag();\n\t\t\t} else {\n\t\t\t\tClientEvents.publish(\"DevModNameUpd\", selectedModel); // Select old record\n\t\t\t}\n\t\t});\n\t} else {\n\t\tselectedModel = selected.value;\n\t\tClientEvents.publish(\"clear\",\"\");\n\t\t// Get the  model fields from the selected model and populate the form as a default\n\t\tDevices.manageModels(\"read\", selectedDistrib, \"_models\", function (data) {\n\t\t\tvar retData = data.value.data;\n\t\t\tpopulateModelFields(retData[Object.keys(retData)[0]]);\n\t\t\t// Load the entire record for the selected model into the table\n\t\t\tDevices.manageDevices(\"read\", selectedDistrib, selectedModel, function (data) {\n\t\t\t\tpopulateTable(data.value);\n\t\t\t}, {\"columns\":\"*\"});\n\t\t}, {\"columns\":\"*\",\"filter\":\"model='\" + selected.value + \"'\"});\n\t}\n});\n\n// Selected device from table\nClientEvents.subscribe(\"DevTableSelected\", function (selected) {\n\tif (Client.checkDirtyFlag()) {\n\t\tClient.invokeModal(\"OK\",\"Confirm Changing Record\", \"Items on this form have changed, please confirm that you want to select a new model and ignore changes to the form.\", \"Change\", \"NEWREC\", function (confirm) {\n\t\t//TODO: Can consolidate this with the other confirms for changing record.\n\t\t\tif (confirm) {\n\t\t\t\tselectedModel = selected.value;\n\t\t\t\tClientEvents.publish(\"clear\",\"\");\n\t\t\t\tClient.clearDirtyFlag();\n\t\t\t} else {\n\t\t\t\tClientEvents.publish(\"DevModNameUpd\", selectedModel); // Select old record\n\t\t\t}\n\t\t});\n\t} else {\n\t\tselectedRec = Object.keys(selected.value.data)[0];\n\t\tDevices.manageDevices(\"read\", selectedDistrib, selectedModel, function (data) {\n\t\t\tvar retData = data.value.data;\n            // Populate a selected template based on the initial value\n\t\t\tif (data.usrmeta.columns === \"*\" && data.usrmeta.filter != \"\") {\n\t\t\t\tpopulateDeviceFields(retData[Object.keys(retData)[0]]);\n\t\t\t} else {\n\t\t\t\t// Read all records to send to table (but not the model data)\n\t\t\t\tif (data.usrmeta.columns !== \"model\") {\n\t\t\t\t\tpopulateTable(eventData.value);\n\t\t\t\t}\n\t\t\t}\n\t\t}, {\"columns\":\"*\", \"filter\":\"serialnum='\" + selectedRec + \"'\"});\n\t\tClientEvents.publish(\"DevSerialSetVal\", selectedRec);\n\t\tClientEvents.publish(\"DevTableSelRowInp\", selectedRec);\n\t}\n});\n\n// Attrib save button pressed\nClientEvents.subscribe(\"DevSaveAttrib\", function (value) {\n\tClient.invokeModal(\"OK\",\"Update Key\", \"Not available yet.\");\n\treturn;\n\tvar formData = Script.getForm(\"AttribForm\");\n\tvar tableAttribs = formData.DevAttribs;\n\tif (typeof selectedAttribKey !== \"undefined\" && selectedAttribKey !== \"\") {\n\t\ttableAttribs.data[selectedAttribKey] = [selectedAttribKey, formData.DevAttribVal];\n\t\tdevAttribs.data[selectedAttribKey] = [selectedAttribKey, formData.DevAttribVal];\n\t\tClientEvents.publish(\"DevAttribsSetValues\",tableAttribs);\n\t\tClient.status(\"Attribute '\" + selectedAttribKey + \"' updated.\");\n\t\tClientEvents.publish(\"DevValueSetVal\", \"\");\n\t\tselectedAttribKey = \"\";   // reset, user has to select another attrib\n\t\tClient.setDirtyFlag();\n\t} else {\n\t\tClient.invokeModal(\"OK\",\"Update Key\", \"No attribute has been updated due to no attribute being selected. Click on an attribute in the table to select it.\");\n\t}\n});\n\n// Row in attrib table selected event\nClientEvents.subscribe(\"DevAttribSelected\", function (selected) {\n\tselectedAttribKey = Object.keys(selected.value.data)[0];\n\tClientEvents.publish(\"DevValueSetVal\", selected.value.data[selectedAttribKey][1]);\n});\n\n// Clear the record back to defaults\nfunction clearRec() {\n\tClientEvents.publish(\"DevSerialSetVal\",\"\");\n\tClientEvents.publish(\"DevNameSetVal\",\"\");\n\tClientEvents.publish(\"DevLastServicedSetVal\",\"\");\n\tClientEvents.publish(\"DevICCIDSetVal\",\"\");\n\tClientEvents.publish(\"DevIMEISetVal\",\"\");\n\tClientEvents.publish(\"DevNumberSetVal\",\"\");\n\tClientEvents.publish(\"DevAddedSetVal\",\"--\");\n\tClientEvents.publish(\"DevModSetVal\",\"--\");\n\tClientEvents.publish(\"DevBattlevelSetVal\",\"--\");\n\tClientEvents.publish(\"DevSignalSetVal\",\"--\");\n\tClientEvents.publish(\"DevTotConnSetVal\",\"--\");\n\tClientEvents.publish(\"DevLastValSetVal\",\"--\");\n\tClientEvents.publish(\"DevLastSeenSetVal\",\"--\");\n\tselectedRec = \"\";\n}\n\n// Main table\nfunction populateTable(collection) {\n\t//TODO: remap column names to more friendly\n\texistingRecs = [];\n\texistingNames = [];\n\tObject.keys(collection.data).forEach(function (item) {\n\t\tswitch (collection.data[item][9]) {\n\t\t\tcase \"0\":\n\t\t\t\tcollection.data[item][9] = \"Disabled\";\n\t\t\t\tbreak;\n\t\t\tcase \"1\":\n\t\t\t\tcollection.data[item][9] = \"Enabled\";\n\t\t\t\tbreak;\n\t\t\tcase \"2\":\n\t\t\t\tcollection.data[item][9] = \"Inactive\";\n\t\t\t\tbreak;\n\t\t}\n\t\tcollection.data[item][13] = convertDateTime(+collection.data[item][13] * 1000);\n\t\texistingNames.push(collection.data[item][1]);\n\t\texistingRecs.push(item.toUpperCase()); // For testing if new record\n\t});\n\tClientEvents.publish(\"DevDelAllRows\", \"\"); // Clear table first\n\tClientEvents.publish(\"DevSetValues\", collection);\n\t//if (selectedRec !== \"\") { // Once table has been reloaded, select the record previously selected to highlight it\n\t//\tClientEvents.publish(\"DevTableSelRowInp\", selectedRec);\n\t//}\n}\n\nfunction convertDateTime(dateTime) {\n\tif (dateTime == 0) {\n\t\treturn \"never\";\n\t} else {\n\t\treturn new Date(dateTime).toLocaleDateString(locale) + \" \" + new Date(dateTime).toLocaleTimeString(locale);\n\t}\t\t\t\n}\n\n// Save form to database\nfunction saveRecs(formData) {\n\tif (selectedRec !== \"\") {\n\t\tif (formData.DevModels !== \"\") {\n\t\t\tvar currDate = Date.now();\n\t\t\tvar dbRec = {};\n\t\t\tClient.status(\"Saving device details for '\" + formData.DevSerial + \"' (\" + formData.DevModel + \")...\");\n\t\t\tif (formData.DevStatus === \"Enabled\" && status !== 1) {\n\t\t\t\tdbRec.whoenabled = currUser;\n\t\t\t\tdbRec.whenenabled = currDate;\n\t\t\t}\n\t\t\tif (formData.DevStatus === \"Disabled\" && status !== 0) {\n\t\t\t\tdbRec.whodisabled = currUser;\n\t\t\t\tdbRec.whendisabled = currDate;\n\t\t\t}\n\t\t\tvar status = 0;\n\t\t\tswitch (formData.DevStatus) {\n\t\t\t\tcase \"Enabled\":\n\t\t\t\t\tstatus = 1;\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"Inactive\":\n\t\t\t\t\tstatus = 2;\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\t// Populate a dbRequest object to send to server\n\t\t\tdbRec.serialnum = formData.DevSerial;\n\t\t\tdbRec.name = formData.DevName;\n\t\t\tdbRec.account = formData.DevAccount;\n\t\t\tdbRec.version = formData.DevVersion;\n\t\t\tdbRec.groupname = formData.DevGroup;\n\t\t\tdbRec.iccid = formData.DevICCID;\n\t\t\tdbRec.imei = formData.DevIMEI;\n\t\t\tdbRec.number = formData.DevNumber;\n\t\t\tdbRec.apn = formData.DevAPN;\n\t\t\tdbRec.branch = formData.DevBranch;\n\t\t\tdbRec.department = formData.DevDepartment;\n\t\t\tdbRec.location = formData.DevLocation;\t\t\t\n\t\t\tdbRec.application = formData.DevApplication;\n\t\t\tdbRec.lastserviced = formData.DevLastServiced;\n\t\t\tdbRec.status = status;\n\t\t\tdbRec.owner = formData.DevOwner;\n\t\t\tdbRec.notes = formData.DevNotes;\n\t\t\tdbRec.whenmodified = currDate;\n\t\t\tdbRec.whomodified = currUser;\n\t\t\tif (existingRecs.indexOf(selectedRec.toUpperCase()) === -1) { // New record\n\t\t\t\tdbRec.whenadded = currDate;\n\t\t\t\tdbRec.whoadded = currUser;\n\t\t\t}\n\t\t\t// Get attribs\n\t\t\t//dbRec.attribs = JSON.stringify(devAttribs);\n\t\t\tvar dbReq = {};\n\t\t\tdbReq[formData.DevSerial] = dbRec;\n\t\t\tDevices.manageDevices(\"save\", selectedDistrib, formData.DevModel, function (data) {\n\t\t\t\tif (data.value > 0) {\n\t\t\t\t\tClient.clearDirtyFlag();\n\t\t\t\t\tClient.status(\"Device '\" + selectedRec + \"' (\" + selectedModel + \") saved.\");\n\t\t\t\t\t// Refresh table for changes\n\t\t\t\t\tDevices.manageDevices(\"read\", selectedDistrib, selectedModel, function (data) {\n\t\t\t\t\t\tpopulateTable(data.value);\n\t\t\t\t\t}, {\"columns\":\"*\"});\n\t\t\t\t\tClient.clearDirtyFlag();\n\t\t\t\t} else {\n\t\t\t\t\tClient.invokeModal(\"OK\",\"Save Record\", \"Device template '\" + selectedRec + \"' didn't save correctly. Please check input.\");\n\t\t\t\t\tClient.status(\"WARNING - Device template '\" + selectedRec + \"' didn't save correctly. Please check input.\", \"IMPORTANT\");\n\t\t\t\t}\n\t\t\t}, {\"data\":dbReq});\n\t\t} else {\n\t\t\tClient.status(\"WARNING - No model name specified. Please select a device model name and enter a unique device ID like a serial number.\", \"IMPORTANT\");\n\t\t\tClient.invokeModal(\"OK\",\"New or Update Device\", \"No model name specified. Please select a device model name and enter a unique device ID like a serial number.\");\t\t\n\t\t}\n\t} else {\n\t\tClient.status(\"WARNING - No unique ID specified. Please select a device model name and enter a unique device ID like a serial number or select a table record.\", \"IMPORTANT\");\n\t\tClient.invokeModal(\"OK\",\"New or Update Device\", \"No unique ID specified. Please select a device model name and enter a unique device ID like a serial number or select a table record.\");\n\t}\n}\n\n// populate the widget fields from model template data returned from server (when selecting a new device)\nfunction populateModelFields(coll) {\n\tif (typeof coll !== \"undefined\") {\n\t\tclearRec();\n\t\tClientEvents.publish(\"DevApplicationSetVal\",coll[1]);\n\t\tClientEvents.publish(\"DevMakeSetVal\",coll[2]);\n\t\tClientEvents.publish(\"DevVersionSetVal\",coll[3]);\n\t\tClientEvents.publish(\"DevLocationSetVal\",coll[4]);\n\t\tClientEvents.publish(\"DevGroupSetVal\",coll[5]);\n\t\tClientEvents.publish(\"DevBranchSetVal\",coll[6]);\n\t\tClientEvents.publish(\"DevDepartmentSetVal\",coll[7]);\n\t\tClientEvents.publish(\"DevSetImage\",\"../images/devices/\" + selectedDistrib + \"/\" + coll[8]);\n\t\tswitch (coll[9]) {   // Status\n\t\t\tcase \"0\":\n\t\t\t\tClientEvents.publish(\"DevStatusSetVal\",\"Disabled\");\n\t\t\t\tbreak;\n\t\t\tcase \"1\":\n\t\t\t\tClientEvents.publish(\"DevStatusSetVal\",\"Enabled\");\n\t\t\t\tbreak;\n\t\t\tcase \"2\":\n\t\t\t\tClientEvents.publish(\"DevStatusSetVal\",\"Inactive\");\n\t\t\t\tbreak;\n\t\t}\n\t\tClientEvents.publish(\"DevAccountSetVal\",coll[10]);\n\t\tClientEvents.publish(\"DevOwnerSetVal\",coll[12]);\n\t\tClientEvents.publish(\"DevTypeSetVal\",coll[13]);\n\t\tClientEvents.publish(\"DevAPNSetVal\",coll[14]);\n\t\tmodelURL = coll[15];\n\t\t//ClientEvents.publish(\"DevValueSetVal\",\"\");\n\t/*\tif (coll[14] !== \"null\" && coll[14] !== \"\") { // Custom attribs\n\t\t\tvar currAttribs = JSON.parse(coll[14]);\n\t\t\tif (currAttribs && currAttribs.value) {\n\t\t\t\tClientEvents.publish(\"DevAttribsSetValues\",currAttribs.value);\n\t\t\t\tmodelAttribs = currAttribs.value;\n\t\t\t}\n\t\t}*/\n\t\tmodelDefaults = coll;\n\t} else {\n\t\talert(\"Can't populate model fields as record is blank\");\n\t}\n}\n\n// populate the widget fields from device data returned from server\nfunction populateDeviceFields(coll) {\n\tClientEvents.publish(\"DevNameSetVal\",coll[1]);\n\toldName = coll[1];\n\tClientEvents.publish(\"DevApplicationSetVal\",coll[2]);\n\tClientEvents.publish(\"DevVersionSetVal\",coll[3]);\n\tClientEvents.publish(\"DevLastServicedSetVal\",coll[4]);\n\tClientEvents.publish(\"DevLocationSetVal\",coll[5]);\n\tClientEvents.publish(\"DevGroupSetVal\",coll[6]);\n\tClientEvents.publish(\"DevDepartmentSetVal\",coll[7]);\n\tClientEvents.publish(\"DevBranchSetVal\",coll[8]);\n\tvar recStatus = \"Disabled\";\n\tswitch (coll[9]) {   // Status\n\t\tcase \"1\":\n\t\t\trecStatus = \"Enabled\";\n\t\t\tbreak;\n\t\tcase \"2\":\n\t\t\trecStatus = \"Inactive\";\n\t\t\tbreak;\n\t}\n\tClientEvents.publish(\"DevStatusSetVal\",recStatus);\n\tClientEvents.publish(\"DevAccountSetVal\",coll[10]);\n\tClientEvents.publish(\"DevOwnerSetVal\",coll[11]);\n\tClientEvents.publish(\"DevNotesSetVal\",coll[12]);\n\tClientEvents.publish(\"DevLastSeenSetVal\",convertDateTime(+coll[13] * 1000));\n\tClientEvents.publish(\"DevICCIDSetVal\",coll[14]);\n\tClientEvents.publish(\"DevIMEISetVal\",coll[15]);\n\tClientEvents.publish(\"DevAPNSetVal\",coll[16]);\n\tClientEvents.publish(\"DevNumberSetVal\",coll[17]);\n\tif (coll[18] === \"\") {\n\t\tClientEvents.publish(\"DevLastValSetVal\",\"--\");\n\t} else {\n\t\tClientEvents.publish(\"DevLastValSetVal\",coll[18]);\n\t}\n\tClientEvents.publish(\"DevTotConnSetVal\",coll[19]);\n\tClientEvents.publish(\"DevAddedSetVal\",convertDateTime(+coll[20]));\n\t// Who added 21\n\tClientEvents.publish(\"DevModSetVal\",convertDateTime(+coll[22]));\n\t// WHo modified 23\n\t// WHen disabled 24\n\t// Who disabled 25\n\t// When enabled 26\n\t// WHo enabled 27\n\trecLong = coll[28];\n\trecLat = coll[29];\n\tClientEvents.publish(\"DevSignalSetVal\",coll[30]);\n\tClientEvents.publish(\"DevBattLevelSetVal\",coll[31]);\n\tClientEvents.publish(\"DeleteAttribs\", \"\");\n\t//ClientEvents.publish(\"DevAttribsSetValues\",modelAttribs); // Reset to default attribs\n\t//if (coll[32] !== \"null\" && coll[32] !== \"\") { // Custom attribs\n\t//\tdevAttribs = JSON.parse(coll[32]);\n\t//\tClientEvents.publish(\"DevAttribsSetValues\",devAttribs);\n\t//}\n}\n\nClientEvents.subscribe(\"DevLaunchURL\", function () {\n\tif (modelURL !== \"\") {\n\t\tClient.launchTabURL(modelURL);\n\t} else {\n\t\tif (selectedModel === \"\") {\n\t\t\tselectedModel = \"No Model Selected\";\n\t\t}\n\t\tClient.invokeModal(\"OK\",\"Get Model Help\", \"No URL has been specified for the model '\" + selectedModel + \"'. Edit the model template and enter in the relevant manufacturer URL.\");\n\t}\n});\n\nClientEvents.subscribe(\"DevLaunchMap\", function () {\n\tif (recLong !== 0 && recLat !== 0) {\n\t\tClient.launchTabURL(\"https://maps.google.com/maps?t=m&q=\" + recLat + \"+\" + recLong);\n\t} else {\n\t\tif (selectedRec === \"\") {\n\t\t\tselectedRec = \"No Device Selected\";\n\t\t}\n\t\tClient.invokeModal(\"OK\",\"Lookup Device Location\", \"This device '\" + selectedRec + \"' has not registered a GPS location, map can't be shown.\");\n\t}\n});"},"ev":{"clientEvents":{"inputEvents":{"New":{"channel":"ButNew/receive value","event":"receive value"}}},"serverEvents":{"inputEvents":{"$DEV":{"channel":"$DEV/ADMIN/MANAGE/RESPONSE","event":"feed","important":"false"},"GetTenants":{"channel":"$SYS/SYSTEM/GETTENANTS/RESPONSE","event":"feed","important":"false"}}}}},"DevAccount":{"t":"Dropdown","lX":30,"lY":285,"sX":2.2,"sY":1,"s":"Manage Devices","ps":{"enabled":"false","scalingType":"NOVERT","width":"9.26%","height":"4.19%","x":"2.71%","y":"19.86%"},"ver":"190104c190915","dis":false,"tt":"Account device is allocated to","a":{"form id":"DevForm","default options":"Brisbane City Council","placeholder":"Select Account","tab index":"4","label text":"Account"},"ev":{"clientEvents":{"inputEvents":{"SetVal":{"channel":"DevAccountSetVal/receive value","event":"receive value"},"Clear":{"channel":"clear/reset default","event":"reset default"}}}}},"DevMake":{"t":"Input","lX":515,"lY":285,"sX":2.3,"sY":1,"s":"Manage Devices","ps":{"enabled":"false","scalingType":"NOVERT","width":"9.68%","height":"4.29%","x":"10.52%","y":"10.9%"},"ver":"270520c190915","dis":false,"tt":"Manufacturer of the device","a":{"tab index":"5","color":"grey","form id":"DevForm","label text":"Make"},"ev":{"clientEvents":{"inputEvents":{"SetVal":{"channel":"DevMakeSetVal/receive value","event":"receive value"},"Clear":{"channel":"clear/receive value","event":"receive value"}}}}},"DevVersion":{"t":"Input","lX":30,"lY":405,"sX":0.65,"sY":1,"s":"Manage Devices","ps":{"enabled":"false","scalingType":"NOVERT","width":"2.76%","height":"4.29%","x":"10.52%","y":"10.9%"},"ver":"270520c190915","dis":false,"tt":"Device version number","a":{"tab index":"6","color":"grey","form id":"DevForm","label text":"Version"},"ev":{"clientEvents":{"inputEvents":{"SetVal":{"channel":"DevVersionSetVal/receive value","event":"receive value"},"Clear":{"channel":"clear/receive value","event":"receive value"}}}}},"DevType":{"t":"Input","lX":30,"lY":465,"sX":2.3,"sY":1,"s":"Manage Devices","ps":{"enabled":"false","scalingType":"NOVERT","width":"9.68%","height":"4.29%","x":"10.52%","y":"10.9%"},"ver":"270520c190915","dis":false,"tt":"Context of incoming data (eg. temperature)","a":{"tab index":"11","color":"grey","form id":"DevForm","label text":"Type"},"ev":{"clientEvents":{"inputEvents":{"SetVal":{"channel":"DevTypeSetVal/receive value","event":"receive value"},"Clear":{"channel":"clear/receive value","event":"receive value"}}}}},"DevLocation":{"t":"Input","lX":30,"lY":345,"sX":2.3,"sY":1,"s":"Manage Devices","ps":{"enabled":"false","scalingType":"NOVERT","width":"9.72%","height":"4.29%","x":"11.88%","y":"19.72%"},"ver":"270520c190915","dis":false,"tt":"Where the device is located","a":{"tab index":"8","color":"grey","form id":"DevForm","label text":"Location"},"ev":{"clientEvents":{"inputEvents":{"SetVal":{"channel":"DevLocationSetVal/receive value","event":"receive value"},"Clear":{"channel":"clear/receive value","event":"receive value"}}}}},"DevApplication":{"t":"Input","lX":270,"lY":220,"sX":2.3,"sY":1,"s":"Manage Devices","ps":{"enabled":"false","scalingType":"NOVERT","width":"9.68%","height":"4.29%","x":"10.52%","y":"10.9%"},"ver":"270520c190915","dis":false,"tt":"Application using device data","a":{"tab index":"9","color":"grey","form id":"DevForm","label text":"Application"},"ev":{"clientEvents":{"inputEvents":{"SetVal":{"channel":"DevApplicationSetVal/receive value","event":"receive value"},"Clear":{"channel":"clear/receive value","event":"receive value"}}}}},"DevStatus":{"t":"Dropdown","lX":270,"lY":285,"sX":2.2,"sY":1,"s":"Manage Devices","ps":{"enabled":"false","scalingType":"NOVERT","width":"9.26%","height":"4.05%","x":"2.71%","y":"19.86%"},"ver":"190104c190915","dis":false,"tt":"Device status. Must be enabled for incoming data to be accepted","a":{"form id":"DevForm","default options":"Disabled,Enabled,Inactive","color":"grey","placeholder":"Select Account","tab index":"10","default value":"Disabled","label text":"Status"},"ev":{"clientEvents":{"inputEvents":{"SetVal":{"channel":"DevStatusSetVal/receive value","event":"receive value"},"Clear":{"channel":"clear/reset default","event":"reset default"}}}}},"DevImage":{"t":"Image","lX":1095,"lY":125,"sX":1.85,"sY":1.85,"s":"Manage Devices","ps":{"enabled":"false","scalingType":"","width":"7.78%","height":"15.08%","x":"45.98%","y":"10.29%"},"ver":"202605c190915","dis":false,"a":{"border width":"1","image":""},"ev":{"clientEvents":{"inputEvents":{"DevImageSetValue":{"channel":"DevSetImage/set image","event":"set image"}}}}},"DevSerial":{"t":"Input","lX":440,"lY":90,"sX":1.8,"sY":1,"s":"Manage Devices","ps":{"enabled":"false","scalingType":"NOVERT","width":"7.57%","height":"4.32%","x":"11.36%","y":"7.46%"},"ver":"190104c190915","dis":false,"tt":"Enter unique ID to identify incoming data","a":{"color":"grey","form id":"DevForm","invalid message":"","tab index":"2","label text":"Unique Id / Serial","bold":"true"},"ev":{"clientEvents":{"inputEvents":{"EventClear":{"channel":"clear/receive value","event":"receive value"},"DevSerialSetVal":{"channel":"DevSerialSetVal/receive value","event":"receive value"}}}}},"Container#7":{"t":"Container","lX":770,"lY":65,"sX":5.3,"sY":4.25,"s":"Manage Devices","ps":{"enabled":"false","scalingType":"OK","width":"22.3%","height":"34.72%","x":"0.81%","y":"13.95%"},"ver":"190104c190915","z":"110","dis":false,"a":{"color":"grey","title":"Device Statistics"},"ev":{}},"DevNotes":{"t":"Text Area","lX":30,"lY":525,"sX":4.7,"sY":1.15,"s":"Manage Devices","ps":{"enabled":"false","scalingType":"OK","width":"19.77%","height":"9.24%","x":"1.35%","y":"37.68%"},"ver":"190104c190915","dis":false,"a":{"color":"grey","form id":"DevForm","tab index":"13","label text":"Notes"},"ev":{"clientEvents":{"inputEvents":{"EventClear":{"channel":"clear/receive value","event":"receive value"},"SetVal":{"channel":"DevNotesSetVal/receive value","event":"receive value"}}}}},"DevModel":{"t":"Dropdown","lX":235,"lY":90,"sX":1.95,"sY":1,"s":"Manage Devices","ps":{"enabled":"false","scalingType":"NOVERT","width":"8.2%","height":"4.07%","x":"9.09%","y":"7.29%"},"ver":"190104c190915","dis":false,"tt":"Select device model name","a":{"placeholder":"Select Model","default options":"","fire on load":"true","form id":"DevForm","tab index":"1","bold":"true","label text":"Select / Enter Model"},"ev":{"clientEvents":{"inputEvents":{"Receive Models":{"channel":"DevRecvModels/receive list","event":"receive list"},"DevModNameUpd":{"channel":"DevModSelUpd/receive value","event":"receive value"}},"outputEvents":{"SelectedItem":{"channel":"DevModelSel/receive value","event":"selected","trigger":"selected"}}}}},"DevName":{"t":"Input","lX":30,"lY":220,"sX":2.3,"sY":1,"s":"Manage Devices","ps":{"enabled":"false","scalingType":"NOVERT","width":"9.63%","height":"4.29%","x":"1.43%","y":"14.51%"},"ver":"270520c190915","z":"110","dis":false,"tt":"Friendly name or alias for device","a":{"tab index":"3","color":"grey","form id":"DevForm","label text":"Name (alias)"},"ev":{"clientEvents":{"inputEvents":{"SetVal":{"channel":"DevNameSetVal/receive value","event":"receive value"},"Clear":{"channel":"clear/receive value","event":"receive value"}},"outputEvents":{"onchange":{"channel":"changed/receive value","event":"on change","trigger":"on change"}}}}},"Graph#0":{"t":"Graph","lX":775,"lY":315,"sX":2.5,"sY":0.8,"s":"Manage Devices","ps":{"enabled":"false","scalingType":"OK","width":"21.03%","height":"12.97%","x":"32.6%","y":"25.61%"},"ver":"190104c190915","dis":false,"a":{"line type":"linear","history timespan":"240","title":"Connections / Day","x-axis":"days","y-axis":"number"},"ev":{}},"Container#8":{"t":"Container","lX":800,"lY":125,"sX":2.9,"sY":1.9,"s":"Manage Devices","ps":{"enabled":"false","scalingType":"OK","width":"12.2%","height":"15.52%","x":"33.57%","y":"10.13%"},"ver":"190104c190915","z":"110","dis":false,"a":{"color":"grey","title":""},"ev":{}},"DevLastSeen":{"t":"Label","lX":815,"lY":130,"sX":2.65,"sY":1,"s":"Manage Devices","ps":{"enabled":"false","scalingType":"OK","width":"11.15%","height":"2.04%","x":"34.29%","y":"10.45%"},"ver":"200124c190915","dis":false,"a":{"font size":"14","label text":"<font color=\"#777777\">Last Seen:</font> <font color=\"#555555\" style=\"\"><b>[#]</b></font>"},"ev":{"clientEvents":{"inputEvents":{"DevLastSeenSetVal":{"channel":"DevLastSeenSetVal/receive value","event":"receive value"}}}}},"DevLastVal":{"t":"Label","lX":815,"lY":155,"sX":2.65,"sY":1,"s":"Manage Devices","ps":{"enabled":"false","scalingType":"OK","width":"11.15%","height":"2.04%","x":"22.3%","y":"17.77%"},"ver":"200124c190915","dis":false,"a":{"font size":"14","label text":"<font color=\"#777777\">Last Value:</font> <b><font color=\"#555555\">[#]</font></b>"},"ev":{"clientEvents":{"inputEvents":{"DevLastValSetVal":{"channel":"DevLastValSetVal/receive value","event":"receive value"}}}}},"DevTotConn":{"t":"Label","lX":815,"lY":180,"sX":2.65,"sY":1,"s":"Manage Devices","ps":{"enabled":"false","scalingType":"OK","width":"11.15%","height":"2.04%","x":"22.3%","y":"17.77%"},"ver":"200124c190915","dis":false,"a":{"font size":"14","label text":"<font color=\"#777777\">Connections: </font><b><font color=\"#555555\">[#]</font></b>"},"ev":{"clientEvents":{"inputEvents":{"DevTotConnSetVal":{"channel":"DevTotConnSetVal/receive value","event":"receive value"}}}}},"DevAdded":{"t":"Label","lX":815,"lY":255,"sX":2.6,"sY":1,"s":"Manage Devices","ps":{"enabled":"false","scalingType":"OK","width":"10.94%","height":"2.04%","x":"22.3%","y":"17.77%"},"ver":"200124c190915","z":"110","dis":false,"a":{"font size":"14","label text":"<font color=\"#777777\">Added: </font><b><font color=\"#555555\">[#]</font></b>"},"ev":{"clientEvents":{"inputEvents":{"DevAddedSetVal":{"channel":"DevAddedSetVal/receive value","event":"receive value"}}}}},"DevMod":{"t":"Label","lX":815,"lY":280,"sX":2.65,"sY":1,"s":"Manage Devices","ps":{"enabled":"false","scalingType":"OK","width":"11.15%","height":"2.04%","x":"22.3%","y":"17.77%"},"ver":"200124c190915","z":"110","dis":false,"a":{"font size":"14","label text":"<font color=\"#777777\">Modified: </font><b><font color=\"#555555\">[#]</font></b>"},"ev":{"clientEvents":{"inputEvents":{"DevModSetVal":{"channel":"DevModSetVal/receive value","event":"receive value"}}}}},"DevTable":{"t":"Table","lX":20,"lY":655,"sX":12.75,"sY":5.4,"s":"Manage Devices","ps":{"enabled":"false","scalingType":"OK","width":"83.44%","height":"44.01%","x":"0.84%","y":"53.08%"},"ver":"190104c190915","dis":false,"tt":"","a":{"text color":"#004d44","columns":"serialnum,name,status,lastseen,iccid,imei,number","title":"Device List","display header":"true","selectable":"multi","enable search":"true","row color":"#000000","colWidths":"0.11084905660377359,0.1139937106918239,0.07940251572327043,0.14858490566037735,0.1957547169811321,0.1360062893081761,0.1761006289308176"},"ev":{"clientEvents":{"inputEvents":{"DevSetValues":{"channel":"DevSetValues/receive value","event":"receive value","important":"true"},"DeleteAllRows":{"channel":"DevDelAllRows/delete all rows","event":"delete all rows","important":"false"},"DevTableSelRowInp":{"channel":"DevTableSelRowInp/highlight row","event":"highlight row","important":"false"}},"outputEvents":{"Selected":{"channel":"DevTableSelected/receive value","event":"pressed","trigger":"pressed","important":"false"}}}}},"Container#9":{"t":"Container","lX":1050,"lY":495,"sX":2.5,"sY":0.9,"s":"Manage Devices","ps":{"enabled":"false","scalingType":"OK","width":"10.52%","height":"7.29%","x":"44.17%","y":"40.19%"},"ver":"190104c190915","z":"110","dis":false,"a":{"title":"","color":"grey"},"ev":{}},"DevLastServiced":{"t":"Input","lX":90,"lY":405,"sX":1.7,"sY":1,"s":"Manage Devices","ps":{"enabled":"false","scalingType":"NOVERT","width":"7.15%","height":"4.29%","x":"3.87%","y":"32.74%"},"ver":"270520c190915","dis":false,"tt":"Device version number","a":{"tab index":"7","color":"grey","form id":"DevForm","type":"date","label text":"Last Serviced"},"ev":{"clientEvents":{"inputEvents":{"Clear":{"channel":"clear/receive value","event":"receive value"},"SetVal":{"channel":"DevLastServicedSetVal/receive value","event":"receive value"}}}}},"DevAttribs":{"t":"Table","lX":770,"lY":495,"sX":2.65,"sY":1.45,"s":"Manage Devices","ps":{"enabled":"false","scalingType":"OK","width":"11.15%","height":"11.75%","x":"32.39%","y":"40.19%"},"ver":"190104c190915","dis":false,"a":{"text color":"#1c5f5a","row color":"#ffffff","columns":"attribute,value","colWidths":"0.42585551330798477,0.5741444866920152","form id":"AttribForm","selectable":"single","color rows":"true"},"ev":{"clientEvents":{"inputEvents":{"ReceiveValue":{"channel":"DevAttribsSetValues/receive value","event":"receive value"},"DeleteAttribs":{"channel":"DeleteAttribs/delete all rows","event":"delete all rows"}},"outputEvents":{"Selected":{"channel":"DevAttribSelected/receive value","event":"pressed","trigger":"pressed"}}}}},"DevAttribVal":{"t":"Input","lX":1055,"lY":505,"sX":1.87,"sY":1,"s":"Manage Devices","ps":{"enabled":"false","scalingType":"NOVERT","width":"7.78%","height":"4.29%","x":"44.55%","y":"31.2%"},"ver":"270520c190915","z":"110","dis":false,"tt":"Context of incoming data (eg. temperature)","a":{"tab index":"10","color":"grey","form id":"AttribForm","label text":"Edit Attribute Value"},"ev":{"clientEvents":{"inputEvents":{"SetVal":{"channel":"DevValueSetVal/receive value","event":"receive value"},"EventClear":{"channel":"clear/receive value","event":"receive value"}}}}},"DevGroup":{"t":"Input","lX":515,"lY":220,"sX":2.3,"sY":1,"s":"Manage Devices","ps":{"enabled":"false","scalingType":"NOVERT","width":"9.68%","height":"4.29%","x":"10.52%","y":"10.9%"},"ver":"270520c190915","dis":false,"tt":"Group name for related devices","a":{"tab index":"12","color":"grey","form id":"DevForm","label text":"Group"},"ev":{"clientEvents":{"inputEvents":{"Clear":{"channel":"clear/receive value","event":"receive value"},"SetVal":{"channel":"DevGroupSetVal/receive value","event":"receive value"}}}}},"DevBranch":{"t":"Input","lX":270,"lY":405,"sX":2.3,"sY":1,"s":"Manage Devices","ps":{"enabled":"false","scalingType":"NOVERT","width":"9.72%","height":"4.29%","x":"11.88%","y":"19.72%"},"ver":"270520c190915","dis":false,"tt":"Organisation branch where the device is located","a":{"tab index":"8","color":"grey","form id":"DevForm","label text":"Branch"},"ev":{"clientEvents":{"inputEvents":{"Clear":{"channel":"clear/receive value","event":"receive value"},"SetVal":{"channel":"DevBranchSetVal/receive value","event":"receive value"}}}}},"DevDepartment":{"t":"Input","lX":270,"lY":345,"sX":2.3,"sY":1,"s":"Manage Devices","ps":{"enabled":"false","scalingType":"NOVERT","width":"9.72%","height":"4.29%","x":"11.88%","y":"19.72%"},"ver":"270520c190915","dis":false,"tt":"Organisation department where the device is located","a":{"tab index":"8","color":"grey","form id":"DevForm","label text":"Department"},"ev":{"clientEvents":{"inputEvents":{"Clear":{"channel":"clear/receive value","event":"receive value"},"SetVal":{"channel":"DevDepartmentSetVal/receive value","event":"receive value"}}}}},"DevLookupScript":{"t":"Scripting","lX":1345,"lY":175,"sX":1,"sY":1,"s":"Manage Devices","ps":{"enabled":"false","scalingType":"NOSCALE","width":"","height":"","x":"","y":""},"ver":"200124c190915","vis":false,"dis":false,"tt":"","a":{"script type":"javascript","code editor":"//# sourceURL=dynamic-script.js\n/**\n * Description: Lookup M2M SIM details\n * Create Author/Date: Dean Dobson 27/6/20\n * Modified Author/Date Date: \n * Version: \n */\n\n//TODO: Put this somewhere more secure\nvar APIKey = \"YnJlbmRhbndpbGxpYW1zb24xOmEzM2E1MTg3LTJkMjgtNDA5My1iMTgwLTJiZjBhN2YyN2VhZQ==\";\n\t//89610180003439854330\n\nClientEvents.subscribe(\"DevActivateSim\", function () {\n\tvar iccid = checkICCID();\n\tif (iccid) {\n\t\tClient.sendXmlHttpRequest(\"PUT\", \"https://restapi10.jasper.com/rws/api/v1/devices/\" + iccid , \n\t\t\t{type:\"text\", data:JSON.stringify({status:\"ACTIVATED\"}), headers:{Accept:\"application/json\",\"Content-Type\":\"application/json\",Authorization:\"Basic \" + APIKey}}, function () {\n\t\t\tif (this.readyState == 4) {\n\t\t\t\t\tif (this.status == 200) {\n\t\t\t\t\tClient.invokeModal(\"OK\",\"Cellular SIM ICCID \" + iccid, \"SIM has been activated. Status: \" + this.responseText);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tClient.invokeModal(\"OK\",\"Cellular details for ICCID \" + iccid, \"Error returned status: \" + this.status + \", error: \" + this.responseText);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\t}\n});\n\nClientEvents.subscribe(\"DevDeactivateSim\", function () {\n\tvar iccid = checkICCID();\n\tif (iccid) {\n\t\tSystem.sendXmlHttpRequest(\"PUT\", \"https://restapi10.jasper.com/rws/api/v1/devices/\" + iccid , \n\t\t\t{type:\"text\", data:JSON.stringify({status:\"DEACTIVATED\"}), headers:{Accept:\"application/json\",\"Content-Type\":\"application/json\",Authorization:\"Basic \" + APIKey}}, function () {\n\t\t\tif (this.readyState == 4) {\n\t\t\t\t\tif (this.status == 200) {\n\t\t\t\t\tClient.invokeModal(\"OK\",\"Cellular SIM ICCID \" + iccid, \"SIM has been deactivated. Status: \" + this.responseText);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tClient.invokeModal(\"OK\",\"Cellular details for ICCID \" + iccid, \"Error returned status: \" + this.status + \", error: \" + this.responseText);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\t}\n});\n\t\t\t\t\t   \nClientEvents.subscribe(\"LookupIMEI\", function () {\n\tvar iccid = checkICCID();\n\tif (iccid) {\n\t\tClient.sendXmlHttpRequest(\"GET\", \"https://restapi10.jasper.com/rws/api/v1/devices/\" + iccid , \n\t\t\t{type:\"text\", data:null, headers:{Accept:\"application/json\",Authorization:\"Basic \" + APIKey}}, function () {\n\t\t\tif (this.readyState == 4) {\n\t\t\t\t\tif (this.status == 200) {\n\t\t\t\t\t\tsendToInputs(this.responseText);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tClient.invokeModal(\"OK\",\"Cellular details for ICCID \" + iccid, \"Error returned status: \" + this.status + \", error: \" + this.responseText);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\t}\n});\n\nClientEvents.subscribe(\"DevLookupCellStats\", function () {\n\tvar iccid = checkICCID();\n\tif (iccid) {\n\t\tClient.sendXmlHttpRequest(\"GET\", \"https://restapi10.jasper.com/rws/api/v1/devices/\" + iccid + \"/ctdUsages\", \n\t\t\t{type:\"text\", data:null, headers:{Accept:\"application/json\",Authorization:\"Basic \" + APIKey}}, function () {\n\t\t\tif (this.readyState == 4) {\n\t\t\t\t\tif (this.status == 200) {\n\t\t\t\t\t\tformatResponse(this.responseText, iccid);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tClient.invokeModal(\"OK\",\"Cellular details for ICCID \" + iccid, \"Error returned status: \" + this.status + \", error: \" + this.responseText);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\t}\n});\n\nfunction checkICCID() {\n\tvar formData = Script.getForm(\"DevForm\");\n\tif (formData.DevICCID === \"\") {\n\t\tClient.invokeModal(\"OK\",\"No ICCID Specified\", \"Please enter an ICCID in the form before looking up device cellular data\");\n\t\treturn;\n\t}\n\tvar iccid = formData.DevICCID;\n\tClient.status(\"Looking up data for ICCID \" + iccid + \"...\");\n\treturn iccid;\n}\n\nfunction sendToInputs(response) {\n\tvar jsonData = JSON.parse(response);\n\tClientEvents.publish(\"DevIMEISetVal\",jsonData.imei);\n\tClientEvents.publish(\"DevNumberSetVal\",jsonData.msisdn);\n\tClient.setDirtyFlag();\n\t//ClientEvents.publish(\"DevAPN\",\"XX\");\n}\n\nfunction formatResponse(response, iccid) {\n\tvar text = \"Server responded with the following details:<br><br>\";\n\tvar jsonData = JSON.parse(response);\n\tObject.keys(jsonData).forEach(function(key) {\n\t\ttext = text + \"&nbsp;&nbsp;&nbsp;&nbsp;<b>\" + key + \":</b>&nbsp;&nbsp;\" + jsonData[key] + \"<br>\";\n\t});\n\tClient.invokeModal(\"OK\",\"Cellular details for ICCID \" + iccid, text);\n}"},"ev":{}},"DevIMEI":{"t":"Input","lX":515,"lY":405,"sX":2.3,"sY":1,"s":"Manage Devices","ps":{"enabled":"false","scalingType":"NOVERT","width":"9.72%","height":"4.29%","x":"11.88%","y":"19.72%"},"ver":"270520c190915","dis":false,"tt":"Cellular IMEI number","a":{"tab index":"8","color":"grey","form id":"DevForm","label text":"IMEI"},"ev":{"clientEvents":{"inputEvents":{"Clear":{"channel":"clear/receive value","event":"receive value"},"SetVal":{"channel":"DevIMEISetVal/receive value","event":"receive value"}}}}},"DevNumber":{"t":"Input","lX":515,"lY":465,"sX":2.3,"sY":1,"s":"Manage Devices","ps":{"enabled":"false","scalingType":"NOVERT","width":"9.72%","height":"4.29%","x":"11.88%","y":"19.72%"},"ver":"270520c190915","dis":false,"tt":"Cellular phone number","a":{"tab index":"8","color":"grey","form id":"DevForm","label text":"Cell Number"},"ev":{"clientEvents":{"inputEvents":{"Clear":{"channel":"clear/receive value","event":"receive value"},"SetVal":{"channel":"DevNumberSetVal/receive value","event":"receive value"}}}}},"DevAPN":{"t":"Input","lX":515,"lY":525,"sX":2.3,"sY":1,"s":"Manage Devices","ps":{"enabled":"false","scalingType":"NOVERT","width":"9.72%","height":"4.29%","x":"11.88%","y":"19.72%"},"ver":"270520c190915","dis":false,"tt":"Cellular APN","a":{"tab index":"8","color":"grey","form id":"DevForm","label text":"APN"},"ev":{"clientEvents":{"inputEvents":{"Clear":{"channel":"clear/receive value","event":"receive value"},"SetVal":{"channel":"DevAPNSetVal/receive value","event":"receive value"}}}}},"DevBattLevel":{"t":"Label","lX":815,"lY":230,"sX":2.65,"sY":1,"s":"Manage Devices","ps":{"enabled":"false","scalingType":"OK","width":"11.15%","height":"2.03%","x":"22.3%","y":"17.77%"},"ver":"200124c190915","dis":false,"a":{"font size":"14","label text":"<font color=\"#777777\">Battery Level:</font> <b><font color=\"#555555\">[#]</font></b>"},"ev":{"clientEvents":{"inputEvents":{"DevBattLevelSetVal":{"channel":"DevBattLevelSetVal/receive value","event":"receive value"}}}}},"DevSignalStrength":{"t":"Label","lX":815,"lY":205,"sX":2.65,"sY":1,"s":"Manage Devices","ps":{"enabled":"false","scalingType":"OK","width":"11.15%","height":"2.03%","x":"34.29%","y":"15.96%"},"ver":"200124c190915","dis":false,"a":{"font size":"14","label text":"<font color=\"#777777\">Signal Strength:</font> <font color=\"#555555\"><b>[#]</b></font>"},"ev":{"clientEvents":{"inputEvents":{"DevSignalSetVal":{"channel":"DevSignalSetVal/receive value","event":"receive value"}}}}},"DevClear":{"t":"Icon","lX":625,"lY":110,"sX":0.6,"sY":0.6,"s":"Manage Devices","ps":{"enabled":"false","scalingType":"NOHORIZ,NOVERT","width":"1.26%","height":"2.44%","x":"27.26%","y":"8.51%"},"ver":"190104c190915","dis":false,"tt":"Clear Form","a":{"icon file":"x-square","value on":"","outline color":"no outline"},"ev":{"clientEvents":{"outputEvents":{"Pressed":{"channel":"DevReset/receive value","event":"pressed","trigger":"pressed"}}}}},"DevUpdate":{"t":"Icon","lX":710,"lY":105,"sX":0.8,"sY":0.8,"s":"Manage Devices","ps":{"enabled":"false","scalingType":"NOHORIZ,NOVERT","width":"1.68%","height":"3.24%","x":"30.33%","y":"8.83%"},"ver":"190104c190915","dis":false,"tt":"Save Device","a":{"icon file":"floppy","outline color":"no outline"},"ev":{"clientEvents":{"inputEvents":{},"outputEvents":{"Pressed":{"channel":"DevSave/receive value","event":"pressed","trigger":"pressed","important":"false"}}}}},"DevDelete":{"t":"Icon","lX":670,"lY":110,"sX":0.6,"sY":0.6,"s":"Manage Devices","ps":{"enabled":"false","scalingType":"NOHORIZ,NOVERT","width":"1.26%","height":"2.44%","x":"27.26%","y":"8.51%"},"ver":"190104c190915","dis":false,"tt":"Delete Device","a":{"icon file":"trash","outline color":"no outline"},"ev":{"clientEvents":{"outputEvents":{"Pressed":{"channel":"DevDelRec/receive value","event":"pressed","trigger":"pressed"}}}}},"DevUpdAttrib":{"t":"Icon","lX":1240,"lY":520,"sX":0.8,"sY":0.8,"s":"Manage Devices","ps":{"enabled":"false","scalingType":"NOHORIZ,NOVERT","width":"1.68%","height":"3.26%","x":"30.33%","y":"8.83%"},"ver":"190104c190915","dis":false,"tt":"Save Attribute","a":{"icon file":"floppy","outline color":"no outline"},"ev":{"clientEvents":{"inputEvents":{},"outputEvents":{"Pressed":{"channel":"DevSaveAttrib/receive value","event":"pressed","trigger":"pressed"}}}}},"DevLookupIMEI":{"t":"Icon","lX":530,"lY":585,"sX":0.6,"sY":0.6,"s":"Manage Devices","ps":{"enabled":"false","scalingType":"NOHORIZ,NOVERT","width":"1.26%","height":"2.44%","x":"27.26%","y":"8.51%"},"ver":"190104c190915","dis":false,"tt":"Lookup IMEI","a":{"icon file":"phone","value on":"","outline color":"no outline"},"ev":{"clientEvents":{"outputEvents":{"Pressed":{"channel":"LookupIMEI/receive value","event":"pressed","trigger":"pressed"}}}}},"DevDeactivate":{"t":"Icon","lX":645,"lY":585,"sX":0.6,"sY":0.6,"s":"Manage Devices","ps":{"enabled":"false","scalingType":"NOHORIZ,NOVERT","width":"1.26%","height":"2.44%","x":"27.26%","y":"8.51%"},"ver":"190104c190915","dis":false,"tt":"Deactivate SIM","a":{"icon file":"wifi-off","value on":"","outline color":"no outline"},"ev":{"clientEvents":{"outputEvents":{"Pressed":{"channel":"DevDeactivateSim/receive value","event":"pressed","trigger":"pressed"}}}}},"DevActivate":{"t":"Icon","lX":695,"lY":585,"sX":0.6,"sY":0.6,"s":"Manage Devices","ps":{"enabled":"false","scalingType":"NOHORIZ,NOVERT","width":"1.26%","height":"2.44%","x":"27.26%","y":"8.51%"},"ver":"190104c190915","dis":false,"tt":"Activate SIM","a":{"icon file":"wifi","value on":"","outline color":"no outline"},"ev":{"clientEvents":{"outputEvents":{"Pressed":{"channel":"DevActivateSim/receive value","event":"pressed","trigger":"pressed"}}}}},"DevMap":{"t":"Icon","lX":1250,"lY":595,"sX":0.6,"sY":0.6,"s":"Manage Devices","ps":{"enabled":"false","scalingType":"NOHORIZ,NOVERT","width":"1.26%","height":"2.44%","x":"46.61%","y":"48.95%"},"ver":"190104c190915","dis":false,"tt":"View on Map","a":{"icon file":"map","value on":"","outline color":"no outline"},"ev":{"clientEvents":{"outputEvents":{"Pressed":{"channel":"DevLaunchMap/receive value","event":"pressed","trigger":"pressed"}}}}},"DevGlobe":{"t":"Icon","lX":1195,"lY":595,"sX":0.6,"sY":0.6,"s":"Manage Devices","ps":{"enabled":"false","scalingType":"NOHORIZ,NOVERT","width":"1.26%","height":"2.44%","x":"27.26%","y":"8.51%"},"ver":"190104c190915","dis":false,"tt":"Launch URL for model details","a":{"icon file":"globe2","value on":"","outline color":"no outline"},"ev":{"clientEvents":{"outputEvents":{"Pressed":{"channel":"DevLaunchURL/receive value","event":"pressed","trigger":"pressed"}}}}},"DevOwner":{"t":"Input","lX":270,"lY":465,"sX":2.3,"sY":1,"s":"Manage Devices","ps":{"enabled":"false","scalingType":"NOVERT","width":"9.63%","height":"4.29%","x":"11.65%","y":"26.42%"},"ver":"270520c190915","dis":false,"tt":"Allocated owner for the device","a":{"tab index":"12","color":"grey","form id":"DevForm","label text":"Owner"},"ev":{"clientEvents":{"inputEvents":{"SetVal":{"channel":"DevOwnerSetVal/receive value","event":"receive value"},"Clear":{"channel":"clear/receive value","event":"receive value"}}}}},"DevICCID":{"t":"Input","lX":515,"lY":345,"sX":2.3,"sY":1,"s":"Manage Devices","ps":{"enabled":"false","scalingType":"NOVERT","width":"9.68%","height":"4.29%","x":"57.55%","y":"26.66%"},"ver":"270520c190915","dis":false,"tt":"Cellular ICCID number","a":{"tab index":"8","color":"grey","form id":"DevForm","label text":"ICCID","validate pattern":"^89[0-9]{16,18}$","invalid message":"Data input is invalid for an ICCID, please enter 18 to 22 digits starting with 89."},"ev":{"clientEvents":{"inputEvents":{"Clear":{"channel":"clear/receive value","event":"receive value"},"SetVal":{"channel":"DevICCIDSetVal/receive value","event":"receive value"}}}}},"Container#10":{"t":"Container","lX":510,"lY":340,"sX":2.45,"sY":3.05,"s":"Manage Devices","ps":{"enabled":"false","scalingType":"OK","width":"10.31%","height":"24.72%","x":"21.62%","y":"27.39%"},"ver":"190104c190915","z":"110","dis":false,"a":{"color":"grey","title":""},"ev":{}},"DevCellStats":{"t":"Icon","lX":590,"lY":585,"sX":0.6,"sY":0.6,"s":"Manage Devices","ps":{"enabled":"false","scalingType":"NOHORIZ,NOVERT","width":"1.26%","height":"2.44%","x":"24.78%","y":"47.08%"},"ver":"190104c190915","dis":false,"tt":"Lookup Cellular Statistics","a":{"icon file":"card-list","value on":"","outline color":"no outline"},"ev":{"clientEvents":{"outputEvents":{"Pressed":{"channel":"DevLookupCellStats/receive value","event":"pressed","trigger":"pressed"}}}}},"DevDistribList":{"t":"Dropdown","lX":25,"lY":90,"sX":2,"sY":1,"s":"Manage Devices","ps":{"enabled":"false","scalingType":"NOVERT","width":"8.41%","height":"4.07%","x":"2.94%","y":"1.62%"},"ver":"190104c190915","dis":false,"tt":"","a":{"label text":"Distributor","default options":"Kinect","bold":"true","placeholder":"Select Distributor"},"ev":{"clientEvents":{"inputEvents":{"DevDistribList":{"channel":"DevDistribList/receive list","event":"receive list","important":"false"}}}}},"Rain Radar#0":{"t":"Rain Radar","lX":195,"lY":155,"sX":1,"sY":1,"s":"New Screen 2","ps":{"enabled":false,"scalingType":"NOHORIZ,NOVERT","width":"","height":"","x":"","y":""},"ver":"190104c190915","a":{"interval":"400","city":"Brisbane","zoom":"64"},"ev":{}}},"screens":{"Manage Models":{"index":0,"icon":"important_devices","meta":""},"Manage Devices":{"index":1,"icon":"devices_other","meta":""},"New Screen 2":{"index":2,"icon":"widgets","tt":null,"meta":""}},"meta":""}